define(["dojo/on","dojo/dom-construct","esri/symbols/SimpleFillSymbol","esri/symbols/SimpleLineSymbol","esri/request","esri/symbols/SimpleMarkerSymbol","esri/tasks/QueryTask","esri/widgets/Expand","dojo/sniff","esri/geometry/Extent","esri/renderers/UniqueValueRenderer","esri/tasks/support/Query","esri/widgets/Search","esri/widgets/Legend","esri/widgets/LayerList","esri/widgets/Locate","esri/layers/WebTileLayer","esri/layers/FeatureLayer","esri/layers/MapImageLayer","esri/layers/OpenStreetMapLayer","esri/tasks/Locator","esri/Map","esri/geometry/Point","esri/Graphic","esri/Color","esri/geometry/geometryEngine","esri/layers/GraphicsLayer","dojo/window","dojo/dom","dojo/dom-class","esri/core/Collection","esri/geometry/Polygon","esri/geometry/Polyline","esri/widgets/Locate/LocateViewModel","esri/core/watchUtils","dojo/dom-style","esri/views/MapView"],function(e,t,n,r,o,i,a,s,l,c,u,d,p,f,h,y,g,m,v,w,b,x,T,k,N,E,M,D,L,S,I,P,j,F,H,O,A){return function(e){function t(t){for(var n,o,i=t[0],a=t[1],s=0,c=[];s<i.length;s++)o=i[s],r[o]&&c.push(r[o][0]),r[o]=0;for(n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n]);for(l&&l(t);c.length;)c.shift()()}var n={},r={4:0};function o(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.e=function(e){var t=[],n=r[e];if(0!==n)if(n)t.push(n[2]);else{var i=new Promise(function(t,o){n=r[e]=[t,o]});t.push(n[2]=i);var a=document.getElementsByTagName("head")[0],s=document.createElement("script");s.charset="utf-8",s.timeout=120,o.nc&&s.setAttribute("nonce",o.nc),s.src=function(e){return o.p+""+({}[e]||e)+".bundle.js"}(e);var l=setTimeout(function(){c({type:"timeout",target:s})},12e4);function c(t){s.onerror=s.onload=null,clearTimeout(l);var n=r[e];if(0!==n){if(n){var o=t&&("load"===t.type?"missing":t.type),i=t&&t.target&&t.target.src,a=new Error("Loading chunk "+e+" failed.\n("+o+": "+i+")");a.type=o,a.request=i,n[1](a)}r[e]=void 0}}s.onerror=s.onload=c,a.appendChild(s)}return Promise.all(t)},o.m=e,o.c=n,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},o.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/",o.oe=function(e){throw console.error(e),e};var i=window.webpackJsonp=window.webpackJsonp||[],a=i.push.bind(i);i.push=t,i=i.slice();for(var s=0;s<i.length;s++)t(i[s]);var l=a;return o(o.s=48)}([function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t){e.exports=r},function(e,t){e.exports=o},function(e,t){e.exports=i},function(e,t){e.exports=a},function(e,t){e.exports=s},function(e,t){e.exports=l},function(e,t){e.exports=c},function(e,t){e.exports=u},function(e,t){e.exports=d},function(e,t){e.exports=p},function(e,t){e.exports=f},function(e,t){e.exports=h},function(e,t){e.exports=y},function(e,t){e.exports=g},function(e,t){e.exports=m},function(e,t){e.exports=v},function(e,t){e.exports=w},function(e,t){e.exports=b},function(e,t){e.exports=x},function(e,t){e.exports=T},,function(e,t){e.exports=k},function(e,t){e.exports=N},,function(e,t){e.exports=E},function(e,t){e.exports=M},function(e,t){e.exports=D},,function(e,t){e.exports=L},function(e,t){e.exports=S},function(e,t){e.exports=I},function(e,t){e.exports=P},function(e,t){e.exports=j},function(e,t){e.exports=F},function(e,t){e.exports=H},,,function(e,t){e.exports=O},function(e,t){e.exports=A},,,,,,,function(e,t,n){n.e(0).then(function(){var e=[n(23),n(26),n(21),n(20),n(42),n(19),n(18),n(17),n(16),n(7),n(15),n(14),n(13),n(12),n(6),n(11),n(4),n(10),n(5),n(30),n(45),n(44),n(39),n(38),n(43),n(2),n(3),n(9),n(0),n(1),n(8)];(function(e,t,n,r,o,i,a,s,l,c,u,d,p,f,h,y,g,m,v,w,b,x,T,k,N,E,M,D,L,S,I){"use strict";var P,j,F,H=new w,O=new n({}),A=new o({container:"map",map:O,center:t.center,zoom:t.zoom});A.session().then(function(n){H.user=n;var r=void 0;7===Math.floor(H.user.role/100)&&(r="MaHuyenTP = '"+H.user.role.trim()+"'"),A.systemVariable=H;!function(){var n=t.basemap;if(r){var o=n.sublayers,i=Array.isArray(o),s=0;for(o=i?o:o[Symbol.iterator]();;){var c;if(i){if(s>=o.length)break;c=o[s++]}else{if((s=o.next()).done)break;c=s.value}c.definitionExpression=r}}function u(e,t,n,r){if(e)switch(r){case F:P.visible=j.visible=!e;break;case P:F.visible=j.visible=!e;break;case j:F.visible=P.visible=!e}}(P=new a(n)).watch("visible",function(e){$&&$.notify(e?"Hiển thị dữ liệu nền":"Ẩn dữ liệu nền")}),P.then(function(){if(r){var t=P.findSublayerById(e.INDEX_HANHCHINHHUYEN),n=t.createQuery();n.where=r,n.returnGeometry=!0,n.outSpatialReference=A.spatialReference,t.queryFeatures(n).then(function(e){var t=e.features[0];A.goTo({target:t.geometry})})}}),j=new l({urlTemplate:"//mt1.google.com/vt/lyrs=y&x={col}&y={row}&z={level}",title:"Ảnh vệ tinh",id:"worldimagery",visible:!1}),F=new l({title:"Đường đi",urlTemplate:"//mt1.google.com/vt/lyrs=m&x={col}&y={row}&z={level}",id:"osm",visible:!1}),O.addMany([F,j,P]),F.watch("visible",u),j.watch("visible",u),P.watch("visible",u)}(),(s.prototype.getAttachments=function(e){var t=this;return new Promise(function(n,r){var o=t.url+"/"+t.layerId+"/"+e;g(o+"/attachments?f=json",{responseType:"json",method:"get"}).then(function(e){n(e.data||null)})})},new Promise(function(n,o){g("/map/layerrole",{method:"post"}).then(function(o){if(!o.data)throw"cannot request permission";var i=function(){if(l){if(c>=a.length)return"break";u=a[c++]}else{if((c=a.next()).done)return"break";u=c.value}var e=u;t.layers.find(function(t){return t.id===e.layer}).permission={create:e.isCreate,view:e.isView,delete:e.isDelete,edit:e.isEdit}},a=o.data,l=Array.isArray(a),c=0;for(a=l?a:a[Symbol.iterator]();;){var u;if("break"===i())break}for(var d in t.layers){var p=t.layers[d];if(p.permission.view){if(p.id===e.SAUBENH){var f=new Date;f.setDate(f.getDate()-365),p.definitionExpression="NgayXayRa >= date '"+f.getFullYear()+"-"+(f.getMonth()+1)+"-"+f.getDate()+" "+f.getHours()+":"+f.getMinutes()+":"+f.getSeconds()+"'",p.renderer=new m({field:"CapDoGayHai",uniqueValueInfos:[{value:"1",symbol:new v({color:"#0f0",style:"circle",outline:{color:"white"}}),label:"Nhẹ"},{value:"2",symbol:new v({color:"#00a9e6",style:"circle",outline:{color:"white"}}),label:"Nặng"},{value:"3",symbol:new v({color:"#ff0000",style:"circle",outline:{color:"white"}}),label:"Mất trắng"},{value:"4",symbol:new v({color:"#ffff6d",style:"circle",outline:{color:"white"}}),label:"Trung bình"}]})}r&&(p.definitionExpression?p.definitionExpression+=" and "+r:p.definitionExpression=r,p.definitionExpression=r),p.id===e.TRONGTROT&&(p.opacity=.7);var h=new s(p);O.add(h)}}n()})})).then(function(){(function(){function t(){var e=$("<div/>",{class:"google-geocoding-widget input-group add-on"}),t=$("<input/>",{class:"form-control",type:"text",name:"srch-term",id:"srch-term",placeholder:"Nhập đơn vị hành chính, tên đường "}).appendTo(e),n=$("<div/>",{class:"input-group-btn"}).appendTo(e),r=$("<button/>",{class:"btn btn-default",type:"submit"}).appendTo(n),o=($("<i/>",{class:"glyphicon glyphicon-search"}).appendTo(r),$("<div/>",{class:"output-group add-on",id:"ketqua"}));A.ui.add(e[0],"top-right"),A.ui.add(o[0],"top-right"),r.on("click",function(e){function n(){var e=document.getElementById("ketqua");if(e)for(;e.firstChild;)e.removeChild(e.firstChild)}var r=t.val().toString().replace(/[ ]/g,"+");$.get("https://maps.googleapis.com/maps/api/geocode/json?address="+r+"&key=AIzaSyC9VTEqoczK2j7lDRacfQ3aRTE3f4vuHek").done(function(e){var t=e.results;n();var r=function(){if(a){if(s>=i.length)return"break";l=i[s++]}else{if((s=i.next()).done)return"break";l=s.value}var e=l,t=$("<div />",{class:"address list-group-item"}).appendTo(o);$("<div />",{class:"address-detail",text:e.formatted_address}).appendTo(t).click(function(){return t=e.geometry.viewport,r=new D({ymin:t.southwest.lat,ymax:t.northeast.lat,xmin:t.southwest.lng,xmax:t.northeast.lng}),A.goTo(r),void n();var t,r})},i=t,a=Array.isArray(i),s=0;for(i=a?i:i[Symbol.iterator]();;){var l;if("break"===r())break}})})}if(t(),new T(A).startup(),A.ui.move(["zoom"],"top-left"),A.ui.add(new c({expandIconClass:"esri-icon-layer-list",view:A,content:new d({container:document.createElement("div"),view:A})}),"top-left"),A.ui.add(new u({view:A}),"top-left"),!I("android")&&!I("ios")&&!I("bb")){var n=S.create("img",{src:"images/logo-ditagis.png",id:"dtg-widget-logo"});A.ui.add(n,"bottom-right")}A.ui.add(new c({expandIconClass:"esri-icon-collection",content:new p({view:A})}),"top-left");var o=new N(A,{symbolPlg:new E({style:"none",outline:new M({color:"black",width:3})})}),t=new f({searchAllEnabled:!1,view:A,allPlaceholder:"Nhập nội dung tìm kiếm",sources:[{featureLayer:O.findLayerById(e.SAUBENH),searchFields:["OBJECTID","MaSauBenh","MaHuyenTP"],displayField:"MaSauBenh",exactMatch:!1,outFields:["*"],name:"Sâu hại",placeholder:"Tìm kiếm theo tên, loại cây trồng, huyện/tp"},{featureLayer:O.findLayerById(e.DOANHNGHIEP),searchFields:["OBJECTID","MaDoanhNghiep","NguoiDaiDienDoanhNghiep"],displayField:"NguoiDaiDienDoanhNghiep",exactMatch:!1,outFields:["*"],name:"Doanh Nghiệp",placeholder:"Nhập tên hoặc mã Doanh nghiệp"},{featureLayer:O.findLayerById(e.TRONGTROT),searchFields:["MaDoiTuong"],displayField:"MaDoiTuong",exactMatch:!1,outFields:["*"],name:"Trồng Trọt",placeholder:"Nhập mã đối tượng Trồng trọt"},{featureLayer:new s({url:"https://ditagis.com:6443/arcgis/rest/services/BinhDuong/DuLieuNen/MapServer/4"}),searchFields:["MaPhuongXa","TenXa"],displayField:"TenXa",outFields:["*"],filter:{where:""+(r||"1=1")},name:"Hành chính xã",placeholder:"Nhập tên xã/ phường",popupOpenOnSelect:!1,resultGraphicEnabled:!1}]});A.ui.add(t,{position:"top-right"}),t.on("search-complete",function(e){o.clear();var t=e.results.find(function(e){return 4===e.sourceIndex});if(t&&t.results.length>0){var n=t.results[0].feature;o.add(n)}});var i=new x(A);i.startup(),new k(A).startup();var a=new b({view:A});i.on("draw-finish",function(e){a.add({layerName:e.graphic.layer.title,geometry:e.graphic.geometry})})})(),O.reorder(P,5)}),Loader.hide()})}).apply(null,e)}).catch(n.oe)}])});