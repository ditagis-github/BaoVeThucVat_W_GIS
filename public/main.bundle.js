define(["dojo/on","dojo/dom-construct","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleFillSymbol","esri/request","esri/symbols/SimpleMarkerSymbol","esri/widgets/Expand","esri/Graphic","esri/tasks/QueryTask","esri/Color","esri/geometry/geometryEngine","esri/renderers/UniqueValueRenderer","esri/geometry/Extent","esri/Map","esri/tasks/support/Query","esri/widgets/Search","esri/widgets/Legend","esri/widgets/LayerList","esri/widgets/Locate","esri/layers/WebTileLayer","esri/layers/FeatureLayer","esri/layers/MapImageLayer","esri/layers/OpenStreetMapLayer","esri/tasks/Locator","esri/layers/GraphicsLayer","dojo/window","dojo/dom","dojo/dom-class","esri/core/watchUtils","esri/core/Collection","esri/geometry/Polygon","esri/geometry/Polyline","esri/widgets/Locate/LocateViewModel","dojo/dom-style","esri/views/MapView"],function(e,t,n,i,r,a,o,s,l,u,c,d,h,p,f,v,m,g,y,T,b,w,D,C,x,E,k,L,M,N,I,S,O,G,F){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=63)}([function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t,n){"use strict";var i;void 0===(i=function(e,t){return{BASEMAP:"dulieunen",SAUBENH:"SauBenh",DOANHNGHIEP:"DoanhNghiep",TRONGTROT:"TrongTrot",INDEX_HANHCHINHXA:4,INDEX_HANHCHINHHUYEN:5,TABLE_SXTT_URL:"https://ditagis.com:6443/arcgis/rest/services/BinhDuong/BaoVeThucVat/FeatureServer/3",THOI_GIAN_SAN_XUAT_TRONG_TROT:"thoigiansxtt",TBL_GIAI_DOAN_SINH_TRUONG:"tblgiaidoansinhtruong"}}.apply(t,[n,t]))||(e.exports=i)},function(e,t){e.exports=n},function(e,t){e.exports=i},function(e,t){e.exports=r},function(e,t){e.exports=a},function(e,t){e.exports=o},function(e,t){e.exports=s},function(e,t){e.exports=l},function(e,t){e.exports=u},function(e,t,n){"use strict";var i;void 0===(i=function(e,t){return{basemap:{title:"Dữ liệu nền",id:"dulieunen",url:"https://ditagis.com:6443/arcgis/rest/services/BinhDuong/DuLieuNen/MapServer",visible:!0,copyright:"Bản đồ biên tập bởi Trung tâm DITAGIS",sublayers:[{id:5,title:"Hành chính huyện"},{id:4,title:"Hành chính xã"},{id:3,title:"Sông hồ"},{id:2,title:"Phủ bề mặt",visible:!1},{id:1,title:"Mặt giao thông"},{id:0,title:"Tim đường"}]},layers:[{title:"Trồng trọt",id:"TrongTrot",url:"https://ditagis.com:6443/arcgis/rest/services/BinhDuong/BaoVeThucVat_ChuyenDe/FeatureServer/2",outFields:["*"]},{title:"Sâu bệnh",id:"SauBenh",url:"https://ditagis.com:6443/arcgis/rest/services/BinhDuong/BaoVeThucVat_ChuyenDe/FeatureServer/1",outFields:["*"]},{title:"Doanh nghiệp",id:"DoanhNghiep",url:"https://ditagis.com:6443/arcgis/rest/services/BinhDuong/BaoVeThucVat_ChuyenDe/FeatureServer/0",outFields:["*"]}],tables:[{id:"thoigiansxtt",url:"https://ditagis.com:6443/arcgis/rest/services/BinhDuong/BaoVeThucVat_ChuyenDe/FeatureServer/3"},{id:"tblgiaidoansinhtruong",url:"https://ditagis.com:6443/arcgis/rest/services/BinhDuong/BaoVeThucVat_ChuyenDe/FeatureServer/4"}],zoom:10,center:[106.6843694,11.158752270428375]}}.apply(t,[n,t]))||(e.exports=i)},function(e,t){e.exports=c},function(e,t){e.exports=d},function(e,t){e.exports=h},function(e,t){e.exports=p},function(e,t){e.exports=f},function(e,t){e.exports=v},function(e,t){e.exports=m},function(e,t){e.exports=g},function(e,t){e.exports=y},function(e,t){e.exports=T},function(e,t){e.exports=b},function(e,t){e.exports=w},function(e,t){e.exports=D},function(e,t){e.exports=C},function(e,t,n){"use strict";var i,r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();void 0===(i=function(e,t){return function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.eventListeners={},t.on=this.on,t.fire=this.fire,t.eventListeners=this.eventListeners}return r(e,[{key:"on",value:function(e,t){this.eventListeners[e]?this.eventListeners[e].push(t):this.eventListeners[e]=[t]}},{key:"fire",value:function(e,t){var n=this.eventListeners[e];if(n){var i=!0,r=!1,a=void 0;try{for(var o,s=n[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){(0,o.value)(t)}}catch(e){r=!0,a=e}finally{try{!i&&s.return&&s.return()}finally{if(r)throw a}}}}}]),e}()}.apply(t,[n,t]))||(e.exports=i)},function(e,t,n){"use strict";var i,r,a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();i=[n,t,n(8),n(6),n(3),n(4),n(10),n(28)],void 0===(r=function(e,t,n,i,r,o,s,l){return function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n=n||{},this.view=t,this.graphics=new l({listMode:"hide"}),this.view.map.add(this.graphics),this.symbolMarker=n.symbolMarker||new i({color:new s([255,0,0]),size:3,outline:new r({width:7,color:new s([255,64,0,.4])})}),this.symbolLine=n.symbolLine||new r({color:new s([255,0,0]),width:4}),this.symbolPlg=n.symbolPlg||new o({style:"none",outline:new r({color:new s([255,64,0,.4]),width:1})})}return a(e,[{key:"hightlight",value:function(e){var t=this;this.clear(),this.view.hitTest(e).then(function(e){var n=!0,i=!1,r=void 0;try{for(var a,o=e.results[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value.graphic;s.attributes&&null!=s.attributes&&t.add(s)}}catch(e){i=!0,r=e}finally{try{!n&&o.return&&o.return()}finally{if(i)throw r}}})}},{key:"clear",value:function(){this.removeAll()}},{key:"rendererGraphic",value:function(e,t){var i=void 0;return i="point"===e?this.symbolMarker:"polyline"===e?this.symbolLine:this.symbolPlg,new n({geometry:t,symbol:i})}},{key:"add",value:function(e){var t=e.geometry.type,n=this.rendererGraphic(t,e.geometry);this.graphics.add(n)}},{key:"addAll",value:function(e){var t=!0,n=!1,i=void 0;try{for(var r,a=e[Symbol.iterator]();!(t=(r=a.next()).done);t=!0){var o=r.value;this.add(o)}}catch(e){n=!0,i=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw i}}}},{key:"removeAll",value:function(){this.graphics.removeAll()}}]),e}()}.apply(t,i))||(e.exports=r)},function(e,t){e.exports=x},function(e,t){e.exports=E},function(e,t,n){"use strict";var i,r;i=[n,t,n(26)],void 0===(r=function(e,t,n){return function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.eventListener=new n(this)}}.apply(t,i))||(e.exports=r)},function(e,t){e.exports=k},function(e,t){e.exports=L},function(e,t,n){"use strict";var i,r,a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();i=[n,t,n(9),n(5)],void 0===(r=function(e,t,n,i){return function(){function e(){var t=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=i.url,this.fieldID=i.fieldID||"OBJECTID",this.queryTask=new n(this.url),$.get(this.url+"?f=json").done(function(e){for(var n in e=JSON.parse(e))t[n]=e[n]})}return a(e,[{key:"findById",value:function(e){return this.queryTask.execute({outFields:["*"],where:this.fieldID+" = '"+e+"'"})}},{key:"getFieldDomain",value:function(e){return this.fields.find(function(t){return t.name===e}).domain}},{key:"applyEdits",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{addFeatures:[],updateFeatures:[],deleteFeatures:[]},t=document.createElement("form");if(t.method="post",e.addFeatures.length>0){var n=document.createElement("input");n.name="adds",n.type="text",n.value=JSON.stringify(e.addFeatures),t.appendChild(n)}if(e.deleteFeatures.length>0){var r=document.createElement("input");r.name="deletes",r.type="text",r.value=e.deleteFeatures.join(","),t.appendChild(r)}if(e.updateFeatures.length>0){var a=document.createElement("input");a.name="updates",a.type="text",a.value=JSON.stringify(e.updateFeatures),t.appendChild(a)}var o=document.createElement("input");return o.name="f",o.type="text",o.value="json",t.appendChild(o),i(this.url+"/applyEdits?f=json",{method:"post",body:t})}},{key:"queryFeatures",value:function(e){return this.queryTask.execute(e)}}]),e}()}.apply(t,i))||(e.exports=r)},function(e,t,n){"use strict";var i,r,a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var o=function(e,t,n,i){return new(n||(n=Promise))(function(r,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(o,s)}l((i=i.apply(e,t||[])).next())})};i=[n,t,n(9),n(2)],void 0===(r=function(e,t,n,i){return function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return a(e,null,[{key:"getQueryLocation",value:function(e){return this._queryLocation||(this._queryLocation=new n({url:e.map.findLayerById(i.BASEMAP).findSublayerById(i.INDEX_HANHCHINHXA).url})),this._queryLocation}},{key:"getLocationName",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{PhuongXa:null,HuyenTP:null};return new Promise(function(i,r){try{var a=t.getQueryLocation(e),o=[];n.PhuongXa&&o.push("MaPhuongXa = '"+n.PhuongXa+"'"),n.HuyenTP&&o.push("MaHuyenTP = '"+n.HuyenTP+"'"),a.execute({outFields:["TenXa","TenHuyen"],where:o.join(" and ")}).then(function(e){if(e&&e.features.length>0){var t=e.features[0];t&&t.attributes&&i(t.attributes)}else i(null)})}catch(e){console.log(e),r(e)}})}},{key:"getCreatedInfo",value:function(e){return{NguoiCapNhat:e.systemVariable.user.userName,NgayCapNhat:(new Date).getTime()}}},{key:"getUpdatedInfo",value:function(e){return{NguoiCapNhat:e.systemVariable.user.userName,NgayCapNhat:(new Date).getTime()}}},{key:"getNhomCayTrong",value:function(e,t){return o(this,void 0,void 0,regeneratorRuntime.mark(function n(){var r,a,o;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.toScreen(t),n.next=3,e.hitTest(r);case 3:if(!((a=n.sent).results.length>0)){n.next=13;break}if(!((o=a.results.find(function(e){return e.graphic.layer.id===i.TRONGTROT}))&&o.graphic&&o.graphic.attributes)){n.next=10;break}return n.abrupt("return",{NhomCayTrong:o.graphic.attributes.NhomCayTrong,LoaiCayTrong:o.graphic.attributes.LoaiCayTrong});case 10:return n.abrupt("return",null);case 11:n.next=14;break;case 13:return n.abrupt("return",null);case 14:case"end":return n.stop()}},n,this)}))}},{key:"getLocationInfo",value:function(e,t){var n=this;return new Promise(function(i,r){try{n.getQueryLocation(e).execute({outFields:["MaPhuongXa","MaHuyenTP"],geometry:t}).then(function(e){if(e&&e.features.length>0){var t=e.features[0];t&&t.attributes&&i(t.attributes)}else i(null)})}catch(e){console.log(e),r(e)}})}}]),e}()}.apply(t,i))||(e.exports=r)},function(e,t){e.exports=M},function(e,t){e.exports=N},function(e,t){e.exports=I},function(e,t){e.exports=S},function(e,t){e.exports=O},function(e,t,n){"use strict";var i,r,a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var s=function(e,t,n,i){return new(n||(n=Promise))(function(r,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(o,s)}l((i=i.apply(e,t||[])).next())})};i=[n,t,n(2),n(11),n(0),n(1),n(57),n(27),n(34),n(50),n(6),n(4),n(3),n(33),n(10)],void 0===(r=function(e,t,n,i,r,l,u,c,d,h,p,f,v,m,g){return function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.view=t,this.options={hightLength:100};var r=i.tables.find(function(e){return e.id===n.THOI_GIAN_SAN_XUAT_TRONG_TROT}).url;this.thoiGianSanXuatTrongTrot=new m({url:r,fieldID:"MaDoiTuong"}),this.popupEdit=new u(t,{hightLength:this.options.hightLength,table:this.thoiGianSanXuatTrongTrot}),this.tblGiaiDoanSinhTruong=new m({url:i.tables.find(function(e){return e.id===n.TBL_GIAI_DOAN_SINH_TRUONG}).url,fieldID:"OBJECTID"}),this.hightlightGraphic=new c(t,{symbolMarker:new p({outline:new v({color:new g("#7EABCD"),width:2})}),symbolFill:new f({outline:new v({color:new g("#7EABCD"),width:2})})})}return o(e,[{key:"startup",value:function(){var e=this;this.view.map.layers.map(function(t){t.then(function(){if("feature"==t.type){var i=[];t.permission.edit&&(i.push({id:"update",title:"Cập nhật",className:"esri-icon-edit",layer:t}),i.push({id:"update-geometry",title:"Cập nhật vị trí",className:"esri-icon-locate",layer:t})),t.permission.delete&&i.push({id:"delete",title:"Xóa",className:"esri-icon-erase",layer:t}),t.id===n.TRONGTROT&&("/cattachthua"!==location.pathname&&i.push({id:"view-detail",title:"Chi tiết thời gian trồng trọt",className:"esri-icon-table",layer:t}),"/congtacvien"!==location.pathname&&(i.push({id:"split",title:"Chia thửa",className:"esri-icon-zoom-out-fixed",layer:t}),i.push({id:"merge",title:"Ghép thửa",className:"esri-icon-zoom-in-fixed",layer:t}))),t.popupTemplate={content:function(n){var i=e.contentPopup(n,t);return i},title:t.title,actions:i}}})}),this.view.popup.watch("visible",function(t){t||e.hightlightGraphic.clear()}),this.view.popup.on("trigger-action",function(t){e.triggerActionHandler(t)}),this.view.popup.dockOptions={buttonEnabled:!0,breakpoint:{width:600,height:1e3},position:"bottom-center"}}},{key:"triggerActionHandler",value:function(e){var t=e.action.id,n=this.layer||e.action.layer;this.popupEdit.layer=n;var i=!1;switch(t){case"update":n.permission&&n.permission.edit?"esri-icon-check-mark"===e.action.className?this.popupEdit.editFeature():this.popupEdit.showEdit():i=!0;break;case"delete":n.permission&&n.permission.delete?this.popupEdit.deleteFeature():i=!0;break;case"view-detail":this.attributes.MaDoiTuong?this.triggerActionViewDetailTrongtrot(this.attributes.MaDoiTuong):$.notify({message:"Không xác được định danh"},{type:"danger"});break;case"view-detail-edit":this.attributes.MaDoiTuong?this.popupEdit.showTableDetailTrongTrot():$.notify({message:"Không xác được định danh"},{type:"danger"});break;case"update-geometry":if("polygon"===n.geometryType){alert("Không thể thay đổi vị trí vùng...");break}this.popupEdit.updateGeometryGPS();break;case"split":this.popupEdit.splitPolygon();break;case"merge":this.popupEdit.mergePolygon()}i&&$.notify({message:"Không có quyền thực hiện tác vụ"},{type:"danger"})}},{key:"getSubtype",value:function(e,t){if(e=e||this.layer.typeIdField,t=t||this.attributes[e],this.tblGiaiDoanSinhTruong.typeIdField===e){this.tblGiaiDoanSinhTruong.typeIdField;return this.tblGiaiDoanSinhTruong.types.find(function(e){return e.id==t})}return null}},{key:"renderDomain",value:function(e,t){var n=void 0;if("inherited"===e.type){var i=this.layer.getFieldDomain(t);i&&(n=i.codedValues)}else n=e.codedValues;return n}},{key:"contentPopup",value:function(e,t){return s(this,void 0,void 0,regeneratorRuntime.mark(function n(){var i,a,o,u,c,p,f,v,m,g,y,T,b,w=this;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:n.prev=0,i=e.graphic,a=i.layer||t,o=i.attributes,i.layer||(i.layer=a),this.hightlightGraphic.clear(),this.hightlightGraphic.add(i),u=l.create("div",{class:"popup-content",id:"popup-content"}),c=l.create("table",{},u),p=this.getSubtype(),f=regeneratorRuntime.mark(function e(t){var n,i,r,a,u,h,f,v,m;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=o[t.name],"oid"!==t.type){e.next=3;break}return e.abrupt("return","continue");case 3:if(i=l.create("tr"),r=l.create("td",{innerHTML:t.alias}),void 0,a=void 0,u=void 0,h=void 0,p&&p.domains[t.name]?h=w.renderDomain(p.domains[t.name],t.name):t.domain&&(h=w.renderDomain(t.domain,t.name)),!h){e.next=12;break}(f=h.find(function(e){return e.code===n}))&&(n=f.name),e.next=20;break;case 12:if("MaPhuongXa"!==t.name&&"MaHuyenTP"!==t.name||!o[t.name]){e.next=19;break}return e.next=15,d.getLocationName(w.view,{PhuongXa:o.MaPhuongXa,HuyenTP:o.MaHuyenTP}).then(function(e){return s(w,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e;case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)}))});case 15:v=e.sent,n="MaPhuongXa"==t.name?v.TenPhuong:v.TenHuyen,e.next=20;break;case 19:"small-integer"===t.type||"integer"===t.type||"double"===t.type||"date"===t.type&&(u="DateFormat");case 20:a=u?"{"+t.name+":"+u+"}":n,m=l.create("td"),null,t.length>=w.options.hightLength?l.create("textarea",{rows:5,cols:25,readonly:!0,innerHTML:a,style:"background: transparent;border:none"},m):m.innerHTML=a,l.place(r,i),l.place(m,i),l.place(i,c);case 27:case"end":return e.stop()}},e,w)}),v=!0,m=!1,g=void 0,n.prev=11,y=a.fields[Symbol.iterator]();case 13:if(v=(T=y.next()).done){n.next=22;break}return b=T.value,n.delegateYield(f(b),"t0",16);case 16:if("continue"!==n.t0){n.next=19;break}return n.abrupt("continue",19);case 19:v=!0,n.next=13;break;case 22:n.next=28;break;case 24:n.prev=24,n.t1=n.catch(11),m=!0,g=n.t1;case 28:n.prev=28,n.prev=29,!v&&y.return&&y.return();case 31:if(n.prev=31,!m){n.next=34;break}throw g;case 34:return n.finish(31);case 35:return n.finish(28);case 36:return a.hasAttachments&&a.getAttachments(o.OBJECTID).then(function(e){if(e&&e.attachmentInfos&&e.attachmentInfos.length>0){var t=l.create("div",{class:"attachment-container"},document.getElementById("popup-content"));l.create("legend",{innerHTML:"Hình ảnh"},t);var n=a.url+"/"+a.layerId+"/"+o.OBJECTID,i=function(e){var i=l.create("div",{class:"col-lg-3 col-md-4 col-xs-6 thumb"},t),a=l.create("a",{class:"thumbnail",href:"javascript:void(0)"},i),o=l.create("img",{class:"img-responsive",id:n+"/attachments/"+e.id,src:n+"/attachments/"+e.id,alt:n+"/attachments/"+e.name},a);r(a,"click",function(){var t=h.modal("attachments-"+e.id,e.name,o.cloneNode(!0));t&&t.modal()})},s=!0,u=!1,c=void 0;try{for(var d,p=e.attachmentInfos[Symbol.iterator]();!(s=(d=p.next()).done);s=!0){i(d.value)}}catch(e){u=!0,c=e}finally{try{!s&&p.return&&p.return()}finally{if(u)throw c}}}}),n.abrupt("return",u.outerHTML);case 40:throw n.prev=40,n.t2=n.catch(0),n.t2;case 43:case"end":return n.stop()}},n,this,[[0,40],[11,24,28,36],[29,,31,35]])}))}},{key:"triggerActionViewDetailTrongtrot",value:function(e){var t=this,n=$.notify({title:"Thời gian trồng trọt thửa đất: "+e,message:"Đang truy vấn..."},{delay:2e4,showProgressbar:!0});this.thoiGianSanXuatTrongTrot.findById(e).then(function(e){if(e.features.length>0){n.update("message","Tìm thấy "+e.features.length+" dữ liệu"),n.update("progress",100),n.update("type","success");var i=document.createElement("table");i.classList.add("table","table-hover");var r=document.createElement("thead");r.innerHTML="<tr>\n              <th>Nhóm cây trồng</th>\n              <th>Loại cây trồng</th>\n              <th>Diện tích</th>\n              <th>Thời gian bắt đầu trồng</th>\n              <th>Thời gian trồng trọt</th>\n              <th>Giai đoạn sinh trưởng</th>\n            </tr>\n            </thead>",l.place(r,i),i.appendChild(r);var o=document.createElement("tbody");i.appendChild(o);var s=e.features.sort(function(e,t){var n=e.attributes,i=t.attributes;return n.Nam==i.Nam?n.Thang>i.Thang:n.Nam>i.Nam}),u=function(e){var n=e.attributes,i=document.createElement("tr");i.classList.add("Info"),o.appendChild(i);var r=document.createElement("td"),a=t.layer.getFieldDomain("NhomCayTrong").codedValues;if(a){var s=a.find(function(e){return e.code==n.NhomCayTrong});s&&(r.innerText=s.name)}r.innerText||(r.innerText=n.NhomCayTrong+""||"");var l=document.createElement("td"),u=t.getSubtype("NhomCayTrong",n.NhomCayTrong);if(!u)return{v:void 0};var c=u.domains.LoaiCayTrong;if(c){var d=void 0;if("inherited"===c.type){var h=t.layer.getFieldDomain("LoaiCayTrong");h&&(d=h.codedValues)}else d=c.codedValues;if(d){var p=d.find(function(e){return e.code==n.LoaiCayTrong});p&&(l.innerText=p.name)}}l.innerText||(l.innerText=n.LoaiCayTrong||"");var f=document.createElement("td");f.innerText=n.DienTich+""||"0";var v=document.createElement("td");if(n.ThoiGianBatDauTrong){var m=new Date(n.ThoiGianBatDauTrong);v.innerText=m.getDate()+"/"+(m.getMonth()+1)+"/"+m.getFullYear()}var g=document.createElement("td");if(n.ThoiGianTrongTrot){var y=new Date(n.ThoiGianTrongTrot);g.innerText=y.getDate()+"/"+(y.getMonth()+1)+"/"+y.getFullYear()}var T=document.createElement("td");T.innerText=n.GiaiDoanSinhTruong,i.appendChild(r),i.appendChild(l),i.appendChild(f),i.appendChild(v),i.appendChild(g),i.appendChild(T)},c=!0,d=!1,p=void 0;try{for(var f,v=s[Symbol.iterator]();!(c=(f=v.next()).done);c=!0){var m=u(f.value);if("object"===(void 0===m?"undefined":a(m)))return m.v}}catch(e){d=!0,p=e}finally{try{!c&&v.return&&v.return()}finally{if(d)throw p}}h.modal("ttModal","Thời gian trồng trọt",i).modal()}else n.update("type","danger"),n.update("message","Không tìm thấy dữ liệu"),n.update("progress",100)})}},{key:"selectFeature",get:function(){return this.view.popup.viewModel.selectedFeature}},{key:"layer",get:function(){return this.selectFeature.layer}},{key:"attributes",get:function(){return this.selectFeature.attributes}},{key:"objectId",get:function(){return this.attributes.OBJECTID}}]),e}()}.apply(t,i))||(e.exports=r)},function(e,t,n){"use strict";var i,r,a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();i=[n(0),n(1),n(32),n(31),n(7)],void 0===(r=function(e,t,n,i,r){return function(){function n(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};for(var i in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.view=e,this.options={position:"top-left",icon:"esri-icon-user",title:"Người dùng"},t)this.options[i]=t[i];this.isStartup=!1}return a(n,[{key:"startup",value:function(){this.user&&(this.isStartup||(this.initView(),this.view.ui.add(this.expand,this.options.position),this.isStartup=!0))}},{key:"destroy",value:function(){this.isStartup&&(this.view.ui.remove(this.expand),delete this.DOM,delete this.expand,this.isStartup=!1)}},{key:"initView",value:function(){var n=this;try{this.DOM={},this.DOM.container=t.create("div",{class:"esri-widget ditagis-widget-user"}),this.DOM.ul=t.create("ul",{},this.DOM.container),t.create("li",{class:"title",innerHTML:this.user.displayName},this.DOM.ul),this.DOM.infoLi=t.create("li",{class:"item"},this.DOM.ul),this.DOM.infoDiv=t.create("div",{class:"container info"},this.DOM.infoLi),this.DOM.setting=t.create("button",{class:"dtg-btn-widget setting",innerHTML:"Cập nhật tài khoản"},this.DOM.infoDiv),e(this.DOM.setting,"click",function(){return n.settingUserClickHandler()}),this.DOM.btnLogout=t.create("button",{class:"dtg-btn-widget btn-logout",innerHTML:"Đăng xuất"},this.DOM.infoDiv),e(this.DOM.btnLogout,"click",function(){return n.logoutClickHandler()}),this.expand=new r({expandIconClass:this.options.icon,expandTooltip:this.options.title,view:this.view,content:this.DOM.container})}catch(e){console.log(e)}}},{key:"logoutClickHandler",value:function(){location.href="/account/logout"}},{key:"successLogout",value:function(){}},{key:"failLogout",value:function(){}},{key:"settingUserClickHandler",value:function(){}},{key:"user",get:function(){return this.view.systemVariable.user}}]),n}()}.apply(t,i))||(e.exports=r)},function(e,t){e.exports=G},function(e,t){e.exports=F},function(e,t,n){"use strict";var i,r,a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();i=[n,t,n(43),n(30),n(5)],void 0===(r=function(e,t,n,i,r){return function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.systemVariable=new i,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n),a(t,[{key:"session",value:function(){var e=this;return new Promise(function(t,n){r("/map",{method:"post"}).then(function(n){e.systemVariable.user=n.data,t(n.data)})})}}]),t}()}.apply(t,i))||(e.exports=r)},,function(e,t,n){"use strict";var i,r,a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();i=[n,t,n(1),n(42)],void 0===(r=function(e,t,n,i){return function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.container=n.toDom('<div class="dtg-tooltip-map"></div>'),i.set(this.container,{position:"fixed"})}return a(e,[{key:"show",value:function(e,t){i.set(this.container,{left:e[0]+30+"px",top:e[1]+"px"}),this.container.innerHTML=t,document.body.contains(this.container)||document.body.appendChild(this.container)}},{key:"hide",value:function(){document.body.contains(this.container)&&document.body.removeChild(this.container)}}],[{key:"instance",value:function(){return this._instance||(this._instance=new e),this._instance}}]),e}()}.apply(t,i))||(e.exports=r)},function(e,t,n){"use strict";var i,r,a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var o=function(e,t,n,i){return new(n||(n=Promise))(function(r,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(o,s)}l((i=i.apply(e,t||[])).next())})};i=[n,t,n(34),n(2)],void 0===(r=function(e,t,n,i){return function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t&&(this.view=t)}return a(e,[{key:"draw",value:function(e,t){return o(this,void 0,void 0,regeneratorRuntime.mark(function r(){var a,s,l,u,c,d,h,p,f=this;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(a=$.notify({title:"<strong>Cập nhật đối tượng</strong>",message:"Đang cập nhật..."},{showProgressbar:!0,delay:2e4}),s={},e.drawingAttributes)for(l in e.drawingAttributes)s[l]=e.drawingAttributes[l];return e.id===i.SAUBENH&&(s.NgayXayRa=(new Date).getTime()),a.update("type","info"),a.update("message","Đang lấy thông tin người cập nhật..."),a.update("progress",10),r.next=9,n.getCreatedInfo(this.view);case 9:for(c in u=r.sent)s[c]=u[c];return a.update("type","info"),a.update("message","Lấy thông tin người cập nhật thành công"),a.update("progress",20),a.update("type","info"),a.update("message","Đang lấy vị trí...!"),a.update("progress",30),r.next=19,n.getLocationInfo(this.view,t.geometry);case 19:if(d=r.sent){r.next=27;break}return a.update("type","danger"),a.update("message","Không xác định được vị trí"),a.update("progress",90),r.abrupt("return");case 27:for(h in a.update("type","info"),a.update("message","Lấy vị trí thành công!"),a.update("progress",80),d)s[h]=d[h];t.attributes=s,p={addFeatures:[t]},e.applyEdits(p).then(function(r){return o(f,void 0,void 0,regeneratorRuntime.mark(function o(){var s,l,u,c,d,h,p,f=this;return regeneratorRuntime.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(!(r.addFeatureResults.length>0)){o.next=27;break}s=regeneratorRuntime.mark(function r(o){var s,l,u;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(s={objectId:o.objectId},e.id!==i.SAUBENH){r.next=9;break}return a.update("type","info"),a.update("message","Đang lấy thông tin cây trồng!"),a.update("progress",60),r.next=7,n.getNhomCayTrong(f.view,t.geometry);case 7:if(l=r.sent)for(u in a.update("type","info"),a.update("message","Lấy thông tin cây trồng thành công"),a.update("progress",80),l)s[u]=l[u];else a.update("type","danger"),a.update("message","Lấy thông tin cây trồng thất bại"),a.update("progress",80);case 9:e.applyEdits({updateFeatures:[{attributes:s}]}).then(function(t){t.updateFeatureResults[0].error?(a.update("type","danger"),Promise.reject("err")):(Promise.resolve(),a.update("type","success"),a.update("message","Cập nhật vị trí thành công!"),a.update("progress",100),e.queryFeatures({returnGeometry:!0,spatialReference:f.view.spatialReference,where:"OBJECTID = "+o.objectId,outFields:["*"]}).then(function(e){if(e.features[0]){var t=e.features[0];f.view.popup.open({features:[t],updateLocationEnabled:!0})}}))});case 10:case"end":return r.stop()}},r,f)}),l=!0,u=!1,c=void 0,o.prev=5,d=r.addFeatureResults[Symbol.iterator]();case 7:if(l=(h=d.next()).done){o.next=13;break}return p=h.value,o.delegateYield(s(p),"t0",10);case 10:l=!0,o.next=7;break;case 13:o.next=19;break;case 15:o.prev=15,o.t1=o.catch(5),u=!0,c=o.t1;case 19:o.prev=19,o.prev=20,!l&&d.return&&d.return();case 22:if(o.prev=22,!u){o.next=25;break}throw c;case 25:return o.finish(22);case 26:return o.finish(19);case 27:case"end":return o.stop()}},o,this,[[5,15,19,27],[20,,22,26]])}))});case 34:case"end":return r.stop()}},r,this)}))}},{key:"layer",get:function(){return this._layer},set:function(e){this._layer=e}}]),e}()}.apply(t,i))||(e.exports=r)},function(e,t,n){"use strict";var i,r,a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();i=[n(0),n(1),n(32),n(31),n(7),n(26),n(59)],void 0===(r=function(e,t,n,i,r,o,s){return function(){function n(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};for(var r in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.view=e,this.systemVariable=e.systemVariable,this.options={position:"top-right",icon:"esri-icon-layers",title:"Biên tập dữ liệu"},i)this.options[r]=i[r];this.isStartup=!1,this.eventListener=new o(this),this.initView(),this.drawManager=new s(this.view),this.drawManager.on("draw-finish",function(e){t.eventListener.fire("draw-finish",e)})}return a(n,[{key:"startup",value:function(){var e=this;this.isStartup||(this.keydownEvent=this.view.on("key-down",function(t){"p"===t.key&&e.expand.toggle()}),this.view.ui.add(this.expand,this.options.position),this.isStartup=!0)}},{key:"destroy",value:function(){this.isStartup&&(this.keydownEvent&&this.keydownEvent.remove(),this.drawManager.clearEvents(),this.view.ui.remove(this.expand),this.isStartup=!1)}},{key:"initView",value:function(){var n=this;try{this.container=t.create("div",{class:"esri-widget ditagis-widget-layer-editor"});var i=t.create("ul",null,this.container);this.view.map.layers.map(function(r){r.then(function(){if("feature"==r.type){var a=r.permission;if(a&&a.create){var o=r.renderer.symbol||r.renderer.uniqueValueInfos[0].symbol,s=[];if(t.create("li",{innerHTML:r.title,class:"title"},i),r.renderer.symbol){var l=o.url,u=void 0;u=l?"<img src='"+l+"'></img>":'<svg overflow="hidden" width="30" height="30" style="touch-action: none;">\n                                    <path \n                                    fill="none" \n                                    fill-opacity="0" \n                                    stroke="rgb('+o.color.r+", "+o.color.g+","+o.color.b+')" \n                                    stroke-opacity="1" \n                                    stroke-width="1.3333333333333333" \n                                    path="M -15,0 L 15,0 E" d="M-15 0L 15 0" \n                                   transform="matrix(1.00000000,0.00000000,0.00000000,1.00000000,15.00000000,15.00000000)">\n                                   </path>\n                                   </svg>',s.push({symbol:u})}else{var c=void 0,d=!0,h=!1,p=void 0;try{for(var f,v=r.renderer.uniqueValueInfos[Symbol.iterator]();!(d=(f=v.next()).done);d=!0){var m=f.value,g=m.symbol;if("simple-marker-symbol"===g.type)c='<svg overflow="hidden" width="30" height="30" style="touch-action: none;">\n                                    <circle fill="rgb('+g.color.r+", "+g.color.g+","+g.color.b+')" \n                                    fill-opacity="1" \n                                    stroke="rgb(0, 0, 0)" \n                                    stroke-opacity="1" \n                                    stroke-width="1.3333333333333333" \n                                    x="0" cy="0" r="2.6666666666666665" \n                                    transform="matrix(1.00000000,0.00000000,0.00000000,1.00000000,15.00000000,15.00000000)">\n                                    </circle>\n                                    </svg>';else if("simple-line-symbol"===g.type)c='<svg overflow="hidden" width="30" height="30" style="touch-action: none;">\n                                    <path \n                                    fill="none" \n                                    fill-opacity="0" \n                                    stroke="rgb('+g.color.r+", "+g.color.g+","+g.color.b+')" \n                                    stroke-opacity="1" \n                                    stroke-width="1.3333333333333333" \n                                    path="M -15,0 L 15,0 E" d="M-15 0L 15 0" \n                                   transform="matrix(1.00000000,0.00000000,0.00000000,1.00000000,15.00000000,15.00000000)">\n                                   </path>\n                                   </svg>';else{c="<img src='"+g.url+"'></img>"}s.push({symbol:c,label:m.label,value:m.value})}}catch(e){h=!0,p=e}finally{try{!d&&v.return&&v.return()}finally{if(h)throw p}}}var y=function(a){var o=a.symbol,s=a.label,l=a.value,u=t.create("li",{class:"list-item"},i),c=t.create("div",{class:"item-container"},u);t.create("div",{innerHTML:o},c);s&&t.create("div",{innerHTML:s,class:"icon-label"},c),e(u,"click",function(e){n.layerItemClickHandler(r,l)})},T=!0,b=!1,w=void 0;try{for(var D,C=s[Symbol.iterator]();!(T=(D=C.next()).done);T=!0){y(D.value)}}catch(e){b=!0,w=e}finally{try{!T&&C.return&&C.return()}finally{if(b)throw w}}}}})}),this.expand=new r({expandIconClass:this.options.icon,expandTooltip:this.options.title,view:this.view,content:this.container})}catch(e){throw e}}},{key:"layerItemClickHandler",value:function(e,t){try{var n=e.renderer.field||e.typeIdField;switch(t&&(e.drawingAttributes={},e.drawingAttributes[n]=t),this.selectedFeature=e,e.geometryType){case"point":this.drawManager.drawSimple();break;default:console.log("Chưa được liệt kê")}this.expand.expanded=!1}catch(e){console.log(e)}}},{key:"selectedFeature",get:function(){return this.systemVariable.selectedFeature},set:function(e){this.drawManager.drawLayer=e,this.systemVariable.selectedFeature=e}}]),n}()}.apply(t,i))||(e.exports=r)},function(e,t,n){"use strict";var i,r,a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();i=[n,t,n(0),n(1),n(7)],void 0===(r=function(e,t,n,i,r){return function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.number=0,this.view=t.view,this.options={position:"top-left",icon:"esri-icon-documentation",title:"Lịch sử thao tác dữ liệu"},this.initView(),this.view.ui.add(this.expand,this.options.position)}return a(e,[{key:"initView",value:function(){var e=i.create("div",{class:"editor-history-widget"}),t=i.create("div",{class:"results-container"},e);this.ul=i.create("ul",{class:"list-group",innerHTML:"<li class='list-group-item'><strong>Chưa có dữ liệu</strong></li>"},t),this.expand=new r({expandIconClass:this.options.icon,expandTooltip:this.options.title,view:this.view,content:e})}},{key:"add",value:function(e){var t=this;0===this.number&&(this.ul.innerHTML="");var r=i.create("li",{class:"list-group-item"},this.ul);this.number++;var a=this.number/10<1?"0"+this.number:this.number,o=new Date,s=o.getHours()+":"+o.getMinutes()+":"+o.getSeconds();r.innerHTML='<div class="row">\n        <div class="col-1">\n        <span class="number">'+a+'</span></div>\n        <div class="col-2">\n        <strong class="name">'+e.layerName+"</strong>\n        <p>Thời gian: "+s+"</p></div></div>",e.geometry&&n(r,"click",function(n){t.view.goTo(e.geometry)})}}]),e}()}.apply(t,i))||(e.exports=r)},function(e,t,n){"use strict";var i,r,a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();i=[n,t,n(29)],void 0===(r=function(e,t,n){return function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return a(e,null,[{key:"modal",value:function(e,t,i,r){try{var a=n.getBox().w+"px",o=void 0,s=void 0,l=void 0,u=void 0,c=void 0,d=void 0;(o=document.createElement("div")).classList.add("modal","fade"),o.id=e,o.setAttribute("tabindex","-1"),o.setAttribute("role","dialog"),o.setAttribute("aria-labelledby","myModalLabel"),o.setAttribute("aria-hidden","true"),(s=document.createElement("div")).classList.add("modal-dialog"),(l=document.createElement("div")).classList.add("modal-content"),l.style.maxWidth=a,l.style.width="fit-content",(u=document.createElement("div")).classList.add("modal-header");var h=document.createElement("button");h.type="button",h.classList.add("close"),h.setAttribute("data-dismiss","modal"),h.innerHTML='<span aria-hidden="true">×</span><span class="sr-only">Đóng</span>',u.appendChild(h),u.innerHTML+='<h4 class="modal-title">'+t+"</h4>",(c=document.createElement("div")).classList.add("modal-body"),c.appendChild(i),r&&((d=document.createElement("div")).classList.add("modal-footer"),d.appendChild(r)),l.appendChild(u),l.appendChild(c),d&&l.appendChild(d),s.appendChild(l),o.appendChild(s),document.body.appendChild(o);var p=$("#"+e);return p?(p.on("hidden.bs.modal",function(){p.remove()}),p):null}catch(e){throw e}}}]),e}()}.apply(t,i))||(e.exports=r)},function(e,t,n){"use strict";var i,r,a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();i=[n,t,n(12),n(2),n(28),n(8),n(4),n(3),n(36),n(10)],void 0===(r=function(e,t,n,i,r,o,s,l,u,c){var d=new s({outline:new l({color:new c("red")})});return function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mergeGraphics=new u,this.unionGraphic=null,this.mainGraphic=null,this.view=t.view,this.layer=t.layer,this.initWnd(),this.graphicLayers=new r({listMode:"hide"})}return a(e,[{key:"initWnd",value:function(){var e=document.createElement("div");e.id="dtg-wget-split-polygon",e.classList.add("esri-widget","esri-widget-button","esri-icon-close-circled"),e.title="Hủy",e.addEventListener("click",this.clear.bind(this)),this.widgetContainer=e}},{key:"run",value:function(e){var t=this;this.mainGraphic=e,this.isRun=!0,this.graphicLayers.removeAll(),this.mergeGraphics.add(e),this.graphicLayers.add(new o({geometry:e.geometry,symbol:d})),this.view.map.add(this.graphicLayers),this.clickHandler=this.view.on("click",function(n){n.stopPropagation(),t.view.hitTest({x:n.x,y:n.y}).then(function(n){if(n.results.length>0){var r=n.results.find(function(e){return e.graphic.layer.id===i.TRONGTROT});if(r){if(r.graphic===e)return;t.mergeGraphics.some(function(e){return e===r.graphic})?t.remove(r.graphic):t.add(r.graphic)}}})}),this.dblClickHandler=this.view.on("double-click",this.dblClickHandlerEvent.bind(this))}},{key:"add",value:function(e){this.graphicLayers.removeAll(),this.mergeGraphics.add(e);var t=n.union(this.mergeGraphics.map(function(e){return e.geometry}).toArray());return this.graphicLayers.add(new o({geometry:t,symbol:d})),this.unionGraphic=t,t}},{key:"remove",value:function(e){this.graphicLayers.removeAll(),this.mergeGraphics.remove(e);var t=n.union(this.mergeGraphics.map(function(e){return e.geometry}).toArray());return this.graphicLayers.add(new o({geometry:t,symbol:d})),this.unionGraphic=t,t}},{key:"dblClickHandlerEvent",value:function(e){if(e.stopPropagation(),confirm("Có chắc chắn ghép thửa?")){var t=this.mergeGraphics.slice(1,this.mergeGraphics.length).map(function(e){return{objectId:e.attributes.OBJECTID}}).toArray(),n=this.mainGraphic.clone();n.geometry=this.unionGraphic,this.layer.applyEdits({updateFeatures:[n],deleteFeatures:t})}this.clear()}},{key:"clear",value:function(){this.view.ui.remove(this.widgetContainer),this.mainGraphic=null,this.clickHandler&&(this.clickHandler.remove(),delete this.clickHandler),this.graphicLayers.removeAll(),this.view.map.remove(this.graphicLayers),this.mergeGraphics.removeAll(),this.dblClickHandler&&(this.dblClickHandler.remove(),delete this.dblClickHandler)}},{key:"isRun",get:function(){return this._isRun},set:function(e){e?this.view.ui.add(this.widgetContainer,"top-right"):this.clear(),this._isRun=e}}]),e}()}.apply(t,i))||(e.exports=r)},function(e,t,n){"use strict";var i,r,a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var o=function(e,t,n,i){return new(n||(n=Promise))(function(r,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(o,s)}l((i=i.apply(e,t||[])).next())})};i=[n,t,n(1),n(0),n(46),n(27),n(4),n(3),n(10),n(8),n(38),n(37),n(12)],void 0===(r=function(e,t,n,i,r,s,l,u,c,d,h,p,f){return function(){function e(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.view=t,this.options={position:"top-right",icon:"esri-widget esri-widget-button esri-icon-basemap",icon_cancel:"esri-widget esri-widget-button esri-icon-close-circled",title:"Chia thửa",tooltip:{move:"Nhấn để vẽ đường chia thửa"}},this.initView()}return a(e,[{key:"startup",value:function(e,t){var n=this;this.selectedFeature=e,this.layer=t,this.hightlightGraphic.clear(),this.hightlightGraphic.add(e),this.add_dtg_wget_cancel(),this.clickEvent=i(this.view,"click",function(e){n.clickHandler(e)}),this.pointerMoveEvent=i(this.view,"pointer-move",function(e){r.instance().show([e.x,e.y],n.options.tooltip.move),n.pointerMoveHandler(e)}),this.dblClickHandler=i(this.view,"double-click",function(e){e.stopPropagation(),n.finish(e)})}},{key:"pointerMoveHandler",value:function(e){e.stopPropagation();var t={x:e.x,y:e.y},n=this.view.toMap(t),i=[n.x,n.y],r=[];if(this.vertices.length>0){var a=!0,o=!1,s=void 0;try{for(var l,u=this.vertices[Symbol.iterator]();!(a=(l=u.next()).done);a=!0){var c=l.value;r.push(c)}}catch(e){o=!0,s=e}finally{try{!a&&u.return&&u.return()}finally{if(o)throw s}}}r.push(i),this.refreshMainGraphic(r)}},{key:"finish",value:function(e){var t={x:e.x,y:e.y},n=this.view.toMap(t),i=[n.x,n.y];this.vertices.push(i),this.refreshMainGraphic(this.vertices),this.xuly(),this.clearEvent()}},{key:"xuly",value:function(){return o(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t,n,i,r,a,o,s,l,u,c,v,m,g,y,T,b,w,D,C,x,E,k;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!confirm("Có chắc chắn tách thửa?")){e.next=39;break}t=this.selectedFeature.attributes,n=this.selectedFeature.geometry,i=new h({paths:this.vertices,spatialReference:this.view.spatialReference}),r=f.cut(n,i),a=[],e.t0=regeneratorRuntime.keys(r);case 7:if((e.t1=e.t0()).done){e.next=31;break}for(o=e.t1.value,s=r[o],l=!0,u=!1,c=void 0,e.prev=13,v=s.rings[Symbol.iterator]();!(l=(m=v.next()).done);l=!0)g=m.value,a.push(g);e.next=21;break;case 17:e.prev=17,e.t2=e.catch(13),u=!0,c=e.t2;case 21:e.prev=21,e.prev=22,!l&&v.return&&v.return();case 24:if(e.prev=24,!u){e.next=27;break}throw c;case 27:return e.finish(24);case 28:return e.finish(21);case 29:e.next=7;break;case 31:return e.next=33,this.taoMaDoiTuong();case 33:for(y=e.sent,T=[],b=[],w=0;w<a.length;w++)D=new p({rings:a[w],spatialReference:this.view.spatialReference}),0==w?(C=new d({geometry:D,attributes:t}),T.push(C)):((x={}).LoaiCayTrong=t.LoaiCayTrong,x.OBJECTID=t.OBJECTID,x.MaHuyenTP=t.MaHuyenTP,x.NhomCayTrong=t.NhomCayTrong,x.MaDoiTuong=t.MaDoiTuong+"_"+(y+w),E=new d({geometry:D,attributes:x}),b.push(E));k={updateFeatures:T,addFeatures:b},this.layer.applyEdits(k),this.vertices=[];case 39:case"end":return e.stop()}},e,this,[[13,17,21,29],[22,,24,28]])}))}},{key:"taoMaDoiTuong",value:function(){return o(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t,n,i,r,a,o,s,l,u,c,d,h,p,f,v;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.selectedFeature.attributes.MaDoiTuong,n=t.split("_"),i=n.length,(r=this.layer.createQuery()).outFields=["MaDoiTuong"],r.where="MaDoiTuong like '"+t+"[_]%'",e.next=8,this.layer.queryFeatures(r);case 8:for(a=e.sent,o=0,s=!0,l=!1,u=void 0,e.prev=13,c=a.features[Symbol.iterator]();!(s=(d=c.next()).done);s=!0)h=d.value,(p=h.attributes.MaDoiTuong)&&(f=p.split("_"),(v=parseInt(f[i]))>o&&(o=v));e.next=21;break;case 17:e.prev=17,e.t0=e.catch(13),l=!0,u=e.t0;case 21:e.prev=21,e.prev=22,!s&&c.return&&c.return();case 24:if(e.prev=24,!l){e.next=27;break}throw u;case 27:return e.finish(24);case 28:return e.finish(21);case 29:return e.abrupt("return",o);case 30:case"end":return e.stop()}},e,this,[[13,17,21,29],[22,,24,28]])}))}},{key:"add_dtg_wget_cancel",value:function(){this.view.ui.add(this.DOM.cancel_wget,this.options.position)}},{key:"initView",value:function(){var e=this;try{this.vertices=[],this.hightlightGraphic=new s(this.view,{symbolPlg:new l({style:"none",outline:new u({color:new c("#0000ff"),width:1})})}),this.DOM={},this.DOM.cancel_wget=n.create("div",{id:"dtg-wget-split-polygon",class:this.options.icon_cancel,title:"Hủy"}),i(this.DOM.cancel_wget,"click",function(t){e.clearEvent()})}catch(e){throw e}}},{key:"clickHandler",value:function(e){e.stopPropagation();var t={x:e.x,y:e.y},n=this.view.toMap(t),i=[n.x,n.y];this.vertices.push(i),this.refreshMainGraphic(this.vertices)}},{key:"refreshMainGraphic",value:function(e){try{if(this.graphic&&(this.view.graphics.remove(this.graphic),this.graphic=null),e){var t=new h({paths:e,spatialReference:this.view.spatialReference});this.graphic=new d({geometry:t,symbol:new u({color:new c([255,0,0]),width:1})}),this.view.graphics.add(this.graphic)}}catch(e){console.log(e)}}},{key:"clearEvent",value:function(){this.clickEvent&&(this.clickEvent.remove(),this.clickEvent=null),this.pointerMoveEvent&&(r.instance().hide(),this.pointerMoveEvent.remove(),this.pointerMoveEvent=null),this.dblClickHandler&&(this.dblClickHandler.remove(),this.dblClickHandler=null),this.view.ui.remove(this.DOM.cancel_wget),this.vertices=[],this.hightlightGraphic.clear(),this.graphic&&(this.view.graphics.remove(this.graphic),this.graphic=null)}}]),e}()}.apply(t,i))||(e.exports=r)},function(e,t,n){"use strict";var i,r=function(e,t,n,i){return new(n||(n=Promise))(function(r,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(o,s)}l((i=i.apply(e,t||[])).next())})};void 0===(i=function(e,t){var n=this;return{themTGSXTT:function(e){return r(n,void 0,void 0,regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch("/trongtrot/thoigian/add",{body:JSON.stringify(e[0])});case 3:return n=t.sent,t.abrupt("return",n);case 7:throw t.prev=7,t.t0=t.catch(0),t.t0;case 10:case"end":return t.stop()}},t,this,[[0,7]])}))}}}.apply(t,[n,t]))||(e.exports=i)},function(e,t,n){"use strict";var i,r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();void 0===(i=function(e,t){return function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.date=t}return r(e,[{key:"checkOutOfDate",value:function(e){return!((new Date).getTime()-e>0)}},{key:"checkUnexpired",value:function(e){return!this.checkOutOfDate(e)}}],[{key:"formatDateValue",value:function(e){if(!e)return"";var t=e.getDate(),n=e.getMonth()+1,i=e.getFullYear();return t/10<1&&(t="0"+t),n/10<1&&(n="0"+n),i+"-"+n+"-"+t}},{key:"formatNumberDate",value:function(e){if(!e)return"";var t=new Date(e),n=t.getDate(),i=t.getMonth()+1,r=t.getFullYear();return n/10<1&&(n="0"+n),i/10<1&&(i="0"+i),n+"/"+i+"/"+r}}]),e}()}.apply(t,[n,t]))||(e.exports=i)},function(e,t,n){"use strict";var i,r,a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();i=[n,t,n(29)],void 0===(r=function(e,t,n){return function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return a(e,null,[{key:"modal",value:function(e,t,i,r){try{var a=n.getBox().w+"px",o=void 0,s=void 0,l=void 0,u=void 0,c=void 0,d=void 0;(o=document.createElement("div")).classList.add("modal","fade"),o.id=e,o.setAttribute("tabindex","-1"),o.setAttribute("role","dialog"),o.setAttribute("aria-labelledby","myModalLabel"),o.setAttribute("aria-hidden","true"),(s=document.createElement("div")).classList.add("modal-dialog"),(l=document.createElement("div")).classList.add("modal-content"),l.style.maxWidth=a,l.style.width="fit-content",(u=document.createElement("div")).classList.add("modal-header");var h=document.createElement("button");h.type="button",h.classList.add("close"),h.setAttribute("data-dismiss","modal"),h.innerHTML='<span aria-hidden="true">×</span><span class="sr-only">Đóng</span>',u.appendChild(h),u.innerHTML+='<h4 class="modal-title">'+t+"</h4>",(c=document.createElement("div")).classList.add("modal-body"),c.appendChild(i),r&&((d=document.createElement("div")).classList.add("modal-footer"),d.appendChild(r)),l.appendChild(u),l.appendChild(c),d&&l.appendChild(d),s.appendChild(l),o.appendChild(s),document.body.appendChild(o);var p=$("#"+e);return p?(p.on("hidden.bs.modal",function(){p.remove()}),p):null}catch(e){throw e}}}]),e}()}.apply(t,i))||(e.exports=r)},function(e,t,n){"use strict";var i,r,a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();i=[n,t,n(55),n(54),n(8),n(33),n(0),n(12),n(2),n(11),n(53)],void 0===(r=function(e,t,n,i,r,o,s,l,u,c,d){return function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.view=t.view,this.thoiGianSanXuatTrongTrot=t.table,this.tblGiaiDoanSinhTruong=new o({url:c.tables.find(function(e){return e.id===u.TBL_GIAI_DOAN_SINH_TRUONG}).url,fieldID:"OBJECTID"}),this.dataDetails=[]}return a(e,[{key:"getSubtype",value:function(e,t){if(e=e||this.layer.typeIdField,t=t||this.attributes[e],this.tblGiaiDoanSinhTruong.typeIdField===e){this.tblGiaiDoanSinhTruong.typeIdField;return this.tblGiaiDoanSinhTruong.types.find(function(e){return e.id==t})}return null}},{key:"renderDomain",value:function(e,t){var n=void 0;if("inherited"===e.type){var i=this.layer.getFieldDomain(t);i&&(n=i.codedValues)}else n=e.codedValues;if(!n)return null;var r=this.attributes[t],a=document.createElement("select");a.classList.add("form-control");var o=document.createElement("option");o.value="-1",o.innerText="Chọn giá trị...",a.appendChild(o);var s=!0,l=!1,u=void 0;try{for(var c,d=n[Symbol.iterator]();!(s=(c=d.next()).done);s=!0){var h=c.value,p=h.code,f=h.name,v=document.createElement("option");v.setAttribute("value",p),r===p&&(v.selected=!0),v.innerHTML=f,a.appendChild(v)}}catch(e){l=!0,u=e}finally{try{!s&&d.return&&d.return()}finally{if(l)throw u}}return a}},{key:"addDetailTrongTrot",value:function(){var e=this,t=document.createElement("div"),i=void 0,r=void 0,a=void 0,o=void 0,u=void 0,c=void 0,d=void 0;i=document.createElement("div"),(a=document.createElement("div")).classList.add("form-group");var h=void 0,p=void 0;(p=document.createElement("select")).id="LoaiCayTrong",p.classList.add("form-control"),(h=document.createElement("label")).innerText="Loại cây trồng",h.setAttribute("for",p.id),a.appendChild(h),a.appendChild(p),(r=document.createElement("div")).classList.add("form-group");var f=void 0,v=void 0;(v=document.createElement("select")).id="NhomCayTrong",v.classList.add("form-control");var m=this.layer.getFieldDomain("NhomCayTrong").codedValues,g=!0,y=!1,T=void 0;try{for(var b,w=m[Symbol.iterator]();!(g=(b=w.next()).done);g=!0){var D=b.value,C=D.code,x=D.name,E=document.createElement("option");E.setAttribute("value",C+""),E.innerHTML=x,v.appendChild(E)}}catch(e){y=!0,T=e}finally{try{!g&&w.return&&w.return()}finally{if(y)throw T}}var k=function(){p.innerHTML="";var t=document.createElement("option");t.value="-1",t.innerText="Chọn giá trị...",p.appendChild(t);var n=e.getSubtype("NhomCayTrong",v.value);if(n){var i=n.domains.LoaiCayTrong;if(i){var r=void 0;if("inherited"===i.type){var a=e.layer.getFieldDomain("LoaiCayTrong");a&&(r=a.codedValues)}else r=i.codedValues;if(r){var o=!0,s=!1,l=void 0;try{for(var u,c=r[Symbol.iterator]();!(o=(u=c.next()).done);o=!0){var d=u.value,h=d.code,f=d.name,m=document.createElement("option");m.setAttribute("value",h),m.innerHTML=f,p.appendChild(m)}}catch(e){s=!0,l=e}finally{try{!o&&c.return&&c.return()}finally{if(s)throw l}}}}}};s(v,"change",function(){k()}),k(),(f=document.createElement("label")).innerText="Nhóm cây trồng",f.setAttribute("for",v.id),r.appendChild(f),r.appendChild(v),(o=document.createElement("div")).classList.add("form-group");var L=void 0,M=void 0;if((M=document.createElement("input")).id="DienTich",M.classList.add("form-control"),this.selectFeature.geometry){var N=l.geodesicArea(this.selectFeature.geometry,"square-meters").toFixed(1);M.value=N+""}(L=document.createElement("label")).innerText="Diện tích (m2)",L.setAttribute("for",M.id),o.appendChild(L),o.appendChild(M),(c=document.createElement("div")).classList.add("form-group");var I=void 0,S=void 0;(I=document.createElement("input")).type="date",I.id="ThoiGianTrongTrot",I.classList.add("form-control"),(S=document.createElement("label")).innerText="Thời gian trồng trọt",S.setAttribute("for",I.id),c.appendChild(S),c.appendChild(I),(u=document.createElement("div")).classList.add("form-group");var O=void 0,G=void 0;(O=document.createElement("input")).type="date",O.id="ThoiGianBatDauTrong",O.classList.add("form-control"),(G=document.createElement("label")).innerText="Thời gian bắt đầu trồng",G.setAttribute("for",O.id),u.appendChild(G),u.appendChild(O),(d=document.createElement("button")).classList.add("btn","btn-primary"),d.innerText="Thêm",s(d,"click",function(){var t={OBJECTID:e.tmpDatasDetailTrongTrong.adds.length+1,MaDoiTuong:e.attributes.MaDoiTuong,NhomCayTrong:parseInt(v.value),LoaiCayTrong:-1==p.value?null:p.value,DienTich:M.value?parseFloat(M.value):0,ThoiGianBatDauTrong:O.value?new Date(O.value):null,ThoiGianTrongTrot:I.value?new Date(I.value):O.value?new Date(O.value):null,GiaiDoanSinhTruong:"Trồng mới"},n=(e.tmpDatasDetailTrongTrong.tableDatas,e.tmpDatasDetailTrongTrong.adds),i=!0,r=!1,a=void 0;try{for(var o,s=n[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var l=o.value;if(t.LoaiCayTrong==l.LoaiCayTrong&&t.NhomCayTrong==l.NhomCayTrong&&t.ThoiGianBatDauTrong.getTime()===l.ThoiGianBatDauTrong.getTime())return void alert("Dữ liệu vừa mới thêm - Không được thêm nữa")}}catch(e){r=!0,a=e}finally{try{!i&&s.return&&s.return()}finally{if(r)throw a}}e.tmpDatasDetailTrongTrong.tableDatas.push(t),e.tmpDatasDetailTrongTrong.adds.push(t),e.addDataToDetailTrongtrot(t),$("#ModalDetail").modal("toggle")}),i.appendChild(r),i.appendChild(a),i.appendChild(o),i.appendChild(u),i.appendChild(c),t.appendChild(i);var F=document.createElement("div");F.appendChild(d),n.modal("ModalDetail","Thêm dữ liệu",t,F).modal()}},{key:"editDetailTrongTrot",value:function(e){var t=this,r=document.createElement("div"),a=void 0,o=void 0,l=void 0,u=void 0,c=void 0,d=void 0,h=void 0,p=void 0;a=document.createElement("div"),(l=document.createElement("div")).classList.add("form-group");var f=void 0,v=void 0;(v=document.createElement("select")).classList.add("form-control"),(f=document.createElement("label")).innerText="Loại cây trồng",l.appendChild(f),l.appendChild(v),(o=document.createElement("div")).classList.add("form-group");var m=void 0,g=void 0;(g=document.createElement("select")).classList.add("form-control");var y=this.layer.getFieldDomain("NhomCayTrong").codedValues,T=!0,b=!1,w=void 0;try{for(var D,C=y[Symbol.iterator]();!(T=(D=C.next()).done);T=!0){var x=D.value,E=x.code,k=x.name,L=document.createElement("option");L.setAttribute("value",E+""),L.innerHTML=k,g.appendChild(L)}}catch(e){b=!0,w=e}finally{try{!T&&C.return&&C.return()}finally{if(b)throw w}}g.value=e.NhomCayTrong+"";var M=function(){v.innerHTML="";var e=document.createElement("option");e.value="-1",e.innerText="Chọn giá trị...",v.appendChild(e);var n=t.getSubtype("NhomCayTrong",g.value);if(n){var i=n.domains.LoaiCayTrong;if(i){var r=void 0;if("inherited"===i.type){var a=t.layer.getFieldDomain("LoaiCayTrong");a&&(r=a.codedValues)}else r=i.codedValues;if(r){var o=!0,s=!1,l=void 0;try{for(var u,c=r[Symbol.iterator]();!(o=(u=c.next()).done);o=!0){var d=u.value,h=d.code,p=d.name,f=document.createElement("option");f.setAttribute("value",h),f.innerHTML=p,v.appendChild(f)}}catch(e){s=!0,l=e}finally{try{!o&&c.return&&c.return()}finally{if(s)throw l}}}}}};s(g,"change",function(){M(),A()}),M(),v.value=e.LoaiCayTrong,s(v,"change",function(e){A()}),(m=document.createElement("label")).innerText="Nhóm cây trồng",o.appendChild(m),o.appendChild(g),(u=document.createElement("div")).classList.add("form-group");var N=void 0,I=void 0;(I=document.createElement("input")).type="number",I.value=e.DienTich+"",I.classList.add("form-control"),(N=document.createElement("label")).innerText="Diện tích (m2)",u.appendChild(N),u.appendChild(I),(c=document.createElement("div")).classList.add("form-group");var S=void 0,O=void 0;(S=document.createElement("input")).type="date",S.value=i.formatDateValue(e.ThoiGianTrongTrot),S.classList.add("form-control"),(O=document.createElement("label")).innerText="Thời gian trồng trọt",c.appendChild(O),c.appendChild(S),(d=document.createElement("div")).classList.add("form-group");var G=void 0,F=void 0;(G=document.createElement("input")).type="date",G.value=i.formatDateValue(e.ThoiGianBatDauTrong),G.classList.add("form-control"),(F=document.createElement("label")).innerText="Thời gian bắt đầu trồng",d.appendChild(F),d.appendChild(G),(h=document.createElement("div")).classList.add("form-group");var H=void 0,B=void 0;(H=document.createElement("label")).innerText="Giai đoạn sinh trưởng",(B=document.createElement("select")).classList.add("form-control");var P=document.createElement("option");P.value="Chưa xác định",P.innerText="Chọn giá trị...",P.selected=!0,B.appendChild(P);var A=function(){B.innerHTML="",B.appendChild(P),t.tblGiaiDoanSinhTruong.queryFeatures({where:"NhomCayTrong = "+g.value+" and LoaiCayTrong = '"+v.value+"'",outFields:["GiaiDoanSinhTruong"],orderByFields:["MocTG"]}).then(function(t){t.features.forEach(function(e){var t=e.attributes.GiaiDoanSinhTruong,n=document.createElement("option");n.value=n.innerText=t,B.appendChild(n)}),B.value=e.GiaiDoanSinhTruong})};h.appendChild(H),h.appendChild(B),(p=document.createElement("button")).classList.add("btn","btn-primary"),p.innerText="Chấp nhận",s(p,"click",function(){var n={OBJECTID:e.OBJECTID,NhomCayTrong:parseInt(g.value),LoaiCayTrong:"-1"==v.value?null:v.value,DienTich:I.value?parseFloat(I.value):0,ThoiGianTrongTrot:S.value?new Date(S.value):null,ThoiGianBatDauTrong:G.value?new Date(G.value):null,GiaiDoanSinhTruong:B.value};t.renderEditDetailTrongTrot(n),$("#ModalDetail").modal("toggle")}),a.appendChild(o),a.appendChild(l),a.appendChild(u),a.appendChild(d),a.appendChild(c),a.appendChild(h),r.appendChild(a);var _=document.createElement("div");_.appendChild(p),n.modal("ModalDetail","Sửa dữ liệu",r,_).modal()}},{key:"showTableDetailTrongTrot",value:function(){var e=this,t=$.notify({message:"Đang tai dữ liệu..."},{showProgressbar:!0,delay:2e4,placement:{from:"top",align:"left"}});this.tmpDatasDetailTrongTrong={adds:[],edits:[],deletes:[],tableDatas:[],tbody:null},this.dataDetails=[];var i=document.createElement("div"),r=document.createElement("div");r.classList.add("table-responsive");var a=document.createElement("table");a.classList.add("table"),r.appendChild(a);var o=document.createElement("thead");o.innerHTML="<tr>\n          <th>Nhóm cây trồng</th>\n          <th>Loại cây trồng</th>\n          <th>Diện tích (m2)</th>\n          <th>Thời gian trồng trọt</th>\n          <th>Thời gian bắt đầu trồng</th>\n          <th>Giai đoạn sinh trưởng</th>\n          <th>Tác vụ</th>\n        </tr>",a.appendChild(o);var l=document.createElement("tbody");a.appendChild(l),this.tmpDatasDetailTrongTrong.tbody=l;var u=document.createElement("div"),c=document.createElement("button");c.classList.add("btn","btn-default"),c.innerText="Thêm dữ liệu",s(c,"click",function(){e.addDetailTrongTrot()});var d=document.createElement("button");d.classList.add("btn","btn-primary"),d.innerText="Chấp nhận",s(d,"click",function(){e.submitDetailTrongtrot(e.tmpDatasDetailTrongTrong)});var h=document.createElement("button");h.type="button",h.classList.add("btn","btn-default"),h.setAttribute("data-dismiss","modal"),h.innerText="Đóng",u.appendChild(d),u.appendChild(c),u.appendChild(h),i.appendChild(r),this.thoiGianSanXuatTrongTrot.findById(this.attributes.MaDoiTuong).then(function(r){r.features.length>0&&r.features.forEach(function(t){var n=t.attributes,i={DienTich:n.DienTich,GiaiDoanSinhTruong:n.GiaiDoanSinhTruong,MaDoiTuong:n.MaDoiTuong,LoaiCayTrong:n.LoaiCayTrong,NhomCayTrong:n.NhomCayTrong,OBJECTID:n.OBJECTID};n.ThoiGianBatDauTrong&&(i.ThoiGianBatDauTrong=new Date(n.ThoiGianBatDauTrong)),n.ThoiGianTrongTrot&&(i.ThoiGianTrongTrot=new Date(n.ThoiGianTrongTrot)),e.tmpDatasDetailTrongTrong.tableDatas.push(i),e.dataDetails.push(t.attributes);var r=e.renderDetailTrongtrot(i);l.appendChild(r)});n.modal("ttModal","Thời gian trồng trọt",i,u).modal(),t.update("type","success"),t.update("progress",90)})}},{key:"renderEditDetailTrongTrot",value:function(e){var t=this;try{this.tmpDatasDetailTrongTrong.edits.map(function(n){n.OBJECTID==e.OBJECTID&&t.tmpDatasDetailTrongTrong.edits.splice(t.tmpDatasDetailTrongTrong.edits.indexOf(n))});var n=[];this.tmpDatasDetailTrongTrong.tableDatas.map(function(t){t.OBJECTID==e.OBJECTID?n.push(e):n.push(t)}),this.tmpDatasDetailTrongTrong.tableDatas=n,this.tmpDatasDetailTrongTrong.edits.push(e);var r=this.tmpDatasDetailTrongTrong.tbody.getElementsByTagName("tr"),a=void 0,o=!0,s=!1,l=void 0;try{for(var u,c=r[Symbol.iterator]();!(o=(u=c.next()).done);o=!0){var d=u.value,h=parseInt(d.id);if(h==e.OBJECTID||h==e.ID){a=d;break}}}catch(e){s=!0,l=e}finally{try{!o&&c.return&&c.return()}finally{if(s)throw l}}var p=a.getElementsByTagName("td"),f=p[0],v=p[1],m=p[2],g=p[3],y=p[4],T=p[5],b=this.layer.getFieldDomain("NhomCayTrong").codedValues;if(b){var w=b.find(function(t){return t.code==e.NhomCayTrong});w&&(f.innerText=w.name)}f.innerText||(f.innerText=e.NhomCayTrong+""||"");var D=this.getSubtype("NhomCayTrong",e.NhomCayTrong);if(!D)return;var C=D.domains.LoaiCayTrong;if(C){var x=void 0;if("inherited"===C.type){var E=this.layer.getFieldDomain("LoaiCayTrong");E&&(x=E.codedValues)}else x=C.codedValues;if(x){var k=x.find(function(t){return t.code==e.LoaiCayTrong});k&&(v.innerText=k.name)}}v.innerText||(v.innerText=e.LoaiCayTrong||""),m.innerText=e.DienTich+""||"0",g.innerText=i.formatDateValue(e.ThoiGianTrongTrot),y.innerText=i.formatDateValue(e.ThoiGianBatDauTrong),T.innerText=e.GiaiDoanSinhTruong}catch(e){throw"Có lỗi xảy ra trong quá trình thực hiện"}}},{key:"renderDetailTrongtrot",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{var r=document.createElement("tr");r.id=e.OBJECTID||e.ID,n&&r.classList.add("info");var a=document.createElement("td"),o=this.layer.getFieldDomain("NhomCayTrong").codedValues;if(o){var l=o.find(function(t){return t.code==e.NhomCayTrong});l&&(a.innerText=l.name)}a.innerText||(a.innerText=e.NhomCayTrong+""||"");var u=document.createElement("td"),c=this.getSubtype("NhomCayTrong",e.NhomCayTrong);if(!c)return;var d=c.domains.LoaiCayTrong;if(d){var h=void 0;if("inherited"===d.type){var p=this.layer.getFieldDomain("LoaiCayTrong");p&&(h=p.codedValues)}else h=d.codedValues;if(h){var f=h.find(function(t){return t.code==e.LoaiCayTrong});f&&(u.innerText=f.name)}}u.innerText||(u.innerText=e.LoaiCayTrong||"");var v=document.createElement("td");v.innerText=e.DienTich+""||"0";var m=document.createElement("td");m.innerText=i.formatDateValue(e.ThoiGianTrongTrot);var g=document.createElement("td");g.innerText=i.formatDateValue(e.ThoiGianBatDauTrong);var y=document.createElement("td"),T=document.createElement("td");T.innerText=e.GiaiDoanSinhTruong||"N/A";var b=document.createElement("span");b.classList.add("esri-icon-edit"),s(b,"click",function(n){t.tmpDatasDetailTrongTrong.tableDatas.map(function(n){n.OBJECTID==e.OBJECTID&&t.editDetailTrongTrot(n)})});var w=document.createElement("span");return w.classList.add("esri-icon-trash"),s(w,"click",function(){e.OBJECTID&&(t.tmpDatasDetailTrongTrong.deletes.push(e.OBJECTID),t.tmpDatasDetailTrongTrong.tableDatas.map(function(n){if(n.OBJECTID==e.OBJECTID){var i=t.tmpDatasDetailTrongTrong.tableDatas.indexOf(n);t.tmpDatasDetailTrongTrong.tableDatas.splice(i,1)}})),t.tmpDatasDetailTrongTrong.tbody.removeChild(r);var n=t.tmpDatasDetailTrongTrong.adds.find(function(t){return t.OBJECTID==e.OBJECTID});n&&t.tmpDatasDetailTrongTrong.adds.splice(t.tmpDatasDetailTrongTrong.adds.indexOf(n))}),y.appendChild(b),y.appendChild(w),r.appendChild(a),r.appendChild(u),r.appendChild(v),r.appendChild(m),r.appendChild(g),r.appendChild(T),r.appendChild(y),r}catch(e){throw e}}},{key:"addDataToDetailTrongtrot",value:function(e){var t=this.renderDetailTrongtrot(e,!0);this.tmpDatasDetailTrongTrong.tbody.appendChild(t)}},{key:"submitData",value:function(e){var t,n=[];e.tableDatas.map(function(t){e.adds.some(function(e){return e.OBJECTID==t.OBJECTID})&&n.push(t)}),this.tmpDatasDetailTrongTrong.adds=n,t=e.edits.filter(function(t){return e.adds.indexOf(t)}),this.tmpDatasDetailTrongTrong.edits=t}},{key:"submitDetailTrongtrot",value:function(e){this.submitData(e);var t={addFeatures:[],updateFeatures:[],deleteFeatures:[]};if(e.deletes.length>0&&(t.deleteFeatures=e.deletes),e.adds.length>0){var n=!0,i=!1,r=void 0;try{for(var a,o=e.adds[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value,l={DienTich:s.DienTich,GiaiDoanSinhTruong:s.GiaiDoanSinhTruong,LoaiCayTrong:s.LoaiCayTrong,MaDoiTuong:s.MaDoiTuong,NhomCayTrong:s.NhomCayTrong,ThoiGianBatDauTrong:s.ThoiGianBatDauTrong&&s.ThoiGianBatDauTrong.getTime(),ThoiGianTrongTrot:s.ThoiGianTrongTrot?s.ThoiGianTrongTrot.getTime():s.ThoiGianBatDauTrong?s.ThoiGianBatDauTrong.getTime():null};d.themTGSXTT([l])}}catch(e){i=!0,r=e}finally{try{!n&&o.return&&o.return()}finally{if(i)throw r}}}if(e.edits.length>0){var u=!0,c=!1,h=void 0;try{for(var p,f=e.edits[Symbol.iterator]();!(u=(p=f.next()).done);u=!0){var v=p.value,m={DienTich:v.DienTich,GiaiDoanSinhTruong:v.GiaiDoanSinhTruong,LoaiCayTrong:v.LoaiCayTrong,MaDoiTuong:v.MaDoiTuong,NhomCayTrong:v.NhomCayTrong,OBJECTID:v.OBJECTID};v.ThoiGianBatDauTrong&&(m.ThoiGianBatDauTrong=v.ThoiGianBatDauTrong.getTime()),v.ThoiGianTrongTrot&&(m.ThoiGianTrongTrot=v.ThoiGianTrongTrot.getTime()),t.updateFeatures.push({attributes:m})}}catch(e){c=!0,h=e}finally{try{!u&&f.return&&f.return()}finally{if(c)throw h}}}$("#ttModal").modal("toggle")}},{key:"refreshNhomCayTrong",value:function(e,t){var n=this;if(0!==t.length){var i=e.filter(function(e){return e.NhomCayTrong===n.attributes.NhomCayTrong}),a=!1;if(i.length>0){var o={};for(var s in i.forEach(function(e){var t=e.ThoiGianBatDauTrong;o[t]||(o[t]=[]),o[t].push(e.GiaiDoanSinhTruong)}),o){if(-1!==o[s].indexOf("Thu hoạch")){a=!0;break}}}else a=!0;if(a){var l=t[0];this.layer.applyEdits({updateFeatures:[new r({attributes:{OBJECTID:this.attributes.OBJECTID,NhomCayTrong:l.NhomCayTrong}})]})}}}},{key:"selectFeature",get:function(){return this.view.popup.viewModel.selectedFeature}},{key:"layer",get:function(){return this.view.map.findLayerById(u.TRONGTROT)}},{key:"attributes",get:function(){return this.selectFeature.attributes}}]),e}()}.apply(t,i))||(e.exports=r)},function(e,t,n){"use strict";var i,r,a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();i=[n,t,n(2),n(11),n(0),n(1),n(5),n(35),n(39),n(34),n(56),n(33),n(52),n(51)],void 0===(r=function(e,t,n,i,r,o,s,l,u,c,d,h,p,f){return function(){function e(t,r){var a=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.view=t,this.options=r,this.locateViewModel=new u({view:t,graphic:null}),this.tblGiaiDoanSinhTruong=new h({url:i.tables.find(function(e){return e.id===n.TBL_GIAI_DOAN_SINH_TRUONG}).url,fieldID:"OBJECTID"}),this.fireFields=["NgayCapNhat","NguoiCapNhat","MaPhuongXa","MaHuyenTP","MaDoiTuong"],this.inputElement={},this.thoiGianSanXuatTrongTrotPopup=new d({view:t,table:r.table}),this.thoiGianSanXuatTrongTrotTbl=r.table,"/congtacvien"!==location.pathname&&(this._splitPolygon=new p(t),this.view.on("layerview-create",function(e){e.layer.id===n.TRONGTROT&&(a._mergePolygon=new f({view:t,layer:e.layer}))}))}return a(e,[{key:"resetInputElement",value:function(){this.inputElement={}}},{key:"isFireField",value:function(e){return-1!==this.fireFields.indexOf(e)}},{key:"getSubtype",value:function(e,t){if(e=e||this.layer.typeIdField,t=t||this.attributes[e],this.tblGiaiDoanSinhTruong.typeIdField===e){this.tblGiaiDoanSinhTruong.typeIdField;return this.tblGiaiDoanSinhTruong.types.find(function(e){return e.id==t})}return null}},{key:"renderDomain",value:function(e,t){var n=void 0;if("inherited"===e.type){var i=this.layer.getFieldDomain(t);i&&(n=i.codedValues)}else n=e.codedValues;if(!n)return null;var r=this.attributes[t],a=document.createElement("select");a.classList.add("form-control");var o=document.createElement("option");o.value="-1",o.innerText="Chọn giá trị...",a.appendChild(o);var s=!0,l=!1,u=void 0;try{for(var c,d=n[Symbol.iterator]();!(s=(c=d.next()).done);s=!0){var h=c.value,p=h.code,f=h.name,v=document.createElement("option");v.setAttribute("value",p),r===p&&(v.selected=!0),v.innerHTML=f,a.appendChild(v)}}catch(e){l=!0,u=e}finally{try{!s&&d.return&&d.return()}finally{if(l)throw u}}return a}},{key:"showEdit",value:function(){var e=this,t=this.getSubtype();this.resetInputElement();var i=o.create("div",{id:"show-edit-container",class:"popup-content"}),r=o.create("table",{class:"table"},i),a=!0,s=!1,u=void 0;try{for(var c,d=this.layer.fields[Symbol.iterator]();!(a=(c=d.next()).done);a=!0){var h=c.value;if("oid"!==h.type&&!this.isFireField(h.name)){var p=o.create("tr"),f=o.create("td",{innerHTML:h.alias}),v=void 0,m=o.create("td");if(t&&t.domains[h.name])v=this.renderDomain(t.domains[h.name],h.name);else if(h.domain)v=this.renderDomain(h.domain,h.name);else{var g=void 0,y=void 0;if("small-integer"===h.type||"integer"===h.type||"double"===h.type)g="number";else if("date"===h.type){g="date";var T=new Date(this.attributes[h.name]),b=T.getDate(),w=T.getMonth()+1,D=T.getFullYear();b/10<1&&(b="0"+b),w/10<1&&(w="0"+w),y=D+"-"+w+"-"+b}else g="text";v=length>=this.options.hightLength?o.create("textarea",{rows:5,cols:25,class:"form-control",innerHTML:y||this.attributes[h.name],value:y||this.attributes[h.name]}):o.create("input",{type:g,value:y||this.attributes[h.name],class:"form-control"})}v.name=h.name,o.place(v,m),o.place(f,p),o.place(m,p),o.place(p,r),this.inputElement[h.name]=v,this.registerChangeEvent(v)}}}catch(e){s=!0,u=e}finally{try{!a&&d.return&&d.return()}finally{if(s)throw u}}for(var C in this.layer.hasAttachments&&this.layer.getAttachments(this.objectId).then(function(t){var n=o.create("div",{class:"attachment-header",id:"attachment-"+e.layer.id+"-"+e.attributes.OBJECTID},document.getElementById("show-edit-container"));n.innerText="Hình ảnh";var i=document.createElement("form");i.id="attachment-data",i.enctype="multipart/form-data",i.method="post";var r=document.createElement("input");r.type="file",r.name="attachment",i.appendChild(r);var a=document.createElement("input");if(a.hidden=!0,a.name="f",a.value="json",i.appendChild(a),n.appendChild(i),e.registerChangeEvent(r),t&&t.attachmentInfos&&t.attachmentInfos.length>0){var s=!0,l=!1,u=void 0;try{for(var c,d=t.attachmentInfos[Symbol.iterator]();!(s=(c=d.next()).done);s=!0){var h=c.value;e.renderAttachmentEditPopup(h,{container:n})}}catch(e){l=!0,u=e}finally{try{!s&&d.return&&d.return()}finally{if(l)throw u}}}}),this.inputElement)this.inputChangeHandler(this.inputElement[C]);this.view.popup.content=i,this.view.popup.title=this.layer.title;var x=this.view.popup.actions.find(function(e){return"update"===e.id});x.className="esri-icon-check-mark",this.view.popup.actions.add({id:"update-geometry",title:"Cập nhật vị trí đối tượng",className:"esri-icon-locate"});var E=this.view.popup.actions.find(function(e){return"view-detail"===e.id});this.layer.id===n.TRONGTROT&&E&&(E.id="view-detail-edit");var k=function(){x.className="esri-icon-edit";var t=e.view.popup.actions.find(function(e){return"update-geometry"===e.id});t&&e.view.popup.actions.remove(t),e.layer.id===n.TRONGTROT&&E&&(E.id="view-detail")};l.once(this.view.popup,"selectedFeature").then(k),l.once(this.view.popup,"visible").then(k)}},{key:"renderAttachmentEditPopup",value:function(e,t){var n=this,i=t.container||document.getElementById("attachment-"+this.layer.id+"-"+this.attributes.OBJECTID),a=this.layer.url+"/"+this.layer.layerId+"/"+this.attributes.OBJECTID,s=o.create("div",{class:"attachment-item"},i),l=o.create("div",{class:"attachment-name"},s);o.create("a",{href:a+"/attachments/"+e.id,target:"_blank"},l).innerText=e.name;var u=o.create("div",{class:"delete-attachment esri-icon-trash"},s);r(u,"click",function(){n.attributes.deleteAttachment||(n.attributes.deleteAttachment=[]),n.attributes.deleteAttachment.push(a+"/deleteAttachments?f=json&attachmentIds="+e.id),i.removeChild(s)})}},{key:"registerChangeEvent",value:function(e){var t=this;r(e,"change",function(){return t.inputChangeHandler(e)})}},{key:"inputChangeHandler",value:function(e){var t=e.name,n=e.value;if(n)if(-1!=n){if("attachment"===t)this.attributes[t]=n;else{var i=this.layer.fields.find(function(e){return e.name===t});if(i){var r=i.type;if(r){var a=void 0;a="small-integer"===r||"integer"===r?parseInt(n):"double"===r?parseFloat(n):n,this.attributes[t]=a}}}var o=this.getSubtype(t);if(o)for(var s in o.domains){var l=o.domains[s],u=this.inputElement[s];if(u){var c=void 0;if("inherited"===l.type){var d=this.layer.getFieldDomain(s);d&&(c=d.codedValues)}else c=l.codedValues;if("SELECT"===u.tagName){u.innerHTML="";var h=document.createElement("option");h.value="-1",h.innerText="Chọn giá trị...",u.appendChild(h);var p=!0,f=!1,v=void 0;try{for(var m,g=c[Symbol.iterator]();!(p=(m=g.next()).done);p=!0){var y=m.value,T=document.createElement("option");T.setAttribute("value",y.code),T.innerText=y.name,y.code===this.attributes[s]&&T.setAttribute("selected","selected"),u.appendChild(T)}}catch(e){f=!0,v=e}finally{try{!p&&g.return&&g.return()}finally{if(f)throw v}}this.attributes[s]=-1==u.value?null:u.value}else{var b=document.createElement("select");b.classList.add("form-control"),b.setAttribute("name",s);var w=document.createElement("option");w.value="-1",w.innerText="Chọn giá trị...",b.appendChild(w),this.registerChangeEvent(b);var D=!0,C=!1,x=void 0;try{for(var E,k=c[Symbol.iterator]();!(D=(E=k.next()).done);D=!0){var L=E.value,M=document.createElement("option");M.setAttribute("value",L.code),M.innerText=L.name,b.appendChild(M)}}catch(e){C=!0,x=e}finally{try{!D&&k.return&&k.return()}finally{if(C)throw x}}if(u.parentElement){var N=u.parentElement;u.parentElement.removeChild(N.firstChild),N.appendChild(b)}this.attributes[s]=-1==u.value?null:u.value,this.inputElement[s]=b}}}}else this.attributes[t]=null}},{key:"uploadFile",value:function(){var e=this.layer.url+"/"+this.layer.layerId+"/"+this.objectId+"/addAttachment",t=document.getElementById("attachment-data");t&&s(e,{responseType:"json",body:t}).then(function(e){e.data&&e.data.addAttachmentResult&&e.data.addAttachmentResult.success?$.notify({message:"Thêm hình ảnh thành công"},{type:"success",placement:{from:"top",align:"left"}}):$.notify({message:"Thêm hình ảnh không thành công"},{type:"danger",placement:{from:"top",align:"left"}})})}},{key:"editFeature",value:function(){var e=this,t=$.notify({title:"<strong>Cập nhật <i>"+this.layer.title+"</i></strong>",message:"Cập nhật..."},{showProgressbar:!0,delay:2e4,placement:{from:"top",align:"left"}});try{if(this.attributes){if(this.attributes.attachment&&this.uploadFile(),this.attributes.deleteAttachment){var n=!0,i=!1,r=void 0;try{for(var a,o=this.attributes.deleteAttachment[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var l=a.value;s(l)}}catch(e){i=!0,r=e}finally{try{!n&&o.return&&o.return()}finally{if(i)throw r}}this.attributes.deleteAttachment=[]}var u=!0,d=!1,h=void 0;try{for(var p,f=this.layer.fields[Symbol.iterator]();!(u=(p=f.next()).done);u=!0){var v=p.value,m=v.type,g=v.name;if("date"===m){var y=this.attributes[g];if(y&&!Number.isInteger(y)){var T=y.split("-");if(3!=T.length)throw"Không thể lấy dữ liệu thời gian";var b=T[2],w=T[1],D=T[0],C=new Date(w+"/"+b+"/"+D).getTime();this.attributes[g]=C}}}}catch(e){d=!0,h=e}finally{try{!u&&f.return&&f.return()}finally{if(d)throw h}}var x=c.getUpdatedInfo(this.view);for(var E in x)this.attributes[E]=x[E];this.layer.applyEdits({updateFeatures:[{attributes:this.attributes}]}).then(function(n){var i=!1,r=!0,a=!1,o=void 0;try{for(var s,l=n.updateFeatureResults[Symbol.iterator]();!(r=(s=l.next()).done);r=!0){if(s.value.error){i=!0;break}}}catch(e){a=!0,o=e}finally{try{!r&&l.return&&l.return()}finally{if(a)throw o}}if(!i){t.update("type","success"),t.update("message","Cập nhật thành công!"),t.update("progress",90);var u=e.layer.createQuery();u.outFields=["*"],u.where="OBJECTID="+e.attributes.OBJECTID,e.layer.queryFeatures(u).then(function(t){e.view.popup.open({features:t.features})})}})}}catch(e){throw t.update("type","danger"),t.update("message","Có lỗi xảy ra trong quá trình cập nhật!"),t.update("progress",90),e}}},{key:"deleteFeature",value:function(){var e=this;if(confirm("Chắc chắn muốn xóa?")){var t=this.objectId,n=$.notify({title:"<strong>Xóa <i>"+this.layer.title+"</i></strong>",message:"Đang xóa..."},{showProgressbar:!0,delay:2e4});this.layer.applyEdits({deleteFeatures:[{objectId:t}]}).then(function(t){t.deleteFeatureResults.length>0&&!t.deleteFeatureResults[0].error&&(e.view.popup.visible=!1,n.update("type","success"),n.update("message","Xóa thành công!"),n.update("progress",100))})}}},{key:"splitPolygon",value:function(){this.view.popup.visible=!1,this._splitPolygon.startup(this.selectFeature,this.layer)}},{key:"mergePolygon",value:function(){this.view.popup.visible=!1,this._mergePolygon.run(this.selectFeature)}},{key:"updateGeometryGPS",value:function(){var e=this,t=this.objectId;$.notify({message:"Chọn vị trí trên bản đồ"});var n=$.notify({title:"<strong>Cập nhật vị trí</strong>",message:"Cập nhật..."},{showProgressbar:!0,delay:2e4,placement:{from:"top",align:"left"}}),i=this.view.on("click",function(r){r.stopPropagation(),e.layer.applyEdits({updateFeatures:[{attributes:{objectId:t,NguoiCapNhat:e.view.systemVariable.user.userName,NgayCapNhat:(new Date).getTime()},geometry:r.mapPoint}]}).then(function(t){t.updateFeatureResults[0].error?(n.update("type","danger"),n.update("message","Cập nhật không thành công!"),n.update("progress",90)):(n.update("type","success"),n.update("message","Cập nhật thành công!"),n.update("progress",90),e.view.popup.close())}),i.remove()})}},{key:"showTableDetailTrongTrot",value:function(){this.thoiGianSanXuatTrongTrotPopup.showTableDetailTrongTrot()}},{key:"selectFeature",get:function(){return this.view.popup.viewModel.selectedFeature}},{key:"layer",get:function(){return this.selectFeature.layer||this._layer},set:function(e){this.selectFeature.layer||(this._layer=e)}},{key:"attributes",get:function(){return this.selectFeature.attributes}},{key:"objectId",get:function(){return this.attributes.OBJECTID}}]),e}()}.apply(t,i))||(e.exports=r)},function(e,t,n){"use strict";var i,r,a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();i=[n,t,n(0),n(8),n(6),n(47),n(26),n(46)],void 0===(r=function(e,t,n,i,r,o,s,l){return function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options={tooltip:{move:"Nhấn vào màn hình để vẽ"}},this.view=t,this.systemVariable=t.systemVariable,this.drawLayer=new o(t),this.eventListener=new s(this)}return a(e,[{key:"draw",value:function(e){var t=this;this.drawLayer.layer=e,this.clickEvent=n(this.view,"click",function(e){t.clickHandler(e)}),this.pointerMoveEvent=n(this.view,"pointer-move",function(e){l.instance().show([e.x,e.y],t.options.tooltip.move)})}},{key:"clearEvents",value:function(){this.clickEvent&&(this.clickEvent.remove(),this.clickEvent=null),this.pointerMoveEvent&&(l.instance().hide(),this.pointerMoveEvent.remove(),this.pointerMoveEvent=null)}},{key:"clickHandler",value:function(e){e.stopPropagation();var t;t=new i({geometry:this.view.toMap({x:e.x,y:e.y}),symbol:new r}),this.eventListener.fire("draw-finish",t),this.clearEvents()}}]),e}()}.apply(t,i))||(e.exports=r)},function(e,t,n){"use strict";var i,r,a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();i=[n,t,n(58),n(47),n(26)],void 0===(r=function(e,t,n,i,r){return function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.view=t,this._drawLayer=null,this.systemVariable=t.systemVariable,this.simpleDrawPoint=new n(this.view),this.eventListener=new r(this),this.pointEditing=new i(this.view),this.registerEvent()}return a(e,[{key:"addFeature",value:function(e){if(confirm("Chắc chắn muốn thêm?"))return this.pointEditing.draw(this.drawLayer,e)}},{key:"registerEvent",value:function(){var e=this;this.simpleDrawPoint.on("draw-finish",function(t){e.addFeature(t).then(function(n){e.eventListener.fire("draw-finish",{graphic:{layer:e.drawLayer,attributes:t.attributes,geometry:t.geometry},method:"simple"})})})}},{key:"drawSimple",value:function(){this.clearEvents(),this.simpleDrawPoint.draw(this.drawLayer)}},{key:"clearEvents",value:function(){this.simpleDrawPoint.clearEvents()}},{key:"drawLayer",set:function(e){this._drawLayer=e},get:function(){return this._drawLayer}}]),e}()}.apply(t,i))||(e.exports=r)},,,,function(e,t,n){"use strict";var i,r;i=[n(15),n(25),n(24),n(23),n(22),n(21),n(7),n(20),n(19),n(18),n(17),n(9),n(16),n(5),n(13),n(6),n(4),n(3),n(14),n(2),n(11),n(30),n(44),n(49),n(48),n(41),n(40),n(27)],void 0===(r=function(e,t,n,i,r,a,o,s,l,u,c,d,h,p,f,v,m,g,y,T,b,w,D,C,x,E,k,L){var M,N,I,S=new w,O=new e({}),G=new D({container:"map",map:O,center:b.center,zoom:b.zoom});G.session().then(function(e){S.user=e;var t=void 0;7===Math.floor(S.user.role/100)&&(t="MaHuyenTP = '"+S.user.role.trim()+"'"),G.systemVariable=S;var n=function(){function e(){var e=$("<div/>",{class:"google-geocoding-widget input-group add-on"}),t=$("<input/>",{class:"form-control",type:"text",name:"srch-term",id:"srch-term",placeholder:"Nhập đơn vị hành chính, tên đường "}).appendTo(e),n=$("<div/>",{class:"input-group-btn"}).appendTo(e),i=$("<button/>",{class:"btn btn-default",type:"submit"}).appendTo(n),r=($("<i/>",{class:"glyphicon glyphicon-search"}).appendTo(i),$("<div/>",{class:"output-group add-on",id:"ketqua"}));G.ui.add(e[0],"top-right"),G.ui.add(r[0],"top-right"),i.on("click",function(e){function n(){var e=document.getElementById("ketqua");if(e)for(;e.firstChild;)e.removeChild(e.firstChild)}var i=t.val().toString().replace(/[ ]/g,"+");$.get("https://maps.googleapis.com/maps/api/geocode/json?address="+i+"&key=AIzaSyC9VTEqoczK2j7lDRacfQ3aRTE3f4vuHek").done(function(e){var t=e.results;n();var i=function(e){var t=$("<div />",{class:"address list-group-item"}).appendTo(r);$("<div />",{class:"address-detail",text:e.formatted_address}).appendTo(t).click(function(){return t=e.geometry.viewport,i=new y({ymin:t.southwest.lat,ymax:t.northeast.lat,xmin:t.southwest.lng,xmax:t.northeast.lng}),G.goTo(i),void n();var t,i})},a=!0,o=!1,s=void 0;try{for(var l,u=t[Symbol.iterator]();!(a=(l=u.next()).done);a=!0){i(l.value)}}catch(e){o=!0,s=e}finally{try{!a&&u.return&&u.return()}finally{if(o)throw s}}})})}e(),new E(G).startup(),G.ui.move(["zoom"],"top-left"),G.ui.add(new o({expandIconClass:"esri-icon-layer-list",view:G,content:new l({container:document.createElement("div"),view:G})}),"top-left"),G.ui.add(new s({view:G}),"top-left"),G.ui.add(new o({expandIconClass:"esri-icon-collection",content:new u({view:G})}),"top-left");var n=new L(G,{symbolPlg:new m({style:"none",outline:new g({color:"black",width:3})})}),e=new c({searchAllEnabled:!1,view:G,allPlaceholder:"Nhập nội dung tìm kiếm",sources:[{featureLayer:O.findLayerById(T.SAUBENH),searchFields:["OBJECTID","MaSauBenh","MaHuyenTP"],displayField:"MaSauBenh",exactMatch:!1,outFields:["*"],name:"Sâu hại",placeholder:"Tìm kiếm theo tên, loại cây trồng, huyện/tp"},{featureLayer:O.findLayerById(T.DOANHNGHIEP),searchFields:["OBJECTID","MaDoanhNghiep","NguoiDaiDienDoanhNghiep"],displayField:"NguoiDaiDienDoanhNghiep",exactMatch:!1,outFields:["*"],name:"Doanh Nghiệp",placeholder:"Nhập tên hoặc mã Doanh nghiệp"},{featureLayer:O.findLayerById(T.TRONGTROT),searchFields:["MaDoiTuong"],displayField:"MaDoiTuong",exactMatch:!1,outFields:["*"],name:"Trồng Trọt",placeholder:"Nhập mã đối tượng Trồng trọt"},{featureLayer:new r({url:"https://ditagis.com:6443/arcgis/rest/services/BinhDuong/DuLieuNen/MapServer/4"}),searchFields:["MaPhuongXa","TenXa"],displayField:"TenXa",outFields:["*"],filter:{where:""+(t||"1=1")},name:"Hành chính xã",placeholder:"Nhập tên xã/ phường",popupOpenOnSelect:!1,resultGraphicEnabled:!1}]});G.ui.add(e,{position:"top-right"}),e.on("search-complete",function(e){n.clear();var t=e.results.find(function(e){return 4===e.sourceIndex});if(t&&t.results.length>0){var i=t.results[0].feature;n.add(i)}});var i=new x(G);i.startup(),new k(G).startup();var a=new C({view:G});i.on("draw-finish",function(e){a.add({layerName:e.graphic.layer.title,geometry:e.graphic.geometry})})};!function(){var e=b.basemap;if(t){var n=!0,r=!1,o=void 0;try{for(var s,l=e.sublayers[Symbol.iterator]();!(n=(s=l.next()).done);n=!0)s.value.definitionExpression=t}catch(e){r=!0,o=e}finally{try{!n&&l.return&&l.return()}finally{if(r)throw o}}}function u(e,t,n,i){if(e)switch(i){case I:M.visible=N.visible=!e;break;case M:I.visible=N.visible=!e;break;case N:I.visible=M.visible=!e}}(M=new i(e)).watch("visible",function(e){$&&$.notify(e?"Hiển thị dữ liệu nền":"Ẩn dữ liệu nền")}),M.then(function(){if(t){var e=M.findSublayerById(T.INDEX_HANHCHINHHUYEN),n=e.createQuery();n.where=t,n.returnGeometry=!0,n.outSpatialReference=G.spatialReference,e.queryFeatures(n).then(function(e){var t=e.features[0];G.goTo({target:t.geometry})})}}),N=new a({urlTemplate:"//mt1.google.com/vt/lyrs=y&x={col}&y={row}&z={level}",title:"Ảnh vệ tinh",id:"worldimagery",visible:!1}),I=new a({title:"Đường đi",urlTemplate:"//mt1.google.com/vt/lyrs=m&x={col}&y={row}&z={level}",id:"osm",visible:!1}),O.addMany([I,N,M]),I.watch("visible",u),N.watch("visible",u),M.watch("visible",u)}(),(r.prototype.getAttachments=function(e){var t=this;return new Promise(function(n,i){var r=t.url+"/"+t.layerId+"/"+e;p(r+"/attachments?f=json",{responseType:"json",method:"get"}).then(function(e){n(e.data||null)})})},new Promise(function(e,n){p("/map/layerrole",{method:"post"}).then(function(n){if(!n.data)throw"cannot request permission";var i=function(e){b.layers.find(function(t){return t.id===e.layer}).permission={create:e.isCreate,view:e.isView,delete:e.isDelete,edit:e.isEdit}},a=!0,o=!1,s=void 0;try{for(var l,u=n.data[Symbol.iterator]();!(a=(l=u.next()).done);a=!0)i(l.value)}catch(e){o=!0,s=e}finally{try{!a&&u.return&&u.return()}finally{if(o)throw s}}for(var c in b.layers){var d=b.layers[c];if(d.permission.view){if(d.id===T.SAUBENH){var h=new Date;h.setDate(h.getDate()-365),d.definitionExpression="NgayXayRa >= date '"+h.getFullYear()+"-"+(h.getMonth()+1)+"-"+h.getDate()+" "+h.getHours()+":"+h.getMinutes()+":"+h.getSeconds()+"'",d.renderer=new f({field:"CapDoGayHai",uniqueValueInfos:[{value:"1",symbol:new v({color:"#0f0",style:"circle",outline:{color:"white"}}),label:"Nhẹ"},{value:"2",symbol:new v({color:"#00a9e6",style:"circle",outline:{color:"white"}}),label:"Nặng"},{value:"3",symbol:new v({color:"#ff0000",style:"circle",outline:{color:"white"}}),label:"Mất trắng"},{value:"4",symbol:new v({color:"#ffff6d",style:"circle",outline:{color:"white"}}),label:"Trung bình"}]})}t&&(d.definitionExpression?d.definitionExpression+=" and "+t:d.definitionExpression=t,d.definitionExpression=t),d.id===T.TRONGTROT&&(d.opacity=.7);var p=new r(d);O.add(p)}}var m=new r({id:"danhdauvitri",title:"Vị trí đánh dấu",outFields:["*"],visible:!1,url:"https://ditagis.com:6443/arcgis/rest/services/BinhDuong/BaoVeThucVat_DanhDauViTri/FeatureServer/0",permission:{create:!1,view:!0,delete:!0,edit:!1}});O.add(m),e()})})).then(function(){n(),O.reorder(M,5)})})}.apply(t,i))||(e.exports=r)}])});