define(["dojo/on","dojo/dom-construct","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleFillSymbol","esri/request","esri/symbols/SimpleMarkerSymbol","esri/widgets/Expand","esri/Graphic","esri/tasks/QueryTask","esri/Color","esri/geometry/geometryEngine","esri/renderers/UniqueValueRenderer","esri/geometry/Extent","esri/Map","esri/tasks/support/Query","esri/widgets/Search","esri/widgets/Legend","esri/widgets/LayerList","esri/widgets/Locate","esri/layers/WebTileLayer","esri/layers/FeatureLayer","esri/layers/MapImageLayer","esri/layers/OpenStreetMapLayer","esri/tasks/Locator","esri/layers/GraphicsLayer","dojo/window","dojo/dom","dojo/dom-class","esri/core/watchUtils","esri/core/Collection","esri/geometry/Polygon","esri/geometry/Polyline","esri/widgets/Locate/LocateViewModel","dojo/dom-style","esri/views/MapView"],function(e,t,n,i,r,a,o,s,l,u,c,d,h,p,g,f,m,y,v,T,b,w,D,C,E,x,L,M,N,I,O,G,k,F,S){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=62)}([function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t,n){"use strict";var i;void 0===(i=function(e,t){return{BASEMAP:"dulieunen",SAUBENH:"SauBenh",DOANHNGHIEP:"DoanhNghiep",TRONGTROT:"TrongTrot",INDEX_HANHCHINHXA:4,INDEX_HANHCHINHHUYEN:5,TABLE_SXTT_URL:"https://ditagis.com:6443/arcgis/rest/services/BinhDuong/BaoVeThucVat/FeatureServer/3",THOI_GIAN_SAN_XUAT_TRONG_TROT:"thoigiansxtt",TBL_GIAI_DOAN_SINH_TRUONG:"tblgiaidoansinhtruong"}}.apply(t,[n,t]))||(e.exports=i)},function(e,t){e.exports=n},function(e,t){e.exports=i},function(e,t){e.exports=r},function(e,t){e.exports=a},function(e,t){e.exports=o},function(e,t){e.exports=s},function(e,t){e.exports=l},function(e,t){e.exports=u},function(e,t,n){"use strict";var i;void 0===(i=function(e,t){return{basemap:{title:"Dữ liệu nền",id:"dulieunen",url:"https://ditagis.com:6443/arcgis/rest/services/BinhDuong/DuLieuNen/MapServer",visible:!0,copyright:"Bản đồ biên tập bởi Trung tâm DITAGIS",sublayers:[{id:5,title:"Hành chính huyện"},{id:4,title:"Hành chính xã"},{id:3,title:"Sông hồ"},{id:2,title:"Phủ bề mặt",visible:!1},{id:1,title:"Mặt giao thông"},{id:0,title:"Tim đường"}]},layers:[{title:"Trồng trọt",id:"TrongTrot",url:"https://ditagis.com:6443/arcgis/rest/services/BinhDuong/BaoVeThucVat_ChuyenDe/FeatureServer/2",outFields:["*"]},{title:"Sâu bệnh",id:"SauBenh",url:"https://ditagis.com:6443/arcgis/rest/services/BinhDuong/BaoVeThucVat_ChuyenDe/FeatureServer/1",outFields:["*"]},{title:"Doanh nghiệp",id:"DoanhNghiep",url:"https://ditagis.com:6443/arcgis/rest/services/BinhDuong/BaoVeThucVat_ChuyenDe/FeatureServer/0",outFields:["*"]}],tables:[{id:"thoigiansxtt",url:"https://ditagis.com:6443/arcgis/rest/services/BinhDuong/BaoVeThucVat_ChuyenDe/FeatureServer/3"},{id:"tblgiaidoansinhtruong",url:"https://ditagis.com:6443/arcgis/rest/services/BinhDuong/BaoVeThucVat_ChuyenDe/FeatureServer/4"}],zoom:10,center:[106.6843694,11.158752270428375]}}.apply(t,[n,t]))||(e.exports=i)},function(e,t){e.exports=c},function(e,t){e.exports=d},function(e,t){e.exports=h},function(e,t){e.exports=p},function(e,t){e.exports=g},function(e,t){e.exports=f},function(e,t){e.exports=m},function(e,t){e.exports=y},function(e,t){e.exports=v},function(e,t){e.exports=T},function(e,t){e.exports=b},function(e,t){e.exports=w},function(e,t){e.exports=D},function(e,t){e.exports=C},function(e,t,n){"use strict";var i;void 0===(i=function(e,t){return function(){function e(e){this.eventListeners={},e.on=this.on,e.fire=this.fire,e.eventListeners=this.eventListeners}return e.prototype.on=function(e,t){this.eventListeners[e]?this.eventListeners[e].push(t):this.eventListeners[e]=[t]},e.prototype.fire=function(e,t){var n=this.eventListeners[e];if(n)for(var i=0,r=n;i<r.length;i++){(0,r[i])(t)}},e}()}.apply(t,[n,t]))||(e.exports=i)},function(e,t,n){"use strict";var i,r;i=[n,t,n(8),n(6),n(3),n(4),n(10),n(28)],void 0===(r=function(e,t,n,i,r,a,o,s){return function(){function e(e,t){t=t||{},this.view=e,this.graphics=new s({listMode:"hide"}),this.view.map.add(this.graphics),this.symbolMarker=t.symbolMarker||new i({color:new o([255,0,0]),size:3,outline:new r({width:7,color:new o([255,64,0,.4])})}),this.symbolLine=t.symbolLine||new r({color:new o([255,0,0]),width:4}),this.symbolPlg=t.symbolPlg||new a({style:"none",outline:new r({color:new o([255,64,0,.4]),width:1})})}return e.prototype.hightlight=function(e){var t=this;this.clear(),this.view.hitTest(e).then(function(e){for(var n=0,i=e.results;n<i.length;n++){var r=i[n].graphic;r.attributes&&null!=r.attributes&&t.add(r)}})},e.prototype.clear=function(){this.removeAll()},e.prototype.rendererGraphic=function(e,t){var i;return i="point"===e?this.symbolMarker:"polyline"===e?this.symbolLine:this.symbolPlg,new n({geometry:t,symbol:i})},e.prototype.add=function(e){var t=e.geometry.type,n=this.rendererGraphic(t,e.geometry);this.graphics.add(n)},e.prototype.addAll=function(e){for(var t=0,n=e;t<n.length;t++){var i=n[t];this.add(i)}},e.prototype.removeAll=function(){this.graphics.removeAll()},e}()}.apply(t,i))||(e.exports=r)},function(e,t){e.exports=E},function(e,t){e.exports=x},function(e,t,n){"use strict";var i,r;i=[n,t,n(26)],void 0===(r=function(e,t,n){return function(){return function(){this.eventListener=new n(this)}}()}.apply(t,i))||(e.exports=r)},function(e,t){e.exports=L},function(e,t){e.exports=M},function(e,t,n){"use strict";var i,r;i=[n,t,n(9),n(5)],void 0===(r=function(e,t,n,i){return function(){function e(e){void 0===e&&(e={});var t=this;this.url=e.url,this.fieldID=e.fieldID||"OBJECTID",this.queryTask=new n(this.url),$.get(this.url+"?f=json").done(function(e){for(var n in e=JSON.parse(e))t[n]=e[n]})}return e.prototype.findById=function(e){return this.queryTask.execute({outFields:["*"],where:this.fieldID+" = '"+e+"'"})},e.prototype.getFieldDomain=function(e){return this.fields.find(function(t){return t.name===e}).domain},e.prototype.serialize=function(e){var t="";for(var n in e.f=e.f||"json",e)if(e.hasOwnProperty(n)){var i,r=e[n],a=Object.prototype.toString.call(r);t.length&&(t+="&"),i="[object Array]"===a?"[object Object]"===Object.prototype.toString.call(r[0])?JSON.stringify(r):r.join(","):"[object Object]"===a?JSON.stringify(r):"[object Date]"===a?r.valueOf():r,t+=encodeURIComponent(n)+"="+encodeURIComponent(i)}return t},e.prototype.createRequest=function(e,t){var n=new XMLHttpRequest;return n.onerror=function(n){e.call(t,{error:{code:500,message:"XMLHttpRequest error"}},null)},n.onreadystatechange=function(){var i,r;if(4===n.readyState){try{i=JSON.parse(n.responseText)}catch(e){i=null,r={code:500,message:"Could not parse response as JSON. This could also be caused by a CORS or XMLHttpRequest error."}}!r&&i.error&&(r=i.error,i=null),e.call(t,r,i)}},n},e.prototype.xmlHttpPost=function(e,t,n,i){var r=this.createRequest(n,i);return r.open("POST",e),void 0!==i&&null!==i&&void 0!==i.options&&(r.timeout=i.options.timeout),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),r.send(this.serialize(t)),r},e.prototype.applyEdits=function(e){void 0===e&&(e={addFeatures:[],updateFeatures:[],deleteFeatures:[]});var t=document.createElement("form");if(t.method="post",e.addFeatures.length>0){var n=document.createElement("input");n.name="adds",n.type="text",n.value=JSON.stringify(e.addFeatures),t.appendChild(n)}if(e.deleteFeatures.length>0){var r=document.createElement("input");r.name="deletes",r.type="text",r.value=e.deleteFeatures.join(","),t.appendChild(r)}if(e.updateFeatures.length>0){var a=document.createElement("input");a.name="updates",a.type="text",a.value=JSON.stringify(e.updateFeatures),t.appendChild(a)}var o=document.createElement("input");return o.name="f",o.type="text",o.value="json",t.appendChild(o),i(this.url+"/applyEdits?f=json",{method:"post",body:t})},e.prototype.queryFeatures=function(e){return this.queryTask.execute(e)},e}()}.apply(t,i))||(e.exports=r)},function(e,t,n){"use strict";var i,r,a=function(e,t,n,i){return new(n||(n=Promise))(function(r,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(o,s)}l((i=i.apply(e,t||[])).next())})},o=function(e,t){var n,i,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(r=i[2&a[0]?"return":a[0]?"throw":"next"])&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[0,r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(r=(r=o.trys).length>0&&r[r.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};i=[n,t,n(9),n(2)],void 0===(r=function(e,t,n,i){return function(){function e(){}return e.getQueryLocation=function(e){return this._queryLocation||(this._queryLocation=new n({url:e.map.findLayerById(i.BASEMAP).findSublayerById(i.INDEX_HANHCHINHXA).url})),this._queryLocation},e.getLocationName=function(e,t){var n=this;return void 0===t&&(t={PhuongXa:null,HuyenTP:null}),new Promise(function(i,r){try{var a=n.getQueryLocation(e),o=[];t.PhuongXa&&o.push("MaPhuongXa = '"+t.PhuongXa+"'"),t.HuyenTP&&o.push("MaHuyenTP = '"+t.HuyenTP+"'"),a.execute({outFields:["TenXa","TenHuyen"],where:o.join(" and ")}).then(function(e){if(e&&e.features.length>0){var t=e.features[0];t&&t.attributes&&i(t.attributes)}else i(null)})}catch(e){console.log(e),r(e)}})},e.getCreatedInfo=function(e){return{NguoiCapNhat:e.systemVariable.user.userName,NgayCapNhat:(new Date).getTime()}},e.getUpdatedInfo=function(e){return{NguoiCapNhat:e.systemVariable.user.userName,NgayCapNhat:(new Date).getTime()}},e.getNhomCayTrong=function(e,t){return a(this,void 0,void 0,function(){var n,r,a;return o(this,function(o){switch(o.label){case 0:return n=e.toScreen(t),[4,e.hitTest(n)];case 1:return(r=o.sent()).results.length>0&&(a=r.results.find(function(e){return e.graphic.layer.id===i.TRONGTROT}))&&a.graphic&&a.graphic.attributes?[2,{NhomCayTrong:a.graphic.attributes.NhomCayTrong,LoaiCayTrong:a.graphic.attributes.LoaiCayTrong}]:[2,null]}})})},e.getLocationInfo=function(e,t){var n=this;return new Promise(function(i,r){try{n.getQueryLocation(e).execute({outFields:["MaPhuongXa","MaHuyenTP"],geometry:t}).then(function(e){if(e&&e.features.length>0){var t=e.features[0];t&&t.attributes&&i(t.attributes)}else i(null)})}catch(e){console.log(e),r(e)}})},e}()}.apply(t,i))||(e.exports=r)},function(e,t){e.exports=N},function(e,t){e.exports=I},function(e,t){e.exports=O},function(e,t){e.exports=G},function(e,t){e.exports=k},function(e,t,n){"use strict";var i,r,a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(e,t,n,i){return new(n||(n=Promise))(function(r,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(o,s)}l((i=i.apply(e,t||[])).next())})},s=function(e,t){var n,i,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(r=i[2&a[0]?"return":a[0]?"throw":"next"])&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[0,r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(r=(r=o.trys).length>0&&r[r.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};i=[n,t,n(2),n(11),n(0),n(1),n(56),n(27),n(34),n(50),n(6),n(4),n(3),n(33),n(10)],void 0===(r=function(e,t,n,i,r,l,u,c,d,h,p,g,f,m,y){return function(){function e(e){this.view=e,this.options={hightLength:100};var t=i.tables.find(function(e){return e.id===n.THOI_GIAN_SAN_XUAT_TRONG_TROT}).url;this.thoiGianSanXuatTrongTrot=new m({url:t,fieldID:"MaDoiTuong"}),this.popupEdit=new u(e,{hightLength:this.options.hightLength,table:this.thoiGianSanXuatTrongTrot}),this.tblGiaiDoanSinhTruong=new m({url:i.tables.find(function(e){return e.id===n.TBL_GIAI_DOAN_SINH_TRUONG}).url,fieldID:"OBJECTID"}),this.hightlightGraphic=new c(e,{symbolMarker:new p({outline:new f({color:new y("#7EABCD"),width:2})}),symbolFill:new g({outline:new f({color:new y("#7EABCD"),width:2})})})}return e.prototype.startup=function(){var e=this;this.view.map.layers.map(function(t){t.then(function(){if("feature"==t.type){var i=[];t.permission.edit&&(i.push({id:"update",title:"Cập nhật",className:"esri-icon-edit",layer:t}),i.push({id:"update-geometry",title:"Cập nhật vị trí",className:"esri-icon-locate",layer:t})),t.permission.delete&&i.push({id:"delete",title:"Xóa",className:"esri-icon-erase",layer:t}),t.id===n.TRONGTROT&&("/cattachthua"!==location.pathname&&i.push({id:"view-detail",title:"Chi tiết thời gian trồng trọt",className:"esri-icon-table",layer:t}),"/congtacvien"!==location.pathname&&(i.push({id:"split",title:"Chia thửa",className:"esri-icon-zoom-out-fixed",layer:t}),i.push({id:"merge",title:"Ghép thửa",className:"esri-icon-zoom-in-fixed",layer:t}))),t.popupTemplate={content:function(n){var i=e.contentPopup(n,t);return i},title:t.title,actions:i}}})}),this.view.popup.watch("visible",function(t){t||e.hightlightGraphic.clear()}),this.view.popup.on("trigger-action",function(t){e.triggerActionHandler(t)}),this.view.popup.dockOptions={buttonEnabled:!0,breakpoint:{width:600,height:1e3},position:"bottom-center"}},Object.defineProperty(e.prototype,"selectFeature",{get:function(){return this.view.popup.viewModel.selectedFeature},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layer",{get:function(){return this.selectFeature.layer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"attributes",{get:function(){return this.selectFeature.attributes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"objectId",{get:function(){return this.attributes.OBJECTID},enumerable:!0,configurable:!0}),e.prototype.triggerActionHandler=function(e){var t=e.action.id,n=this.layer||e.action.layer;this.popupEdit.layer=n;var i=!1;switch(t){case"update":n.permission&&n.permission.edit?"esri-icon-check-mark"===e.action.className?this.popupEdit.editFeature():this.popupEdit.showEdit():i=!0;break;case"delete":n.permission&&n.permission.delete?this.popupEdit.deleteFeature():i=!0;break;case"view-detail":this.attributes.MaDoiTuong?this.triggerActionViewDetailTrongtrot(this.attributes.MaDoiTuong):$.notify({message:"Không xác được định danh"},{type:"danger"});break;case"view-detail-edit":this.attributes.MaDoiTuong?this.popupEdit.showTableDetailTrongTrot():$.notify({message:"Không xác được định danh"},{type:"danger"});break;case"update-geometry":if("polygon"===n.geometryType){alert("Không thể thay đổi vị trí vùng...");break}this.popupEdit.updateGeometryGPS();break;case"split":this.popupEdit.splitPolygon();break;case"merge":this.popupEdit.mergePolygon()}i&&$.notify({message:"Không có quyền thực hiện tác vụ"},{type:"danger"})},e.prototype.getSubtype=function(e,t){if(e=e||this.layer.typeIdField,t=t||this.attributes[e],this.tblGiaiDoanSinhTruong.typeIdField===e){this.tblGiaiDoanSinhTruong.typeIdField;return this.tblGiaiDoanSinhTruong.types.find(function(e){return e.id==t})}return null},e.prototype.renderDomain=function(e,t){var n;if("inherited"===e.type){var i=this.layer.getFieldDomain(t);i&&(n=i.codedValues)}else n=e.codedValues;return n},e.prototype.contentPopup=function(e,t){return o(this,void 0,void 0,function(){var n,i,a,u,c,p,g,f,m,y,v,T=this;return s(this,function(b){switch(b.label){case 0:b.trys.push([0,5,,6]),n=e.graphic,i=n.layer||t,a=n.attributes,n.layer||(n.layer=i),this.hightlightGraphic.clear(),this.hightlightGraphic.add(n),u=l.create("div",{class:"popup-content",id:"popup-content"}),c=l.create("table",{},u),p=this.getSubtype(),g=function(e){var t,n,i,r,u,h,g,m,y;return s(this,function(v){switch(v.label){case 0:return t=a[e.name],"oid"===e.type?[2,"continue"]:(n=l.create("tr"),i=l.create("td",{innerHTML:e.alias}),void 0,r=void 0,u=void 0,h=void 0,p&&p.domains[e.name]?h=f.renderDomain(p.domains[e.name],e.name):e.domain&&(h=f.renderDomain(e.domain,e.name)),h?((g=h.find(function(e){return e.code===t}))&&(t=g.name),[3,4]):[3,1]);case 1:return"MaPhuongXa"!==e.name&&"MaHuyenTP"!==e.name||!a[e.name]?[3,3]:[4,d.getLocationName(f.view,{PhuongXa:a.MaPhuongXa,HuyenTP:a.MaHuyenTP}).then(function(e){return o(T,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return[4,e];case 1:return[2,t.sent()]}})})})];case 2:return m=v.sent(),t="MaPhuongXa"==e.name?m.TenPhuong:m.TenHuyen,[3,4];case 3:"small-integer"===e.type||"integer"===e.type||"double"===e.type||"date"===e.type&&(u="DateFormat"),v.label=4;case 4:return r=u?"{"+e.name+":"+u+"}":t,y=l.create("td"),null,e.length>=f.options.hightLength?l.create("textarea",{rows:5,cols:25,readonly:!0,innerHTML:r,style:"background: transparent;border:none"},y):y.innerHTML=r,l.place(i,n),l.place(y,n),l.place(n,c),[2]}})},f=this,m=0,y=i.fields,b.label=1;case 1:return m<y.length?(v=y[m],[5,g(v)]):[3,4];case 2:b.sent(),b.label=3;case 3:return m++,[3,1];case 4:return i.hasAttachments&&i.getAttachments(a.OBJECTID).then(function(e){if(e&&e.attachmentInfos&&e.attachmentInfos.length>0){var t=l.create("div",{class:"attachment-container"},document.getElementById("popup-content"));l.create("legend",{innerHTML:"Hình ảnh"},t);for(var n=i.url+"/"+i.layerId+"/"+a.OBJECTID,o=function(e){var i=l.create("div",{class:"col-lg-3 col-md-4 col-xs-6 thumb"},t),a=l.create("a",{class:"thumbnail",href:"javascript:void(0)"},i),o=l.create("img",{class:"img-responsive",id:n+"/attachments/"+e.id,src:n+"/attachments/"+e.id,alt:n+"/attachments/"+e.name},a);r(a,"click",function(){var t=h.modal("attachments-"+e.id,e.name,o.cloneNode(!0));t&&t.modal()})},s=0,u=e.attachmentInfos;s<u.length;s++){o(u[s])}}}),[2,u.outerHTML];case 5:throw b.sent();case 6:return[2]}})})},e.prototype.triggerActionViewDetailTrongtrot=function(e){var t=this,n=$.notify({title:"Thời gian trồng trọt thửa đất: "+e,message:"Đang truy vấn..."},{delay:2e4,showProgressbar:!0});this.thoiGianSanXuatTrongTrot.findById(e).then(function(e){if(e.features.length>0){n.update("message","Tìm thấy "+e.features.length+" dữ liệu"),n.update("progress",100),n.update("type","success");var i=document.createElement("table");i.classList.add("table","table-hover");var r=document.createElement("thead");r.innerHTML="<tr>\n              <th>Nhóm cây trồng</th>\n              <th>Loại cây trồng</th>\n              <th>Diện tích</th>\n              <th>Thời gian bắt đầu trồng</th>\n              <th>Thời gian trồng trọt</th>\n              <th>Giai đoạn sinh trưởng</th>\n            </tr>\n            </thead>",l.place(r,i),i.appendChild(r);var o=document.createElement("tbody");i.appendChild(o);for(var s=function(e){var n=e.attributes,i=document.createElement("tr");i.classList.add("Info"),o.appendChild(i);var r=document.createElement("td"),a=t.layer.getFieldDomain("NhomCayTrong").codedValues;a&&((c=a.find(function(e){return e.code==n.NhomCayTrong}))&&(r.innerText=c.name));r.innerText||(r.innerText=n.NhomCayTrong+""||"");var s=document.createElement("td"),l=t.getSubtype("NhomCayTrong",n.NhomCayTrong);if(!l)return{value:void 0};var u=l.domains.LoaiCayTrong;if(u){var c,d=void 0;if("inherited"===u.type){var h=t.layer.getFieldDomain("LoaiCayTrong");h&&(d=h.codedValues)}else d=u.codedValues;if(d)(c=d.find(function(e){return e.code==n.LoaiCayTrong}))&&(s.innerText=c.name)}s.innerText||(s.innerText=n.LoaiCayTrong||"");var p=document.createElement("td");p.innerText=n.DienTich+""||"0";var g=document.createElement("td");if(n.ThoiGianBatDauTrong){var f=new Date(n.ThoiGianBatDauTrong);g.innerText=f.getDate()+"/"+(f.getMonth()+1)+"/"+f.getFullYear()}var m=document.createElement("td");if(n.ThoiGianTrongTrot){var y=new Date(n.ThoiGianTrongTrot);m.innerText=y.getDate()+"/"+(y.getMonth()+1)+"/"+y.getFullYear()}var v=document.createElement("td");v.innerText=n.GiaiDoanSinhTruong,i.appendChild(r),i.appendChild(s),i.appendChild(p),i.appendChild(g),i.appendChild(m),i.appendChild(v)},u=0,c=e.features.sort(function(e,t){var n=e.attributes,i=t.attributes;return n.Nam==i.Nam?n.Thang>i.Thang:n.Nam>i.Nam});u<c.length;u++){var d=s(c[u]);if("object"===(void 0===d?"undefined":a(d)))return d.value}h.modal("ttModal","Thời gian trồng trọt",i).modal()}else n.update("type","danger"),n.update("message","Không tìm thấy dữ liệu"),n.update("progress",100)})},e}()}.apply(t,i))||(e.exports=r)},function(e,t,n){"use strict";var i,r,a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();i=[n(0),n(1),n(32),n(31),n(7)],void 0===(r=function(e,t,n,i,r){return function(){function n(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};for(var i in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.view=e,this.options={position:"top-left",icon:"esri-icon-user",title:"Người dùng"},t)this.options[i]=t[i];this.isStartup=!1}return a(n,[{key:"startup",value:function(){this.user&&(this.isStartup||(this.initView(),this.view.ui.add(this.expand,this.options.position),this.isStartup=!0))}},{key:"destroy",value:function(){this.isStartup&&(this.view.ui.remove(this.expand),delete this.DOM,delete this.expand,this.isStartup=!1)}},{key:"initView",value:function(){var n=this;try{this.DOM={},this.DOM.container=t.create("div",{class:"esri-widget ditagis-widget-user"}),this.DOM.ul=t.create("ul",{},this.DOM.container),t.create("li",{class:"title",innerHTML:this.user.displayName},this.DOM.ul),this.DOM.infoLi=t.create("li",{class:"item"},this.DOM.ul),this.DOM.infoDiv=t.create("div",{class:"container info"},this.DOM.infoLi),this.DOM.setting=t.create("button",{class:"dtg-btn-widget setting",innerHTML:"Cập nhật tài khoản"},this.DOM.infoDiv),e(this.DOM.setting,"click",function(){return n.settingUserClickHandler()}),this.DOM.btnLogout=t.create("button",{class:"dtg-btn-widget btn-logout",innerHTML:"Đăng xuất"},this.DOM.infoDiv),e(this.DOM.btnLogout,"click",function(){return n.logoutClickHandler()}),this.expand=new r({expandIconClass:this.options.icon,expandTooltip:this.options.title,view:this.view,content:this.DOM.container})}catch(e){console.log(e)}}},{key:"logoutClickHandler",value:function(){location.href="/account/logout"}},{key:"successLogout",value:function(){}},{key:"failLogout",value:function(){}},{key:"settingUserClickHandler",value:function(){}},{key:"user",get:function(){return this.view.systemVariable.user}}]),n}()}.apply(t,i))||(e.exports=r)},function(e,t){e.exports=F},function(e,t){e.exports=S},function(e,t,n){"use strict";var i,r,a,o=(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});i=[n,t,n(43),n(30),n(5)],void 0===(r=function(e,t,n,i,r){return function(e){function t(t){var n=e.call(this,t)||this;return n.systemVariable=new i,n}return o(t,e),t.prototype.session=function(){var e=this;return new Promise(function(t,n){r("/map",{method:"post"}).then(function(n){e.systemVariable.user=n.data,t(n.data)})})},t}(n)}.apply(t,i))||(e.exports=r)},,function(e,t,n){"use strict";var i,r;i=[n,t,n(1),n(42)],void 0===(r=function(e,t,n,i){return function(){function e(){this.container=n.toDom('<div class="dtg-tooltip-map"></div>'),i.set(this.container,{position:"fixed"})}return e.instance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.show=function(e,t){i.set(this.container,{left:e[0]+30+"px",top:e[1]+"px"}),this.container.innerHTML=t,document.body.contains(this.container)||document.body.appendChild(this.container)},e.prototype.hide=function(){document.body.contains(this.container)&&document.body.removeChild(this.container)},e}()}.apply(t,i))||(e.exports=r)},function(e,t,n){"use strict";var i,r,a=function(e,t,n,i){return new(n||(n=Promise))(function(r,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(o,s)}l((i=i.apply(e,t||[])).next())})},o=function(e,t){var n,i,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(r=i[2&a[0]?"return":a[0]?"throw":"next"])&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[0,r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(r=(r=o.trys).length>0&&r[r.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};i=[n,t,n(34),n(2)],void 0===(r=function(e,t,n,i){return function(){function e(e){e&&(this.view=e)}return Object.defineProperty(e.prototype,"layer",{get:function(){return this._layer},set:function(e){this._layer=e},enumerable:!0,configurable:!0}),e.prototype.draw=function(e,t){return a(this,void 0,void 0,function(){var r,s,l,u,c,d,h=this;return o(this,function(p){switch(p.label){case 0:if(r=$.notify({title:"<strong>Cập nhật đối tượng</strong>",message:"Đang cập nhật..."},{showProgressbar:!0,delay:2e4}),s={},e.drawingAttributes)for(c in e.drawingAttributes)s[c]=e.drawingAttributes[c];return e.id===i.SAUBENH&&(s.NgayXayRa=(new Date).getTime()),r.update("type","info"),r.update("message","Đang lấy thông tin người cập nhật..."),r.update("progress",10),[4,n.getCreatedInfo(this.view)];case 1:for(c in l=p.sent())s[c]=l[c];return r.update("type","info"),r.update("message","Lấy thông tin người cập nhật thành công"),r.update("progress",20),r.update("type","info"),r.update("message","Đang lấy vị trí...!"),r.update("progress",30),[4,n.getLocationInfo(this.view,t.geometry)];case 2:if(!(u=p.sent()))return r.update("type","danger"),r.update("message","Không xác định được vị trí"),r.update("progress",90),[2];for(c in r.update("type","info"),r.update("message","Lấy vị trí thành công!"),r.update("progress",80),u)s[c]=u[c];return t.attributes=s,d={addFeatures:[t]},e.applyEdits(d).then(function(s){return a(h,void 0,void 0,function(){var a,l,u,c,d,h=this;return o(this,function(p){switch(p.label){case 0:if(!(s.addFeatureResults.length>0))return[3,4];a=function(a){var s,u,c;return o(this,function(o){switch(o.label){case 0:return s={objectId:a.objectId},e.id!==i.SAUBENH?[3,2]:(r.update("type","info"),r.update("message","Đang lấy thông tin cây trồng!"),r.update("progress",60),[4,n.getNhomCayTrong(l.view,t.geometry)]);case 1:if(u=o.sent())for(c in r.update("type","info"),r.update("message","Lấy thông tin cây trồng thành công"),r.update("progress",80),u)s[c]=u[c];else r.update("type","danger"),r.update("message","Lấy thông tin cây trồng thất bại"),r.update("progress",80);o.label=2;case 2:return e.applyEdits({updateFeatures:[{attributes:s}]}).then(function(t){t.updateFeatureResults[0].error?(r.update("type","danger"),Promise.reject("err")):(Promise.resolve(),r.update("type","success"),r.update("message","Cập nhật vị trí thành công!"),r.update("progress",100),e.queryFeatures({returnGeometry:!0,spatialReference:h.view.spatialReference,where:"OBJECTID = "+a.objectId,outFields:["*"]}).then(function(e){if(e.features[0]){var t=e.features[0];h.view.popup.open({features:[t],updateLocationEnabled:!0})}}))}),[2]}})},l=this,u=0,c=s.addFeatureResults,p.label=1;case 1:return u<c.length?(d=c[u],[5,a(d)]):[3,4];case 2:p.sent(),p.label=3;case 3:return u++,[3,1];case 4:return[2]}})})}),[2]}})})},e}()}.apply(t,i))||(e.exports=r)},function(e,t,n){"use strict";var i,r,a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();i=[n(0),n(1),n(32),n(31),n(7),n(26),n(58)],void 0===(r=function(e,t,n,i,r,o,s){return function(){function n(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};for(var r in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.view=e,this.systemVariable=e.systemVariable,this.options={position:"top-right",icon:"esri-icon-layers",title:"Biên tập dữ liệu"},i)this.options[r]=i[r];this.isStartup=!1,this.eventListener=new o(this),this.initView(),this.drawManager=new s(this.view),this.drawManager.on("draw-finish",function(e){t.eventListener.fire("draw-finish",e)})}return a(n,[{key:"startup",value:function(){var e=this;this.isStartup||(this.keydownEvent=this.view.on("key-down",function(t){"p"===t.key&&e.expand.toggle()}),this.view.ui.add(this.expand,this.options.position),this.isStartup=!0)}},{key:"destroy",value:function(){this.isStartup&&(this.keydownEvent&&this.keydownEvent.remove(),this.drawManager.clearEvents(),this.view.ui.remove(this.expand),this.isStartup=!1)}},{key:"initView",value:function(){var n=this;try{this.container=t.create("div",{class:"esri-widget ditagis-widget-layer-editor"});var i=t.create("ul",null,this.container);this.view.map.layers.map(function(r){r.then(function(){if("feature"==r.type){var a=r.permission;if(a&&a.create){var o=r.renderer.symbol||r.renderer.uniqueValueInfos[0].symbol,s=[];if(t.create("li",{innerHTML:r.title,class:"title"},i),r.renderer.symbol){var l=o.url,u=void 0;u=l?"<img src='"+l+"'></img>":'<svg overflow="hidden" width="30" height="30" style="touch-action: none;">\n                                    <path \n                                    fill="none" \n                                    fill-opacity="0" \n                                    stroke="rgb('+o.color.r+", "+o.color.g+","+o.color.b+')" \n                                    stroke-opacity="1" \n                                    stroke-width="1.3333333333333333" \n                                    path="M -15,0 L 15,0 E" d="M-15 0L 15 0" \n                                   transform="matrix(1.00000000,0.00000000,0.00000000,1.00000000,15.00000000,15.00000000)">\n                                   </path>\n                                   </svg>',s.push({symbol:u})}else{var c=void 0,d=!0,h=!1,p=void 0;try{for(var g,f=r.renderer.uniqueValueInfos[Symbol.iterator]();!(d=(g=f.next()).done);d=!0){var m=g.value,y=m.symbol;if("simple-marker-symbol"===y.type)c='<svg overflow="hidden" width="30" height="30" style="touch-action: none;">\n                                    <circle fill="rgb('+y.color.r+", "+y.color.g+","+y.color.b+')" \n                                    fill-opacity="1" \n                                    stroke="rgb(0, 0, 0)" \n                                    stroke-opacity="1" \n                                    stroke-width="1.3333333333333333" \n                                    x="0" cy="0" r="2.6666666666666665" \n                                    transform="matrix(1.00000000,0.00000000,0.00000000,1.00000000,15.00000000,15.00000000)">\n                                    </circle>\n                                    </svg>';else if("simple-line-symbol"===y.type)c='<svg overflow="hidden" width="30" height="30" style="touch-action: none;">\n                                    <path \n                                    fill="none" \n                                    fill-opacity="0" \n                                    stroke="rgb('+y.color.r+", "+y.color.g+","+y.color.b+')" \n                                    stroke-opacity="1" \n                                    stroke-width="1.3333333333333333" \n                                    path="M -15,0 L 15,0 E" d="M-15 0L 15 0" \n                                   transform="matrix(1.00000000,0.00000000,0.00000000,1.00000000,15.00000000,15.00000000)">\n                                   </path>\n                                   </svg>';else{c="<img src='"+y.url+"'></img>"}s.push({symbol:c,label:m.label,value:m.value})}}catch(e){h=!0,p=e}finally{try{!d&&f.return&&f.return()}finally{if(h)throw p}}}var v=function(a){var o=a.symbol,s=a.label,l=a.value,u=t.create("li",{class:"list-item"},i),c=t.create("div",{class:"item-container"},u);t.create("div",{innerHTML:o},c);s&&t.create("div",{innerHTML:s,class:"icon-label"},c),e(u,"click",function(e){n.layerItemClickHandler(r,l)})},T=!0,b=!1,w=void 0;try{for(var D,C=s[Symbol.iterator]();!(T=(D=C.next()).done);T=!0){v(D.value)}}catch(e){b=!0,w=e}finally{try{!T&&C.return&&C.return()}finally{if(b)throw w}}}}})}),this.expand=new r({expandIconClass:this.options.icon,expandTooltip:this.options.title,view:this.view,content:this.container})}catch(e){throw e}}},{key:"layerItemClickHandler",value:function(e,t){try{var n=e.renderer.field||e.typeIdField;switch(t&&(e.drawingAttributes={},e.drawingAttributes[n]=t),this.selectedFeature=e,e.geometryType){case"point":this.drawManager.drawSimple();break;default:console.log("Chưa được liệt kê")}this.expand.expanded=!1}catch(e){console.log(e)}}},{key:"selectedFeature",get:function(){return this.systemVariable.selectedFeature},set:function(e){this.drawManager.drawLayer=e,this.systemVariable.selectedFeature=e}}]),n}()}.apply(t,i))||(e.exports=r)},function(e,t,n){"use strict";var i,r;i=[n,t,n(0),n(1),n(7)],void 0===(r=function(e,t,n,i,r){return function(){function e(e){this.number=0,this.view=e.view,this.options={position:"top-left",icon:"esri-icon-documentation",title:"Lịch sử thao tác dữ liệu"},this.initView(),this.view.ui.add(this.expand,this.options.position)}return e.prototype.initView=function(){var e=i.create("div",{class:"editor-history-widget"}),t=i.create("div",{class:"results-container"},e);this.ul=i.create("ul",{class:"list-group",innerHTML:"<li class='list-group-item'><strong>Chưa có dữ liệu</strong></li>"},t),this.expand=new r({expandIconClass:this.options.icon,expandTooltip:this.options.title,view:this.view,content:e})},e.prototype.add=function(e){var t=this;0===this.number&&(this.ul.innerHTML="");var r=i.create("li",{class:"list-group-item"},this.ul);this.number++;var a=this.number/10<1?"0"+this.number:this.number,o=new Date,s=o.getHours()+":"+o.getMinutes()+":"+o.getSeconds();r.innerHTML='<div class="row">\n        <div class="col-1">\n        <span class="number">'+a+'</span></div>\n        <div class="col-2">\n        <strong class="name">'+e.layerName+"</strong>\n        <p>Thời gian: "+s+"</p></div></div>",e.geometry&&n(r,"click",function(n){t.view.goTo(e.geometry)})},e}()}.apply(t,i))||(e.exports=r)},function(e,t,n){"use strict";var i,r;i=[n,t,n(29)],void 0===(r=function(e,t,n){return function(){function e(){}return e.modal=function(e,t,i,r){try{var a=n.getBox().w+"px",o=void 0,s=void 0,l=void 0,u=void 0,c=void 0,d=void 0;(o=document.createElement("div")).classList.add("modal","fade"),o.id=e,o.setAttribute("tabindex","-1"),o.setAttribute("role","dialog"),o.setAttribute("aria-labelledby","myModalLabel"),o.setAttribute("aria-hidden","true"),(s=document.createElement("div")).classList.add("modal-dialog"),(l=document.createElement("div")).classList.add("modal-content"),l.style.maxWidth=a,l.style.width="fit-content",(u=document.createElement("div")).classList.add("modal-header");var h=document.createElement("button");h.type="button",h.classList.add("close"),h.setAttribute("data-dismiss","modal"),h.innerHTML='<span aria-hidden="true">×</span><span class="sr-only">Đóng</span>',u.appendChild(h),u.innerHTML+='<h4 class="modal-title">'+t+"</h4>",(c=document.createElement("div")).classList.add("modal-body"),c.appendChild(i),r&&((d=document.createElement("div")).classList.add("modal-footer"),d.appendChild(r)),l.appendChild(u),l.appendChild(c),d&&l.appendChild(d),s.appendChild(l),o.appendChild(s),document.body.appendChild(o);var p=$("#"+e);return p?(p.on("hidden.bs.modal",function(){p.remove()}),p):null}catch(e){throw e}},e}()}.apply(t,i))||(e.exports=r)},function(e,t,n){"use strict";var i,r;i=[n,t,n(12),n(2),n(28),n(8),n(4),n(3),n(36),n(10)],void 0===(r=function(e,t,n,i,r,a,o,s,l,u){var c=new o({outline:new s({color:new u("red")})});return function(){function e(e){this.mergeGraphics=new l,this.unionGraphic=null,this.mainGraphic=null,this.view=e.view,this.layer=e.layer,this.initWnd(),this.graphicLayers=new r({listMode:"hide"})}return Object.defineProperty(e.prototype,"isRun",{get:function(){return this._isRun},set:function(e){e?this.view.ui.add(this.widgetContainer,"top-right"):this.clear(),this._isRun=e},enumerable:!0,configurable:!0}),e.prototype.initWnd=function(){var e=document.createElement("div");e.id="dtg-wget-split-polygon",e.classList.add("esri-widget","esri-widget-button","esri-icon-close-circled"),e.title="Hủy",e.addEventListener("click",this.clear.bind(this)),this.widgetContainer=e},e.prototype.run=function(e){var t=this;this.mainGraphic=e,this.isRun=!0,this.graphicLayers.removeAll(),this.mergeGraphics.add(e),this.graphicLayers.add(new a({geometry:e.geometry,symbol:c})),this.view.map.add(this.graphicLayers),this.clickHandler=this.view.on("click",function(n){n.stopPropagation(),t.view.hitTest({x:n.x,y:n.y}).then(function(n){if(n.results.length>0){var r=n.results.find(function(e){return e.graphic.layer.id===i.TRONGTROT});if(r){if(r.graphic===e)return;t.mergeGraphics.some(function(e){return e===r.graphic})?t.remove(r.graphic):t.add(r.graphic)}}})}),this.dblClickHandler=this.view.on("double-click",this.dblClickHandlerEvent.bind(this))},e.prototype.add=function(e){this.graphicLayers.removeAll(),this.mergeGraphics.add(e);var t=n.union(this.mergeGraphics.map(function(e){return e.geometry}).toArray());return this.graphicLayers.add(new a({geometry:t,symbol:c})),this.unionGraphic=t,t},e.prototype.remove=function(e){this.graphicLayers.removeAll(),this.mergeGraphics.remove(e);var t=n.union(this.mergeGraphics.map(function(e){return e.geometry}).toArray());return this.graphicLayers.add(new a({geometry:t,symbol:c})),this.unionGraphic=t,t},e.prototype.dblClickHandlerEvent=function(e){if(e.stopPropagation(),confirm("Có chắc chắn ghép thửa?")){var t=this.mergeGraphics.slice(1,this.mergeGraphics.length).map(function(e){return{objectId:e.attributes.OBJECTID}}).toArray(),n=this.mainGraphic.clone();n.geometry=this.unionGraphic,this.layer.applyEdits({updateFeatures:[n],deleteFeatures:t})}this.clear()},e.prototype.clear=function(){this.view.ui.remove(this.widgetContainer),this.mainGraphic=null,this.clickHandler&&(this.clickHandler.remove(),delete this.clickHandler),this.graphicLayers.removeAll(),this.view.map.remove(this.graphicLayers),this.mergeGraphics.removeAll(),this.dblClickHandler&&(this.dblClickHandler.remove(),delete this.dblClickHandler)},e}()}.apply(t,i))||(e.exports=r)},function(e,t,n){"use strict";var i,r,a=function(e,t,n,i){return new(n||(n=Promise))(function(r,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(o,s)}l((i=i.apply(e,t||[])).next())})},o=function(e,t){var n,i,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(r=i[2&a[0]?"return":a[0]?"throw":"next"])&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[0,r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(r=(r=o.trys).length>0&&r[r.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};i=[n,t,n(1),n(0),n(46),n(27),n(4),n(3),n(10),n(8),n(38),n(37),n(12)],void 0===(r=function(e,t,n,i,r,s,l,u,c,d,h,p,g){return function(){function e(e,t){void 0===t&&(t={}),this.view=e,this.options={position:"top-right",icon:"esri-widget esri-widget-button esri-icon-basemap",icon_cancel:"esri-widget esri-widget-button esri-icon-close-circled",title:"Chia thửa",tooltip:{move:"Nhấn để vẽ đường chia thửa"}},this.initView()}return e.prototype.startup=function(e,t){var n=this;this.selectedFeature=e,this.layer=t,this.hightlightGraphic.clear(),this.hightlightGraphic.add(e),this.add_dtg_wget_cancel(),this.clickEvent=i(this.view,"click",function(e){n.clickHandler(e)}),this.pointerMoveEvent=i(this.view,"pointer-move",function(e){r.instance().show([e.x,e.y],n.options.tooltip.move),n.pointerMoveHandler(e)}),this.dblClickHandler=i(this.view,"double-click",function(e){e.stopPropagation(),n.finish(e)})},e.prototype.pointerMoveHandler=function(e){e.stopPropagation();var t={x:e.x,y:e.y},n=this.view.toMap(t),i=[n.x,n.y],r=[];if(this.vertices.length>0)for(var a=0,o=this.vertices;a<o.length;a++){var s=o[a];r.push(s)}r.push(i),this.refreshMainGraphic(r)},e.prototype.finish=function(e){var t={x:e.x,y:e.y},n=this.view.toMap(t),i=[n.x,n.y];this.vertices.push(i),this.refreshMainGraphic(this.vertices),this.xuly(),this.clearEvent()},e.prototype.xuly=function(){return a(this,void 0,void 0,function(){var e,t,n,i,r,a,s,l,u,c,f,m,y,v,T,b,w,D;return o(this,function(o){switch(o.label){case 0:if(!confirm("Có chắc chắn tách thửa?"))return[3,2];for(a in e=this.selectedFeature.attributes,t=this.selectedFeature.geometry,n=new h({paths:this.vertices,spatialReference:this.view.spatialReference}),i=g.cut(t,n),r=[],i)for(s=i[a],l=0,u=s.rings;l<u.length;l++)c=u[l],r.push(c);return[4,this.taoMaDoiTuong()];case 1:for(f=o.sent(),m=[],y=[],v=0;v<r.length;v++)T=new p({rings:r[v],spatialReference:this.view.spatialReference}),0==v?(w=new d({geometry:T,attributes:e}),m.push(w)):((b={}).LoaiCayTrong=e.LoaiCayTrong,b.OBJECTID=e.OBJECTID,b.MaHuyenTP=e.MaHuyenTP,b.NhomCayTrong=e.NhomCayTrong,b.MaDoiTuong=e.MaDoiTuong+"_"+(f+v),w=new d({geometry:T,attributes:b}),y.push(w));D={updateFeatures:m,addFeatures:y},this.layer.applyEdits(D),this.vertices=[],o.label=2;case 2:return[2]}})})},e.prototype.taoMaDoiTuong=function(){return a(this,void 0,void 0,function(){var e,t,n,i,r,a,s,l,u,c,d,h;return o(this,function(o){switch(o.label){case 0:return e=this.selectedFeature.attributes.MaDoiTuong,t=e.split("_"),n=t.length,(i=this.layer.createQuery()).outFields=["MaDoiTuong"],i.where="MaDoiTuong like '"+e+"[_]%'",[4,this.layer.queryFeatures(i)];case 1:for(r=o.sent(),a=0,s=0,l=r.features;s<l.length;s++)u=l[s],(c=u.attributes.MaDoiTuong)&&(d=c.split("_"),(h=parseInt(d[n]))>a&&(a=h));return[2,a]}})})},e.prototype.add_dtg_wget_cancel=function(){this.view.ui.add(this.DOM.cancel_wget,this.options.position)},e.prototype.initView=function(){var e=this;try{this.vertices=[],this.hightlightGraphic=new s(this.view,{symbolPlg:new l({style:"none",outline:new u({color:new c("#0000ff"),width:1})})}),this.DOM={},this.DOM.cancel_wget=n.create("div",{id:"dtg-wget-split-polygon",class:this.options.icon_cancel,title:"Hủy"}),i(this.DOM.cancel_wget,"click",function(t){e.clearEvent()})}catch(e){throw e}},e.prototype.clickHandler=function(e){e.stopPropagation();var t={x:e.x,y:e.y},n=this.view.toMap(t),i=[n.x,n.y];this.vertices.push(i),this.refreshMainGraphic(this.vertices)},e.prototype.refreshMainGraphic=function(e){try{if(this.graphic&&(this.view.graphics.remove(this.graphic),this.graphic=null),e){var t=new h({paths:e,spatialReference:this.view.spatialReference});this.graphic=new d({geometry:t,symbol:new u({color:new c([255,0,0]),width:1})}),this.view.graphics.add(this.graphic)}}catch(e){console.log(e)}},e.prototype.clearEvent=function(){this.clickEvent&&(this.clickEvent.remove(),this.clickEvent=null),this.pointerMoveEvent&&(r.instance().hide(),this.pointerMoveEvent.remove(),this.pointerMoveEvent=null),this.dblClickHandler&&(this.dblClickHandler.remove(),this.dblClickHandler=null),this.view.ui.remove(this.DOM.cancel_wget),this.vertices=[],this.hightlightGraphic.clear(),this.graphic&&(this.view.graphics.remove(this.graphic),this.graphic=null)},e}()}.apply(t,i))||(e.exports=r)},function(e,t,n){"use strict";var i;void 0===(i=function(e,t){return function(){function e(e){this.date=e}return e.prototype.checkOutOfDate=function(e){return!((new Date).getTime()-e>0)},e.prototype.checkUnexpired=function(e){return!this.checkOutOfDate(e)},e.formatDateValue=function(e){if(!e)return"";var t=e.getDate(),n=e.getMonth()+1,i=e.getFullYear();return t/10<1&&(t="0"+t),n/10<1&&(n="0"+n),i+"-"+n+"-"+t},e.formatNumberDate=function(e){if(!e)return"";var t=new Date(e),n=t.getDate(),i=t.getMonth()+1,r=t.getFullYear();return n/10<1&&(n="0"+n),i/10<1&&(i="0"+i),n+"/"+i+"/"+r},e}()}.apply(t,[n,t]))||(e.exports=i)},function(e,t,n){"use strict";var i,r;i=[n,t,n(29)],void 0===(r=function(e,t,n){return function(){function e(){}return e.modal=function(e,t,i,r){try{var a=n.getBox().w+"px",o=void 0,s=void 0,l=void 0,u=void 0,c=void 0,d=void 0;(o=document.createElement("div")).classList.add("modal","fade"),o.id=e,o.setAttribute("tabindex","-1"),o.setAttribute("role","dialog"),o.setAttribute("aria-labelledby","myModalLabel"),o.setAttribute("aria-hidden","true"),(s=document.createElement("div")).classList.add("modal-dialog"),(l=document.createElement("div")).classList.add("modal-content"),l.style.maxWidth=a,l.style.width="fit-content",(u=document.createElement("div")).classList.add("modal-header");var h=document.createElement("button");h.type="button",h.classList.add("close"),h.setAttribute("data-dismiss","modal"),h.innerHTML='<span aria-hidden="true">×</span><span class="sr-only">Đóng</span>',u.appendChild(h),u.innerHTML+='<h4 class="modal-title">'+t+"</h4>",(c=document.createElement("div")).classList.add("modal-body"),c.appendChild(i),r&&((d=document.createElement("div")).classList.add("modal-footer"),d.appendChild(r)),l.appendChild(u),l.appendChild(c),d&&l.appendChild(d),s.appendChild(l),o.appendChild(s),document.body.appendChild(o);var p=$("#"+e);return p?(p.on("hidden.bs.modal",function(){p.remove()}),p):null}catch(e){throw e}},e}()}.apply(t,i))||(e.exports=r)},function(e,t,n){"use strict";var i,r;i=[n,t,n(54),n(53),n(8),n(33),n(0),n(12),n(2),n(11)],void 0===(r=function(e,t,n,i,r,a,o,s,l,u){return function(){function e(e){this.view=e.view,this.thoiGianSanXuatTrongTrot=e.table,this.tblGiaiDoanSinhTruong=new a({url:u.tables.find(function(e){return e.id===l.TBL_GIAI_DOAN_SINH_TRUONG}).url,fieldID:"OBJECTID"}),this.dataDetails=[]}return Object.defineProperty(e.prototype,"selectFeature",{get:function(){return this.view.popup.viewModel.selectedFeature},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layer",{get:function(){return this.view.map.findLayerById(l.TRONGTROT)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"attributes",{get:function(){return this.selectFeature.attributes},enumerable:!0,configurable:!0}),e.prototype.getSubtype=function(e,t){if(e=e||this.layer.typeIdField,t=t||this.attributes[e],this.tblGiaiDoanSinhTruong.typeIdField===e){this.tblGiaiDoanSinhTruong.typeIdField;return this.tblGiaiDoanSinhTruong.types.find(function(e){return e.id==t})}return null},e.prototype.renderDomain=function(e,t){var n;if("inherited"===e.type){var i=this.layer.getFieldDomain(t);i&&(n=i.codedValues)}else n=e.codedValues;if(!n)return null;var r=this.attributes[t],a=document.createElement("select");a.classList.add("form-control");var o=document.createElement("option");o.value="-1",o.innerText="Chọn giá trị...",a.appendChild(o);for(var s=0,l=n;s<l.length;s++){var u=l[s],c=u.code,d=u.name,h=document.createElement("option");h.setAttribute("value",c),r===c&&(h.selected=!0),h.innerHTML=d,a.appendChild(h)}return a},e.prototype.addDetailTrongTrot=function(){var e,t,i,r,a,l,u,c,d,h,p,g=this,f=document.createElement("div");e=document.createElement("div"),(i=document.createElement("div")).classList.add("form-group"),(d=document.createElement("select")).id="LoaiCayTrong",d.classList.add("form-control"),(c=document.createElement("label")).innerText="Loại cây trồng",c.setAttribute("for",d.id),i.appendChild(c),i.appendChild(d),(t=document.createElement("div")).classList.add("form-group"),(p=document.createElement("select")).id="NhomCayTrong",p.classList.add("form-control");for(var m=0,y=this.layer.getFieldDomain("NhomCayTrong").codedValues;m<y.length;m++){var v=y[m],T=v.code,b=v.name,w=document.createElement("option");w.setAttribute("value",T+""),w.innerHTML=b,p.appendChild(w)}var D,C,E,x,L,M,N=function(){d.innerHTML="";var e=document.createElement("option");e.value="-1",e.innerText="Chọn giá trị...",d.appendChild(e);var t=g.getSubtype("NhomCayTrong",p.value);if(t){var n=t.domains.LoaiCayTrong;if(n){var i;if("inherited"===n.type){var r=g.layer.getFieldDomain("LoaiCayTrong");r&&(i=r.codedValues)}else i=n.codedValues;if(i)for(var a=0,o=i;a<o.length;a++){var s=o[a],l=s.code,u=s.name,c=document.createElement("option");c.setAttribute("value",l),c.innerHTML=u,d.appendChild(c)}}}};if(o(p,"change",function(){N()}),N(),(h=document.createElement("label")).innerText="Nhóm cây trồng",h.setAttribute("for",p.id),t.appendChild(h),t.appendChild(p),(r=document.createElement("div")).classList.add("form-group"),(C=document.createElement("input")).id="DienTich",C.classList.add("form-control"),this.selectFeature.geometry){var I=s.geodesicArea(this.selectFeature.geometry,"square-meters").toFixed(1);C.value=I+""}(D=document.createElement("label")).innerText="Diện tích (m2)",D.setAttribute("for",C.id),r.appendChild(D),r.appendChild(C),(l=document.createElement("div")).classList.add("form-group"),(E=document.createElement("input")).type="date",E.id="ThoiGianTrongTrot",E.classList.add("form-control"),(x=document.createElement("label")).innerText="Thời gian trồng trọt",x.setAttribute("for",E.id),l.appendChild(x),l.appendChild(E),(a=document.createElement("div")).classList.add("form-group"),(L=document.createElement("input")).type="date",L.id="ThoiGianBatDauTrong",L.classList.add("form-control"),(M=document.createElement("label")).innerText="Thời gian bắt đầu trồng",M.setAttribute("for",L.id),a.appendChild(M),a.appendChild(L),(u=document.createElement("button")).classList.add("btn","btn-primary"),u.innerText="Thêm",o(u,"click",function(){for(var e={OBJECTID:g.tmpDatasDetailTrongTrong.adds.length+1,MaDoiTuong:g.attributes.MaDoiTuong,NhomCayTrong:parseInt(p.value),LoaiCayTrong:-1==d.value?null:d.value,DienTich:C.value?parseFloat(C.value):0,ThoiGianBatDauTrong:L.value?new Date(L.value):null,ThoiGianTrongTrot:E.value?new Date(E.value):L.value?new Date(L.value):null,GiaiDoanSinhTruong:"Trồng mới"},t=(g.tmpDatasDetailTrongTrong.tableDatas,0),n=g.tmpDatasDetailTrongTrong.adds;t<n.length;t++){var i=n[t];if(e.LoaiCayTrong==i.LoaiCayTrong&&e.NhomCayTrong==i.NhomCayTrong&&e.ThoiGianBatDauTrong.getTime()===i.ThoiGianBatDauTrong.getTime())return void alert("Dữ liệu vừa mới thêm - Không được thêm nữa")}g.tmpDatasDetailTrongTrong.tableDatas.push(e),g.tmpDatasDetailTrongTrong.adds.push(e),g.addDataToDetailTrongtrot(e),$("#ModalDetail").modal("toggle")}),e.appendChild(t),e.appendChild(i),e.appendChild(r),e.appendChild(a),e.appendChild(l),f.appendChild(e);var O=document.createElement("div");O.appendChild(u),n.modal("ModalDetail","Thêm dữ liệu",f,O).modal()},e.prototype.editDetailTrongTrot=function(e){var t,r,a,s,l,u,c,d,h,p,g,f,m=this,y=document.createElement("div");t=document.createElement("div"),(a=document.createElement("div")).classList.add("form-group"),(p=document.createElement("select")).classList.add("form-control"),(h=document.createElement("label")).innerText="Loại cây trồng",a.appendChild(h),a.appendChild(p),(r=document.createElement("div")).classList.add("form-group"),(f=document.createElement("select")).classList.add("form-control");for(var v=0,T=this.layer.getFieldDomain("NhomCayTrong").codedValues;v<T.length;v++){var b=T[v],w=b.code,D=b.name,C=document.createElement("option");C.setAttribute("value",w+""),C.innerHTML=D,f.appendChild(C)}f.value=e.NhomCayTrong+"";var E,x,L,M,N,I,O,G,k=function(){p.innerHTML="";var e=document.createElement("option");e.value="-1",e.innerText="Chọn giá trị...",p.appendChild(e);var t=m.getSubtype("NhomCayTrong",f.value);if(t){var n=t.domains.LoaiCayTrong;if(n){var i;if("inherited"===n.type){var r=m.layer.getFieldDomain("LoaiCayTrong");r&&(i=r.codedValues)}else i=n.codedValues;if(i)for(var a=0,o=i;a<o.length;a++){var s=o[a],l=s.code,u=s.name,c=document.createElement("option");c.setAttribute("value",l),c.innerHTML=u,p.appendChild(c)}}}};o(f,"change",function(){k(),S()}),k(),p.value=e.LoaiCayTrong,o(p,"change",function(e){S()}),(g=document.createElement("label")).innerText="Nhóm cây trồng",r.appendChild(g),r.appendChild(f),(s=document.createElement("div")).classList.add("form-group"),(x=document.createElement("input")).type="number",x.value=e.DienTich+"",x.classList.add("form-control"),(E=document.createElement("label")).innerText="Diện tích (m2)",s.appendChild(E),s.appendChild(x),(l=document.createElement("div")).classList.add("form-group"),(L=document.createElement("input")).type="date",L.value=i.formatDateValue(e.ThoiGianTrongTrot),L.classList.add("form-control"),(M=document.createElement("label")).innerText="Thời gian trồng trọt",l.appendChild(M),l.appendChild(L),(u=document.createElement("div")).classList.add("form-group"),(N=document.createElement("input")).type="date",N.value=i.formatDateValue(e.ThoiGianBatDauTrong),N.classList.add("form-control"),(I=document.createElement("label")).innerText="Thời gian bắt đầu trồng",u.appendChild(I),u.appendChild(N),(c=document.createElement("div")).classList.add("form-group"),(O=document.createElement("label")).innerText="Giai đoạn sinh trưởng",(G=document.createElement("select")).classList.add("form-control");var F=document.createElement("option");F.value="Chưa xác định",F.innerText="Chọn giá trị...",F.selected=!0,G.appendChild(F);var S=function(){G.innerHTML="",G.appendChild(F),m.tblGiaiDoanSinhTruong.queryFeatures({where:"NhomCayTrong = "+f.value+" and LoaiCayTrong = '"+p.value+"'",outFields:["GiaiDoanSinhTruong"],orderByFields:["MocTG"]}).then(function(t){t.features.forEach(function(e){var t=e.attributes.GiaiDoanSinhTruong,n=document.createElement("option");n.value=n.innerText=t,G.appendChild(n)}),G.value=e.GiaiDoanSinhTruong})};c.appendChild(O),c.appendChild(G),(d=document.createElement("button")).classList.add("btn","btn-primary"),d.innerText="Chấp nhận",o(d,"click",function(){var t={OBJECTID:e.OBJECTID,NhomCayTrong:parseInt(f.value),LoaiCayTrong:"-1"==p.value?null:p.value,DienTich:x.value?parseFloat(x.value):0,ThoiGianTrongTrot:L.value?new Date(L.value):null,ThoiGianBatDauTrong:N.value?new Date(N.value):null,GiaiDoanSinhTruong:G.value};m.renderEditDetailTrongTrot(t),$("#ModalDetail").modal("toggle")}),t.appendChild(r),t.appendChild(a),t.appendChild(s),t.appendChild(u),t.appendChild(l),t.appendChild(c),y.appendChild(t);var H=document.createElement("div");H.appendChild(d),n.modal("ModalDetail","Sửa dữ liệu",y,H).modal()},e.prototype.showTableDetailTrongTrot=function(){var e=this,t=$.notify({message:"Đang tai dữ liệu..."},{showProgressbar:!0,delay:2e4,placement:{from:"top",align:"left"}});this.tmpDatasDetailTrongTrong={adds:[],edits:[],deletes:[],tableDatas:[],tbody:null},this.dataDetails=[];var i=document.createElement("div"),r=document.createElement("div");r.classList.add("table-responsive");var a=document.createElement("table");a.classList.add("table"),r.appendChild(a);var s=document.createElement("thead");s.innerHTML="<tr>\n          <th>Nhóm cây trồng</th>\n          <th>Loại cây trồng</th>\n          <th>Diện tích (m2)</th>\n          <th>Thời gian trồng trọt</th>\n          <th>Thời gian bắt đầu trồng</th>\n          <th>Giai đoạn sinh trưởng</th>\n          <th>Tác vụ</th>\n        </tr>",a.appendChild(s);var l=document.createElement("tbody");a.appendChild(l),this.tmpDatasDetailTrongTrong.tbody=l;var u=document.createElement("div"),c=document.createElement("button");c.classList.add("btn","btn-default"),c.innerText="Thêm dữ liệu",o(c,"click",function(){e.addDetailTrongTrot()});var d=document.createElement("button");d.classList.add("btn","btn-primary"),d.innerText="Chấp nhận",o(d,"click",function(){e.submitDetailTrongtrot(e.tmpDatasDetailTrongTrong)});var h=document.createElement("button");h.type="button",h.classList.add("btn","btn-default"),h.setAttribute("data-dismiss","modal"),h.innerText="Đóng",u.appendChild(d),u.appendChild(c),u.appendChild(h),i.appendChild(r),this.thoiGianSanXuatTrongTrot.findById(this.attributes.MaDoiTuong).then(function(r){r.features.length>0&&r.features.forEach(function(t){var n=t.attributes,i={DienTich:n.DienTich,GiaiDoanSinhTruong:n.GiaiDoanSinhTruong,MaDoiTuong:n.MaDoiTuong,LoaiCayTrong:n.LoaiCayTrong,NhomCayTrong:n.NhomCayTrong,OBJECTID:n.OBJECTID};n.ThoiGianBatDauTrong&&(i.ThoiGianBatDauTrong=new Date(n.ThoiGianBatDauTrong)),n.ThoiGianTrongTrot&&(i.ThoiGianTrongTrot=new Date(n.ThoiGianTrongTrot)),e.tmpDatasDetailTrongTrong.tableDatas.push(i),e.dataDetails.push(t.attributes);var r=e.renderDetailTrongtrot(i);l.appendChild(r)});n.modal("ttModal","Thời gian trồng trọt",i,u).modal(),t.update("type","success"),t.update("progress",90)})},e.prototype.renderEditDetailTrongTrot=function(e){var t=this;try{this.tmpDatasDetailTrongTrong.edits.map(function(n){n.OBJECTID==e.OBJECTID&&t.tmpDatasDetailTrongTrong.edits.splice(t.tmpDatasDetailTrongTrong.edits.indexOf(n))});var n=[];this.tmpDatasDetailTrongTrong.tableDatas.map(function(t){t.OBJECTID==e.OBJECTID?n.push(e):n.push(t)}),this.tmpDatasDetailTrongTrong.tableDatas=n,this.tmpDatasDetailTrongTrong.edits.push(e);for(var r=this.tmpDatasDetailTrongTrong.tbody.getElementsByTagName("tr"),a=void 0,o=0,s=r;o<s.length;o++){var l=s[o],u=parseInt(l.id);if(u==e.OBJECTID||u==e.ID){a=l;break}}var c=a.getElementsByTagName("td"),d=c[0],h=c[1],p=c[2],g=c[3],f=c[4],m=c[5],y=this.layer.getFieldDomain("NhomCayTrong").codedValues;if(y)(b=y.find(function(t){return t.code==e.NhomCayTrong}))&&(d.innerText=b.name);d.innerText||(d.innerText=e.NhomCayTrong+""||"");var v=this.getSubtype("NhomCayTrong",e.NhomCayTrong);if(!v)return;var T=v.domains.LoaiCayTrong;if(T){var b,w=void 0;if("inherited"===T.type){var D=this.layer.getFieldDomain("LoaiCayTrong");D&&(w=D.codedValues)}else w=T.codedValues;if(w)(b=w.find(function(t){return t.code==e.LoaiCayTrong}))&&(h.innerText=b.name)}h.innerText||(h.innerText=e.LoaiCayTrong||""),p.innerText=e.DienTich+""||"0",g.innerText=i.formatDateValue(e.ThoiGianTrongTrot),f.innerText=i.formatDateValue(e.ThoiGianBatDauTrong),m.innerText=e.GiaiDoanSinhTruong}catch(e){throw"Có lỗi xảy ra trong quá trình thực hiện"}},e.prototype.renderDetailTrongtrot=function(e,t){var n=this;void 0===t&&(t=!1);try{var r=document.createElement("tr");r.id=e.OBJECTID||e.ID,t&&r.classList.add("info");var a=document.createElement("td"),s=this.layer.getFieldDomain("NhomCayTrong").codedValues;if(s)(d=s.find(function(t){return t.code==e.NhomCayTrong}))&&(a.innerText=d.name);a.innerText||(a.innerText=e.NhomCayTrong+""||"");var l=document.createElement("td"),u=this.getSubtype("NhomCayTrong",e.NhomCayTrong);if(!u)return;var c=u.domains.LoaiCayTrong;if(c){var d,h=void 0;if("inherited"===c.type){var p=this.layer.getFieldDomain("LoaiCayTrong");p&&(h=p.codedValues)}else h=c.codedValues;if(h)(d=h.find(function(t){return t.code==e.LoaiCayTrong}))&&(l.innerText=d.name)}l.innerText||(l.innerText=e.LoaiCayTrong||"");var g=document.createElement("td");g.innerText=e.DienTich+""||"0";var f=document.createElement("td");f.innerText=i.formatDateValue(e.ThoiGianTrongTrot);var m=document.createElement("td");m.innerText=i.formatDateValue(e.ThoiGianBatDauTrong);var y=document.createElement("td"),v=document.createElement("td");v.innerText=e.GiaiDoanSinhTruong||"N/A";var T=document.createElement("span");T.classList.add("esri-icon-edit"),o(T,"click",function(t){n.tmpDatasDetailTrongTrong.tableDatas.map(function(t){t.OBJECTID==e.OBJECTID&&n.editDetailTrongTrot(t)})});var b=document.createElement("span");return b.classList.add("esri-icon-trash"),o(b,"click",function(){e.OBJECTID&&(n.tmpDatasDetailTrongTrong.deletes.push(e.OBJECTID),n.tmpDatasDetailTrongTrong.tableDatas.map(function(t){if(t.OBJECTID==e.OBJECTID){var i=n.tmpDatasDetailTrongTrong.tableDatas.indexOf(t);n.tmpDatasDetailTrongTrong.tableDatas.splice(i,1)}})),n.tmpDatasDetailTrongTrong.tbody.removeChild(r);var t=n.tmpDatasDetailTrongTrong.adds.find(function(t){return t.OBJECTID==e.OBJECTID});t&&n.tmpDatasDetailTrongTrong.adds.splice(n.tmpDatasDetailTrongTrong.adds.indexOf(t))}),y.appendChild(T),y.appendChild(b),r.appendChild(a),r.appendChild(l),r.appendChild(g),r.appendChild(f),r.appendChild(m),r.appendChild(v),r.appendChild(y),r}catch(e){throw e}},e.prototype.addDataToDetailTrongtrot=function(e){var t=this.renderDetailTrongtrot(e,!0);this.tmpDatasDetailTrongTrong.tbody.appendChild(t)},e.prototype.submitData=function(e){var t,n=[];e.tableDatas.map(function(t){e.adds.some(function(e){return e.OBJECTID==t.OBJECTID})&&n.push(t)}),this.tmpDatasDetailTrongTrong.adds=n,t=e.edits.filter(function(t){return e.adds.indexOf(t)}),this.tmpDatasDetailTrongTrong.edits=t},e.prototype.submitDetailTrongtrot=function(e){var t=this;this.submitData(e);var n={addFeatures:[],updateFeatures:[],deleteFeatures:[]};if(e.deletes.length>0&&(n.deleteFeatures=e.deletes),e.adds.length>0)for(var i=0,r=e.adds;i<r.length;i++){var a={DienTich:(l=r[i]).DienTich,GiaiDoanSinhTruong:l.GiaiDoanSinhTruong,LoaiCayTrong:l.LoaiCayTrong,MaDoiTuong:l.MaDoiTuong,NhomCayTrong:l.NhomCayTrong};l.ThoiGianBatDauTrong&&(a.ThoiGianBatDauTrong=l.ThoiGianBatDauTrong.getTime()),l.ThoiGianTrongTrot&&(a.ThoiGianTrongTrot=l.ThoiGianTrongTrot.getTime()),n.addFeatures.push({attributes:a})}if(e.edits.length>0)for(var o=0,s=e.edits;o<s.length;o++){var l;a={DienTich:(l=s[o]).DienTich,GiaiDoanSinhTruong:l.GiaiDoanSinhTruong,LoaiCayTrong:l.LoaiCayTrong,MaDoiTuong:l.MaDoiTuong,NhomCayTrong:l.NhomCayTrong,OBJECTID:l.OBJECTID};l.ThoiGianBatDauTrong&&(a.ThoiGianBatDauTrong=l.ThoiGianBatDauTrong.getTime()),l.ThoiGianTrongTrot&&(a.ThoiGianTrongTrot=l.ThoiGianTrongTrot.getTime()),n.updateFeatures.push({attributes:a})}this.thoiGianSanXuatTrongTrot.applyEdits(n).then(function(n){t.refreshNhomCayTrong(t.dataDetails,e.adds),t.tmpDatasDetailTrongTrong=null,t.dataDetails=null}),$("#ttModal").modal("toggle")},e.prototype.refreshNhomCayTrong=function(e,t){var n=this;if(0!==t.length){var i=e.filter(function(e){return e.NhomCayTrong===n.attributes.NhomCayTrong}),a=!1;if(i.length>0){var o={};for(var s in i.forEach(function(e){var t=e.ThoiGianBatDauTrong;o[t]||(o[t]=[]),o[t].push(e.GiaiDoanSinhTruong)}),o){if(-1!==o[s].indexOf("Thu hoạch")){a=!0;break}}}else a=!0;if(a){var l=t[0];this.layer.applyEdits({updateFeatures:[new r({attributes:{OBJECTID:this.attributes.OBJECTID,NhomCayTrong:l.NhomCayTrong}})]})}}},e}()}.apply(t,i))||(e.exports=r)},function(e,t,n){"use strict";var i,r;i=[n,t,n(2),n(11),n(0),n(1),n(5),n(35),n(39),n(34),n(55),n(33),n(52),n(51)],void 0===(r=function(e,t,n,i,r,a,o,s,l,u,c,d,h,p){return function(){function e(e,t){var r=this;this.view=e,this.options=t,this.locateViewModel=new l({view:e,graphic:null}),this.tblGiaiDoanSinhTruong=new d({url:i.tables.find(function(e){return e.id===n.TBL_GIAI_DOAN_SINH_TRUONG}).url,fieldID:"OBJECTID"}),this.fireFields=["NgayCapNhat","NguoiCapNhat","MaPhuongXa","MaHuyenTP","MaDoiTuong"],this.inputElement={},this.thoiGianSanXuatTrongTrotPopup=new c({view:e,table:t.table}),this.thoiGianSanXuatTrongTrotTbl=t.table,"/congtacvien"!==location.pathname&&(this._splitPolygon=new h(e),this.view.on("layerview-create",function(t){t.layer.id===n.TRONGTROT&&(r._mergePolygon=new p({view:e,layer:t.layer}))}))}return Object.defineProperty(e.prototype,"selectFeature",{get:function(){return this.view.popup.viewModel.selectedFeature},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layer",{get:function(){return this.selectFeature.layer||this._layer},set:function(e){this.selectFeature.layer||(this._layer=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"attributes",{get:function(){return this.selectFeature.attributes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"objectId",{get:function(){return this.attributes.OBJECTID},enumerable:!0,configurable:!0}),e.prototype.resetInputElement=function(){this.inputElement={}},e.prototype.isFireField=function(e){return-1!==this.fireFields.indexOf(e)},e.prototype.getSubtype=function(e,t){if(e=e||this.layer.typeIdField,t=t||this.attributes[e],this.tblGiaiDoanSinhTruong.typeIdField===e){this.tblGiaiDoanSinhTruong.typeIdField;return this.tblGiaiDoanSinhTruong.types.find(function(e){return e.id==t})}return null},e.prototype.renderDomain=function(e,t){var n;if("inherited"===e.type){var i=this.layer.getFieldDomain(t);i&&(n=i.codedValues)}else n=e.codedValues;if(!n)return null;var r=this.attributes[t],a=document.createElement("select");a.classList.add("form-control");var o=document.createElement("option");o.value="-1",o.innerText="Chọn giá trị...",a.appendChild(o);for(var s=0,l=n;s<l.length;s++){var u=l[s],c=u.code,d=u.name,h=document.createElement("option");h.setAttribute("value",c),r===c&&(h.selected=!0),h.innerHTML=d,a.appendChild(h)}return a},e.prototype.showEdit=function(){var e=this,t=this.getSubtype();this.resetInputElement();for(var i=a.create("div",{id:"show-edit-container",class:"popup-content"}),r=a.create("table",{class:"table"},i),o=0,l=this.layer.fields;o<l.length;o++){var u=l[o];if("oid"!==u.type&&!this.isFireField(u.name)){var c=a.create("tr"),d=a.create("td",{innerHTML:u.alias}),h=void 0,p=a.create("td");if(t&&t.domains[u.name])h=this.renderDomain(t.domains[u.name],u.name);else if(u.domain)h=this.renderDomain(u.domain,u.name);else{var g=void 0,f=void 0;if("small-integer"===u.type||"integer"===u.type||"double"===u.type)g="number";else if("date"===u.type){g="date";var m=new Date(this.attributes[u.name]),y=m.getDate(),v=m.getMonth()+1,T=m.getFullYear();y/10<1&&(y="0"+y),v/10<1&&(v="0"+v),f=T+"-"+v+"-"+y}else g="text";h=length>=this.options.hightLength?a.create("textarea",{rows:5,cols:25,class:"form-control",innerHTML:f||this.attributes[u.name],value:f||this.attributes[u.name]}):a.create("input",{type:g,value:f||this.attributes[u.name],class:"form-control"})}h.name=u.name,a.place(h,p),a.place(d,c),a.place(p,c),a.place(c,r),this.inputElement[u.name]=h,this.registerChangeEvent(h)}}for(var b in this.layer.hasAttachments&&this.layer.getAttachments(this.objectId).then(function(t){var n=a.create("div",{class:"attachment-header",id:"attachment-"+e.layer.id+"-"+e.attributes.OBJECTID},document.getElementById("show-edit-container"));n.innerText="Hình ảnh";var i=document.createElement("form");i.id="attachment-data",i.enctype="multipart/form-data",i.method="post";var r=document.createElement("input");r.type="file",r.name="attachment",i.appendChild(r);var o=document.createElement("input");if(o.hidden=!0,o.name="f",o.value="json",i.appendChild(o),n.appendChild(i),e.registerChangeEvent(r),t&&t.attachmentInfos&&t.attachmentInfos.length>0)for(var s=0,l=t.attachmentInfos;s<l.length;s++){var u=l[s];e.renderAttachmentEditPopup(u,{container:n})}}),this.inputElement)this.inputChangeHandler(this.inputElement[b]);this.view.popup.content=i,this.view.popup.title=this.layer.title;var w=this.view.popup.actions.find(function(e){return"update"===e.id});w.className="esri-icon-check-mark",this.view.popup.actions.add({id:"update-geometry",title:"Cập nhật vị trí đối tượng",className:"esri-icon-locate"});var D=this.view.popup.actions.find(function(e){return"view-detail"===e.id});this.layer.id===n.TRONGTROT&&D&&(D.id="view-detail-edit");var C=function(){w.className="esri-icon-edit";var t=e.view.popup.actions.find(function(e){return"update-geometry"===e.id});t&&e.view.popup.actions.remove(t),e.layer.id===n.TRONGTROT&&D&&(D.id="view-detail")};s.once(this.view.popup,"selectedFeature").then(C),s.once(this.view.popup,"visible").then(C)},e.prototype.renderAttachmentEditPopup=function(e,t){var n=this,i=t.container||document.getElementById("attachment-"+this.layer.id+"-"+this.attributes.OBJECTID),o=this.layer.url+"/"+this.layer.layerId+"/"+this.attributes.OBJECTID,s=a.create("div",{class:"attachment-item"},i),l=a.create("div",{class:"attachment-name"},s);a.create("a",{href:o+"/attachments/"+e.id,target:"_blank"},l).innerText=e.name;var u=a.create("div",{class:"delete-attachment esri-icon-trash"},s);r(u,"click",function(){n.attributes.deleteAttachment||(n.attributes.deleteAttachment=[]),n.attributes.deleteAttachment.push(o+"/deleteAttachments?f=json&attachmentIds="+e.id),i.removeChild(s)})},e.prototype.registerChangeEvent=function(e){var t=this;r(e,"change",function(){return t.inputChangeHandler(e)})},e.prototype.inputChangeHandler=function(e){var t=e.name,n=e.value;if(n)if(-1!=n){if("attachment"===t)this.attributes[t]=n;else{var i=this.layer.fields.find(function(e){return e.name===t});if(i){var r=i.type;if(r){var a=void 0;a="small-integer"===r||"integer"===r?parseInt(n):"double"===r?parseFloat(n):n,this.attributes[t]=a}}}var o=this.getSubtype(t);if(o)for(var s in o.domains){var l=o.domains[s],u=this.inputElement[s];if(u){var c=void 0;if("inherited"===l.type){var d=this.layer.getFieldDomain(s);d&&(c=d.codedValues)}else c=l.codedValues;if("SELECT"===u.tagName){u.innerHTML="",(f=document.createElement("option")).value="-1",f.innerText="Chọn giá trị...",u.appendChild(f);for(var h=0,p=c;h<p.length;h++){var g=p[h];(T=document.createElement("option")).setAttribute("value",g.code),T.innerText=g.name,g.code===this.attributes[s]&&T.setAttribute("selected","selected"),u.appendChild(T)}this.attributes[s]=-1==u.value?null:u.value}else{var f,m=document.createElement("select");m.classList.add("form-control"),m.setAttribute("name",s),(f=document.createElement("option")).value="-1",f.innerText="Chọn giá trị...",m.appendChild(f),this.registerChangeEvent(m);for(var y=0,v=c;y<v.length;y++){var T;g=v[y];(T=document.createElement("option")).setAttribute("value",g.code),T.innerText=g.name,m.appendChild(T)}if(u.parentElement){var b=u.parentElement;u.parentElement.removeChild(b.firstChild),b.appendChild(m)}this.attributes[s]=-1==u.value?null:u.value,this.inputElement[s]=m}}}}else this.attributes[t]=null},e.prototype.uploadFile=function(){var e=this.layer.url+"/"+this.layer.layerId+"/"+this.objectId+"/addAttachment",t=document.getElementById("attachment-data");t&&o(e,{responseType:"json",body:t}).then(function(e){e.data&&e.data.addAttachmentResult&&e.data.addAttachmentResult.success?$.notify({message:"Thêm hình ảnh thành công"},{type:"success",placement:{from:"top",align:"left"}}):$.notify({message:"Thêm hình ảnh không thành công"},{type:"danger",placement:{from:"top",align:"left"}})})},e.prototype.editFeature=function(){var e=this,t=$.notify({title:"<strong>Cập nhật <i>"+this.layer.title+"</i></strong>",message:"Cập nhật..."},{showProgressbar:!0,delay:2e4,placement:{from:"top",align:"left"}});try{if(this.attributes){if(this.attributes.attachment&&this.uploadFile(),this.attributes.deleteAttachment){for(var n=0,i=this.attributes.deleteAttachment;n<i.length;n++){var r=i[n];o(r)}this.attributes.deleteAttachment=[]}for(var a=0,s=this.layer.fields;a<s.length;a++){var l=s[a],c=l.type,d=l.name;if("date"===c){var h=this.attributes[d];if(h&&!Number.isInteger(h)){var p=h.split("-");if(3!=p.length)throw"Không thể lấy dữ liệu thời gian";var g=p[2],f=p[1],m=p[0],y=new Date(f+"/"+g+"/"+m).getTime();this.attributes[d]=y}}}var v=u.getUpdatedInfo(this.view);for(var T in v)this.attributes[T]=v[T];this.layer.applyEdits({updateFeatures:[{attributes:this.attributes}]}).then(function(n){for(var i=!1,r=0,a=n.updateFeatureResults;r<a.length;r++){if(a[r].error){i=!0;break}}if(!i){t.update("type","success"),t.update("message","Cập nhật thành công!"),t.update("progress",90);var o=e.layer.createQuery();o.outFields=["*"],o.where="OBJECTID="+e.attributes.OBJECTID,e.layer.queryFeatures(o).then(function(t){e.view.popup.open({features:t.features})})}})}}catch(e){throw t.update("type","danger"),t.update("message","Có lỗi xảy ra trong quá trình cập nhật!"),t.update("progress",90),e}},e.prototype.deleteFeature=function(){var e=this;if(confirm("Chắc chắn muốn xóa?")){var t=this.objectId,n=$.notify({title:"<strong>Xóa <i>"+this.layer.title+"</i></strong>",message:"Đang xóa..."},{showProgressbar:!0,delay:2e4});this.layer.applyEdits({deleteFeatures:[{objectId:t}]}).then(function(t){t.deleteFeatureResults.length>0&&!t.deleteFeatureResults[0].error&&(e.view.popup.visible=!1,n.update("type","success"),n.update("message","Xóa thành công!"),n.update("progress",100))})}},e.prototype.splitPolygon=function(){this.view.popup.visible=!1,this._splitPolygon.startup(this.selectFeature,this.layer)},e.prototype.mergePolygon=function(){this.view.popup.visible=!1,this._mergePolygon.run(this.selectFeature)},e.prototype.updateGeometryGPS=function(){var e=this,t=this.objectId;$.notify({message:"Chọn vị trí trên bản đồ"});var n=$.notify({title:"<strong>Cập nhật vị trí</strong>",message:"Cập nhật..."},{showProgressbar:!0,delay:2e4,placement:{from:"top",align:"left"}}),i=this.view.on("click",function(r){r.stopPropagation(),e.layer.applyEdits({updateFeatures:[{attributes:{objectId:t,NguoiCapNhat:e.view.systemVariable.user.userName,NgayCapNhat:(new Date).getTime()},geometry:r.mapPoint}]}).then(function(t){t.updateFeatureResults[0].error?(n.update("type","danger"),n.update("message","Cập nhật không thành công!"),n.update("progress",90)):(n.update("type","success"),n.update("message","Cập nhật thành công!"),n.update("progress",90),e.view.popup.close())}),i.remove()})},e.prototype.showTableDetailTrongTrot=function(){this.thoiGianSanXuatTrongTrotPopup.showTableDetailTrongTrot()},e}()}.apply(t,i))||(e.exports=r)},function(e,t,n){"use strict";var i,r;i=[n,t,n(0),n(8),n(6),n(47),n(26),n(46)],void 0===(r=function(e,t,n,i,r,a,o,s){return function(){function e(e){this.options={tooltip:{move:"Nhấn vào màn hình để vẽ"}},this.view=e,this.systemVariable=e.systemVariable,this.drawLayer=new a(e),this.eventListener=new o(this)}return e.prototype.draw=function(e){var t=this;this.drawLayer.layer=e,this.clickEvent=n(this.view,"click",function(e){t.clickHandler(e)}),this.pointerMoveEvent=n(this.view,"pointer-move",function(e){s.instance().show([e.x,e.y],t.options.tooltip.move)})},e.prototype.clearEvents=function(){this.clickEvent&&(this.clickEvent.remove(),this.clickEvent=null),this.pointerMoveEvent&&(s.instance().hide(),this.pointerMoveEvent.remove(),this.pointerMoveEvent=null)},e.prototype.clickHandler=function(e){var t;e.stopPropagation(),t=new i({geometry:this.view.toMap({x:e.x,y:e.y}),symbol:new r}),this.eventListener.fire("draw-finish",t),this.clearEvents()},e}()}.apply(t,i))||(e.exports=r)},function(e,t,n){"use strict";var i,r;i=[n,t,n(57),n(47),n(26)],void 0===(r=function(e,t,n,i,r){return function(){function e(e){this.view=e,this._drawLayer=null,this.systemVariable=e.systemVariable,this.simpleDrawPoint=new n(this.view),this.eventListener=new r(this),this.pointEditing=new i(this.view),this.registerEvent()}return e.prototype.addFeature=function(e){if(confirm("Chắc chắn muốn thêm?"))return this.pointEditing.draw(this.drawLayer,e)},e.prototype.registerEvent=function(){var e=this;this.simpleDrawPoint.on("draw-finish",function(t){e.addFeature(t).then(function(n){e.eventListener.fire("draw-finish",{graphic:{layer:e.drawLayer,attributes:t.attributes,geometry:t.geometry},method:"simple"})})})},Object.defineProperty(e.prototype,"drawLayer",{get:function(){return this._drawLayer},set:function(e){this._drawLayer=e},enumerable:!0,configurable:!0}),e.prototype.drawSimple=function(){this.clearEvents(),this.simpleDrawPoint.draw(this.drawLayer)},e.prototype.clearEvents=function(){this.simpleDrawPoint.clearEvents()},e}()}.apply(t,i))||(e.exports=r)},,,,function(e,t,n){"use strict";var i,r;i=[n(15),n(25),n(24),n(23),n(22),n(21),n(7),n(20),n(19),n(18),n(17),n(9),n(16),n(5),n(13),n(6),n(4),n(3),n(14),n(2),n(11),n(30),n(44),n(49),n(48),n(41),n(40),n(27)],void 0===(r=function(e,t,n,i,r,a,o,s,l,u,c,d,h,p,g,f,m,y,v,T,b,w,D,C,E,x,L,M){var N,I,O,G=new w,k=new e({}),F=new D({container:"map",map:k,center:b.center,zoom:b.zoom});F.session().then(function(e){G.user=e;var t=void 0;7===Math.floor(G.user.role/100)&&(t="MaHuyenTP = '"+G.user.role.trim()+"'"),F.systemVariable=G;var n=function(){function e(){var e=$("<div/>",{class:"google-geocoding-widget input-group add-on"}),t=$("<input/>",{class:"form-control",type:"text",name:"srch-term",id:"srch-term",placeholder:"Nhập đơn vị hành chính, tên đường "}).appendTo(e),n=$("<div/>",{class:"input-group-btn"}).appendTo(e),i=$("<button/>",{class:"btn btn-default",type:"submit"}).appendTo(n),r=($("<i/>",{class:"glyphicon glyphicon-search"}).appendTo(i),$("<div/>",{class:"output-group add-on",id:"ketqua"}));F.ui.add(e[0],"top-right"),F.ui.add(r[0],"top-right"),i.on("click",function(e){function n(){var e=document.getElementById("ketqua");if(e)for(;e.firstChild;)e.removeChild(e.firstChild)}var i=t.val().toString().replace(/[ ]/g,"+");$.get("https://maps.googleapis.com/maps/api/geocode/json?address="+i+"&key=AIzaSyC9VTEqoczK2j7lDRacfQ3aRTE3f4vuHek").done(function(e){var t=e.results;n();var i=function(e){var t=$("<div />",{class:"address list-group-item"}).appendTo(r);$("<div />",{class:"address-detail",text:e.formatted_address}).appendTo(t).click(function(){return t=e.geometry.viewport,i=new v({ymin:t.southwest.lat,ymax:t.northeast.lat,xmin:t.southwest.lng,xmax:t.northeast.lng}),F.goTo(i),void n();var t,i})},a=!0,o=!1,s=void 0;try{for(var l,u=t[Symbol.iterator]();!(a=(l=u.next()).done);a=!0){i(l.value)}}catch(e){o=!0,s=e}finally{try{!a&&u.return&&u.return()}finally{if(o)throw s}}})})}e(),new x(F).startup(),F.ui.move(["zoom"],"top-left"),F.ui.add(new o({expandIconClass:"esri-icon-layer-list",view:F,content:new l({container:document.createElement("div"),view:F})}),"top-left"),F.ui.add(new s({view:F}),"top-left"),F.ui.add(new o({expandIconClass:"esri-icon-collection",content:new u({view:F})}),"top-left");var n=new M(F,{symbolPlg:new m({style:"none",outline:new y({color:"black",width:3})})}),e=new c({searchAllEnabled:!1,view:F,allPlaceholder:"Nhập nội dung tìm kiếm",sources:[{featureLayer:k.findLayerById(T.SAUBENH),searchFields:["OBJECTID","MaSauBenh","MaHuyenTP"],displayField:"MaSauBenh",exactMatch:!1,outFields:["*"],name:"Sâu hại",placeholder:"Tìm kiếm theo tên, loại cây trồng, huyện/tp"},{featureLayer:k.findLayerById(T.DOANHNGHIEP),searchFields:["OBJECTID","MaDoanhNghiep","NguoiDaiDienDoanhNghiep"],displayField:"NguoiDaiDienDoanhNghiep",exactMatch:!1,outFields:["*"],name:"Doanh Nghiệp",placeholder:"Nhập tên hoặc mã Doanh nghiệp"},{featureLayer:k.findLayerById(T.TRONGTROT),searchFields:["MaDoiTuong"],displayField:"MaDoiTuong",exactMatch:!1,outFields:["*"],name:"Trồng Trọt",placeholder:"Nhập mã đối tượng Trồng trọt"},{featureLayer:new r({url:"https://ditagis.com:6443/arcgis/rest/services/BinhDuong/DuLieuNen/MapServer/4"}),searchFields:["MaPhuongXa","TenXa"],displayField:"TenXa",outFields:["*"],filter:{where:""+(t||"1=1")},name:"Hành chính xã",placeholder:"Nhập tên xã/ phường",popupOpenOnSelect:!1,resultGraphicEnabled:!1}]});F.ui.add(e,{position:"top-right"}),e.on("search-complete",function(e){n.clear();var t=e.results.find(function(e){return 4===e.sourceIndex});if(t&&t.results.length>0){var i=t.results[0].feature;n.add(i)}});var i=new E(F);i.startup(),new L(F).startup();var a=new C({view:F});i.on("draw-finish",function(e){a.add({layerName:e.graphic.layer.title,geometry:e.graphic.geometry})})};!function(){var e=b.basemap;if(t){var n=!0,r=!1,o=void 0;try{for(var s,l=e.sublayers[Symbol.iterator]();!(n=(s=l.next()).done);n=!0)s.value.definitionExpression=t}catch(e){r=!0,o=e}finally{try{!n&&l.return&&l.return()}finally{if(r)throw o}}}function u(e,t,n,i){if(e)switch(i){case O:N.visible=I.visible=!e;break;case N:O.visible=I.visible=!e;break;case I:O.visible=N.visible=!e}}(N=new i(e)).watch("visible",function(e){$&&$.notify(e?"Hiển thị dữ liệu nền":"Ẩn dữ liệu nền")}),N.then(function(){if(t){var e=N.findSublayerById(T.INDEX_HANHCHINHHUYEN),n=e.createQuery();n.where=t,n.returnGeometry=!0,n.outSpatialReference=F.spatialReference,e.queryFeatures(n).then(function(e){var t=e.features[0];F.goTo({target:t.geometry})})}}),I=new a({urlTemplate:"//mt1.google.com/vt/lyrs=y&x={col}&y={row}&z={level}",title:"Ảnh vệ tinh",id:"worldimagery",visible:!1}),O=new a({title:"Đường đi",urlTemplate:"//mt1.google.com/vt/lyrs=m&x={col}&y={row}&z={level}",id:"osm",visible:!1}),k.addMany([O,I,N]),O.watch("visible",u),I.watch("visible",u),N.watch("visible",u)}(),(r.prototype.getAttachments=function(e){var t=this;return new Promise(function(n,i){var r=t.url+"/"+t.layerId+"/"+e;p(r+"/attachments?f=json",{responseType:"json",method:"get"}).then(function(e){n(e.data||null)})})},new Promise(function(e,n){p("/map/layerrole",{method:"post"}).then(function(n){if(!n.data)throw"cannot request permission";var i=function(e){b.layers.find(function(t){return t.id===e.layer}).permission={create:e.isCreate,view:e.isView,delete:e.isDelete,edit:e.isEdit}},a=!0,o=!1,s=void 0;try{for(var l,u=n.data[Symbol.iterator]();!(a=(l=u.next()).done);a=!0)i(l.value)}catch(e){o=!0,s=e}finally{try{!a&&u.return&&u.return()}finally{if(o)throw s}}for(var c in b.layers){var d=b.layers[c];if(d.permission.view){if(d.id===T.SAUBENH){var h=new Date;h.setDate(h.getDate()-365),d.definitionExpression="NgayXayRa >= date '"+h.getFullYear()+"-"+(h.getMonth()+1)+"-"+h.getDate()+" "+h.getHours()+":"+h.getMinutes()+":"+h.getSeconds()+"'",d.renderer=new g({field:"CapDoGayHai",uniqueValueInfos:[{value:"1",symbol:new f({color:"#0f0",style:"circle",outline:{color:"white"}}),label:"Nhẹ"},{value:"2",symbol:new f({color:"#00a9e6",style:"circle",outline:{color:"white"}}),label:"Nặng"},{value:"3",symbol:new f({color:"#ff0000",style:"circle",outline:{color:"white"}}),label:"Mất trắng"},{value:"4",symbol:new f({color:"#ffff6d",style:"circle",outline:{color:"white"}}),label:"Trung bình"}]})}t&&(d.definitionExpression?d.definitionExpression+=" and "+t:d.definitionExpression=t,d.definitionExpression=t),d.id===T.TRONGTROT&&(d.opacity=.7);var p=new r(d);k.add(p)}}var m=new r({id:"danhdauvitri",title:"Vị trí đánh dấu",outFields:["*"],url:"https://ditagis.com:6443/arcgis/rest/services/BinhDuong/BaoVeThucVat_DanhDauViTri/FeatureServer/0",permission:{create:!1,view:!0,delete:!0,edit:!1}});k.add(m),e()})})).then(function(){n(),k.reorder(N,5)})})}.apply(t,i))||(e.exports=r)}])});