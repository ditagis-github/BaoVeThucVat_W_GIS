(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[,,function(e,t,n){"use strict";var i;void 0===(i=function(e,t){return{BASEMAP:"dulieunen",SAUBENH:"SauBenh",DOANHNGHIEP:"DoanhNghiep",TRONGTROT:"TrongTrot",INDEX_HANHCHINHXA:4,INDEX_HANHCHINHHUYEN:5,TABLE_SXTT_URL:"https://ditagis.com:6443/arcgis/rest/services/BinhDuong/BaoVeThucVat/FeatureServer/3",THOI_GIAN_SAN_XUAT_TRONG_TROT:"thoigiansxtt",TBL_GIAI_DOAN_SINH_TRUONG:"tblgiaidoansinhtruong"}}.apply(t,[n,t]))||(e.exports=i)},,,,,,,,,function(e,t,n){"use strict";var i;void 0===(i=function(e,t){return{basemap:{title:"Dữ liệu nền",id:"dulieunen",url:"https://ditagis.com:6443/arcgis/rest/services/BinhDuong/DuLieuNen/MapServer",visible:!0,copyright:"Bản đồ biên tập bởi Trung tâm DITAGIS",sublayers:[{id:5,title:"Hành chính huyện"},{id:4,title:"Hành chính xã"},{id:3,title:"Sông hồ"},{id:2,title:"Phủ bề mặt",visible:!1},{id:1,title:"Mặt giao thông"},{id:0,title:"Tim đường"}]},layers:[{title:"Trồng trọt",id:"TrongTrot",url:"https://ditagis.com:6443/arcgis/rest/services/BinhDuong/BaoVeThucVat_ChuyenDe/FeatureServer/2",outFields:["*"]},{title:"Sâu bệnh",id:"SauBenh",url:"https://ditagis.com:6443/arcgis/rest/services/BinhDuong/BaoVeThucVat_ChuyenDe/FeatureServer/1",outFields:["*"]},{title:"Doanh nghiệp",id:"DoanhNghiep",url:"https://ditagis.com:6443/arcgis/rest/services/BinhDuong/BaoVeThucVat_ChuyenDe/FeatureServer/0",outFields:["*"]}],tables:[{id:"thoigiansxtt",url:"https://ditagis.com:6443/arcgis/rest/services/BinhDuong/BaoVeThucVat_ChuyenDe/FeatureServer/3"},{id:"tblgiaidoansinhtruong",url:"https://ditagis.com:6443/arcgis/rest/services/BinhDuong/BaoVeThucVat_ChuyenDe/FeatureServer/4"}],zoom:10,center:[106.6843694,11.158752270428375]}}.apply(t,[n,t]))||(e.exports=i)},,,,,,,,,,,,,,,function(e,t,n){"use strict";var i;void 0===(i=function(e,t){return function(){function e(e){this.eventListeners={},e.on=this.on,e.fire=this.fire,e.eventListeners=this.eventListeners}return e.prototype.on=function(e,t){this.eventListeners[e]?this.eventListeners[e].push(t):this.eventListeners[e]=[t]},e.prototype.fire=function(e,t){var n=this.eventListeners[e];if(n)for(var i=0,a=n;i<a.length;i++){(0,a[i])(t)}},e}()}.apply(t,[n,t]))||(e.exports=i)},function(e,t,n){"use strict";var i,a;i=[n,t,n(8),n(6),n(3),n(4),n(10),n(28)],void 0===(a=function(e,t,n,i,a,r,o,s){return function(){function e(e,t){t=t||{},this.view=e,this.graphics=new s({listMode:"hide"}),this.view.map.add(this.graphics),this.symbolMarker=t.symbolMarker||new i({color:new o([255,0,0]),size:3,outline:new a({width:7,color:new o([255,64,0,.4])})}),this.symbolLine=t.symbolLine||new a({color:new o([255,0,0]),width:4}),this.symbolPlg=t.symbolPlg||new r({style:"none",outline:new a({color:new o([255,64,0,.4]),width:1})})}return e.prototype.hightlight=function(e){var t=this;this.clear(),this.view.hitTest(e).then(function(e){for(var n=0,i=e.results;n<i.length;n++){var a=i[n].graphic;a.attributes&&null!=a.attributes&&t.add(a)}})},e.prototype.clear=function(){this.removeAll()},e.prototype.rendererGraphic=function(e,t){var i;return i="point"===e?this.symbolMarker:"polyline"===e?this.symbolLine:this.symbolPlg,new n({geometry:t,symbol:i})},e.prototype.add=function(e){var t=e.geometry.type,n=this.rendererGraphic(t,e.geometry);this.graphics.add(n)},e.prototype.addAll=function(e){for(var t=0,n=e;t<n.length;t++){var i=n[t];this.add(i)}},e.prototype.removeAll=function(){this.graphics.removeAll()},e}()}.apply(t,i))||(e.exports=a)},,,function(e,t,n){"use strict";var i,a;i=[n,t,n(26)],void 0===(a=function(e,t,n){return function(){return function(){this.eventListener=new n(this)}}()}.apply(t,i))||(e.exports=a)},,,function(e,t,n){"use strict";var i,a;i=[n,t,n(9),n(5)],void 0===(a=function(e,t,n,i){return function(){function e(e){void 0===e&&(e={});var t=this;this.url=e.url,this.fieldID=e.fieldID||"OBJECTID",this.queryTask=new n(this.url),$.get(this.url+"?f=json").done(function(e){for(var n in e=JSON.parse(e))t[n]=e[n]})}return e.prototype.findById=function(e){return this.queryTask.execute({outFields:["*"],where:this.fieldID+" = '"+e+"'"})},e.prototype.getFieldDomain=function(e){return this.fields.find(function(t){return t.name===e}).domain},e.prototype.serialize=function(e){var t="";for(var n in e.f=e.f||"json",e)if(e.hasOwnProperty(n)){var i,a=e[n],r=Object.prototype.toString.call(a);t.length&&(t+="&"),i="[object Array]"===r?"[object Object]"===Object.prototype.toString.call(a[0])?JSON.stringify(a):a.join(","):"[object Object]"===r?JSON.stringify(a):"[object Date]"===r?a.valueOf():a,t+=encodeURIComponent(n)+"="+encodeURIComponent(i)}return t},e.prototype.createRequest=function(e,t){var n=new XMLHttpRequest;return n.onerror=function(n){e.call(t,{error:{code:500,message:"XMLHttpRequest error"}},null)},n.onreadystatechange=function(){var i,a;if(4===n.readyState){try{i=JSON.parse(n.responseText)}catch(e){i=null,a={code:500,message:"Could not parse response as JSON. This could also be caused by a CORS or XMLHttpRequest error."}}!a&&i.error&&(a=i.error,i=null),e.call(t,a,i)}},n},e.prototype.xmlHttpPost=function(e,t,n,i){var a=this.createRequest(n,i);return a.open("POST",e),void 0!==i&&null!==i&&void 0!==i.options&&(a.timeout=i.options.timeout),a.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),a.send(this.serialize(t)),a},e.prototype.applyEdits=function(e){void 0===e&&(e={addFeatures:[],updateFeatures:[],deleteFeatures:[]});var t=document.createElement("form");if(t.method="post",e.addFeatures.length>0){var n=document.createElement("input");n.name="adds",n.type="text",n.value=JSON.stringify(e.addFeatures),t.appendChild(n)}if(e.deleteFeatures.length>0){var a=document.createElement("input");a.name="deletes",a.type="text",a.value=e.deleteFeatures.join(","),t.appendChild(a)}if(e.updateFeatures.length>0){var r=document.createElement("input");r.name="updates",r.type="text",r.value=JSON.stringify(e.updateFeatures),t.appendChild(r)}var o=document.createElement("input");return o.name="f",o.type="text",o.value="json",t.appendChild(o),i(this.url+"/applyEdits?f=json",{method:"post",body:t})},e.prototype.queryFeatures=function(e){return this.queryTask.execute(e)},e}()}.apply(t,i))||(e.exports=a)},function(e,t,n){"use strict";var i,a,r=function(e,t,n,i){return new(n||(n=Promise))(function(a,r){function o(e){try{l(i.next(e))}catch(e){r(e)}}function s(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){e.done?a(e.value):new n(function(t){t(e.value)}).then(o,s)}l((i=i.apply(e,t||[])).next())})},o=function(e,t){var n,i,a,r,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(a=i[2&r[0]?"return":r[0]?"throw":"next"])&&!(a=a.call(i,r[1])).done)return a;switch(i=0,a&&(r=[0,a.value]),r[0]){case 0:case 1:a=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,i=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===r[0]||2===r[0])){o=0;continue}if(3===r[0]&&(!a||r[1]>a[0]&&r[1]<a[3])){o.label=r[1];break}if(6===r[0]&&o.label<a[1]){o.label=a[1],a=r;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(r);break}a[2]&&o.ops.pop(),o.trys.pop();continue}r=t.call(e,o)}catch(e){r=[6,e],i=0}finally{n=a=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}};i=[n,t,n(9),n(2)],void 0===(a=function(e,t,n,i){return function(){function e(){}return e.getQueryLocation=function(e){return this._queryLocation||(this._queryLocation=new n({url:e.map.findLayerById(i.BASEMAP).findSublayerById(i.INDEX_HANHCHINHXA).url})),this._queryLocation},e.getLocationName=function(e,t){var n=this;return void 0===t&&(t={PhuongXa:null,HuyenTP:null}),new Promise(function(i,a){try{var r=n.getQueryLocation(e),o=[];t.PhuongXa&&o.push("MaPhuongXa = '"+t.PhuongXa+"'"),t.HuyenTP&&o.push("MaHuyenTP = '"+t.HuyenTP+"'"),r.execute({outFields:["TenXa","TenHuyen"],where:o.join(" and ")}).then(function(e){if(e&&e.features.length>0){var t=e.features[0];t&&t.attributes&&i(t.attributes)}else i(null)})}catch(e){console.log(e),a(e)}})},e.getCreatedInfo=function(e){return{NguoiCapNhat:e.systemVariable.user.userName,NgayCapNhat:(new Date).getTime()}},e.getUpdatedInfo=function(e){return{NguoiCapNhat:e.systemVariable.user.userName,NgayCapNhat:(new Date).getTime()}},e.getNhomCayTrong=function(e,t){return r(this,void 0,void 0,function(){var n,a,r;return o(this,function(o){switch(o.label){case 0:return n=e.toScreen(t),[4,e.hitTest(n)];case 1:return(a=o.sent()).results.length>0&&(r=a.results.find(function(e){return e.graphic.layer.id===i.TRONGTROT}))&&r.graphic&&r.graphic.attributes?[2,{NhomCayTrong:r.graphic.attributes.NhomCayTrong,LoaiCayTrong:r.graphic.attributes.LoaiCayTrong}]:[2,null]}})})},e.getLocationInfo=function(e,t){var n=this;return new Promise(function(i,a){try{n.getQueryLocation(e).execute({outFields:["MaPhuongXa","MaHuyenTP"],geometry:t}).then(function(e){if(e&&e.features.length>0){var t=e.features[0];t&&t.attributes&&i(t.attributes)}else i(null)})}catch(e){console.log(e),a(e)}})},e}()}.apply(t,i))||(e.exports=a)},,,,,,function(e,t,n){"use strict";var i,a,r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(e,t,n,i){return new(n||(n=Promise))(function(a,r){function o(e){try{l(i.next(e))}catch(e){r(e)}}function s(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){e.done?a(e.value):new n(function(t){t(e.value)}).then(o,s)}l((i=i.apply(e,t||[])).next())})},s=function(e,t){var n,i,a,r,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(a=i[2&r[0]?"return":r[0]?"throw":"next"])&&!(a=a.call(i,r[1])).done)return a;switch(i=0,a&&(r=[0,a.value]),r[0]){case 0:case 1:a=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,i=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===r[0]||2===r[0])){o=0;continue}if(3===r[0]&&(!a||r[1]>a[0]&&r[1]<a[3])){o.label=r[1];break}if(6===r[0]&&o.label<a[1]){o.label=a[1],a=r;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(r);break}a[2]&&o.ops.pop(),o.trys.pop();continue}r=t.call(e,o)}catch(e){r=[6,e],i=0}finally{n=a=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}};i=[n,t,n(2),n(11),n(0),n(1),n(56),n(27),n(34),n(50),n(6),n(4),n(3),n(33),n(10)],void 0===(a=function(e,t,n,i,a,l,u,c,d,h,p,g,m,f,y){return function(){function e(e){this.view=e,this.options={hightLength:100};var t=i.tables.find(function(e){return e.id===n.THOI_GIAN_SAN_XUAT_TRONG_TROT}).url;this.thoiGianSanXuatTrongTrot=new f({url:t,fieldID:"MaDoiTuong"}),this.popupEdit=new u(e,{hightLength:this.options.hightLength,table:this.thoiGianSanXuatTrongTrot}),this.tblGiaiDoanSinhTruong=new f({url:i.tables.find(function(e){return e.id===n.TBL_GIAI_DOAN_SINH_TRUONG}).url,fieldID:"OBJECTID"}),this.hightlightGraphic=new c(e,{symbolMarker:new p({outline:new m({color:new y("#7EABCD"),width:2})}),symbolFill:new g({outline:new m({color:new y("#7EABCD"),width:2})})})}return e.prototype.startup=function(){var e=this;this.view.map.layers.map(function(t){t.then(function(){if("feature"==t.type){var i=[];t.permission.edit&&(i.push({id:"update",title:"Cập nhật",className:"esri-icon-edit",layer:t}),i.push({id:"update-geometry",title:"Cập nhật vị trí",className:"esri-icon-locate",layer:t})),t.permission.delete&&i.push({id:"delete",title:"Xóa",className:"esri-icon-erase",layer:t}),t.id===n.TRONGTROT&&("/cattachthua"!==location.pathname&&i.push({id:"view-detail",title:"Chi tiết thời gian trồng trọt",className:"esri-icon-table",layer:t}),"/congtacvien"!==location.pathname&&(i.push({id:"split",title:"Chia thửa",className:"esri-icon-zoom-out-fixed",layer:t}),i.push({id:"merge",title:"Ghép thửa",className:"esri-icon-zoom-in-fixed",layer:t}))),t.popupTemplate={content:function(n){var i=e.contentPopup(n,t);return i},title:t.title,actions:i}}})}),this.view.popup.watch("visible",function(t){t||e.hightlightGraphic.clear()}),this.view.popup.on("trigger-action",function(t){e.triggerActionHandler(t)}),this.view.popup.dockOptions={buttonEnabled:!0,breakpoint:{width:600,height:1e3},position:"bottom-center"}},Object.defineProperty(e.prototype,"selectFeature",{get:function(){return this.view.popup.viewModel.selectedFeature},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layer",{get:function(){return this.selectFeature.layer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"attributes",{get:function(){return this.selectFeature.attributes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"objectId",{get:function(){return this.attributes.OBJECTID},enumerable:!0,configurable:!0}),e.prototype.triggerActionHandler=function(e){var t=e.action.id,n=this.layer||e.action.layer;this.popupEdit.layer=n;var i=!1;switch(t){case"update":n.permission&&n.permission.edit?"esri-icon-check-mark"===e.action.className?this.popupEdit.editFeature():this.popupEdit.showEdit():i=!0;break;case"delete":n.permission&&n.permission.delete?this.popupEdit.deleteFeature():i=!0;break;case"view-detail":this.attributes.MaDoiTuong?this.triggerActionViewDetailTrongtrot(this.attributes.MaDoiTuong):$.notify({message:"Không xác được định danh"},{type:"danger"});break;case"view-detail-edit":this.attributes.MaDoiTuong?this.popupEdit.showTableDetailTrongTrot():$.notify({message:"Không xác được định danh"},{type:"danger"});break;case"update-geometry":if("polygon"===n.geometryType){alert("Không thể thay đổi vị trí vùng...");break}this.popupEdit.updateGeometryGPS();break;case"split":this.popupEdit.splitPolygon();break;case"merge":this.popupEdit.mergePolygon()}i&&$.notify({message:"Không có quyền thực hiện tác vụ"},{type:"danger"})},e.prototype.getSubtype=function(e,t){if(e=e||this.layer.typeIdField,t=t||this.attributes[e],this.tblGiaiDoanSinhTruong.typeIdField===e){this.tblGiaiDoanSinhTruong.typeIdField;return this.tblGiaiDoanSinhTruong.types.find(function(e){return e.id==t})}return null},e.prototype.renderDomain=function(e,t){var n;if("inherited"===e.type){var i=this.layer.getFieldDomain(t);i&&(n=i.codedValues)}else n=e.codedValues;return n},e.prototype.contentPopup=function(e,t){return o(this,void 0,void 0,function(){var n,i,r,u,c,p,g,m,f,y,v,T=this;return s(this,function(b){switch(b.label){case 0:b.trys.push([0,5,,6]),n=e.graphic,i=n.layer||t,r=n.attributes,n.layer||(n.layer=i),this.hightlightGraphic.clear(),this.hightlightGraphic.add(n),u=l.create("div",{class:"popup-content",id:"popup-content"}),c=l.create("table",{},u),p=this.getSubtype(),g=function(e){var t,n,i,a,u,h,g,f,y;return s(this,function(v){switch(v.label){case 0:return t=r[e.name],"oid"===e.type?[2,"continue"]:(n=l.create("tr"),i=l.create("td",{innerHTML:e.alias}),void 0,a=void 0,u=void 0,h=void 0,p&&p.domains[e.name]?h=m.renderDomain(p.domains[e.name],e.name):e.domain&&(h=m.renderDomain(e.domain,e.name)),h?((g=h.find(function(e){return e.code===t}))&&(t=g.name),[3,4]):[3,1]);case 1:return"MaPhuongXa"!==e.name&&"MaHuyenTP"!==e.name||!r[e.name]?[3,3]:[4,d.getLocationName(m.view,{PhuongXa:r.MaPhuongXa,HuyenTP:r.MaHuyenTP}).then(function(e){return o(T,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return[4,e];case 1:return[2,t.sent()]}})})})];case 2:return f=v.sent(),t="MaPhuongXa"==e.name?f.TenPhuong:f.TenHuyen,[3,4];case 3:"small-integer"===e.type||"integer"===e.type||"double"===e.type||"date"===e.type&&(u="DateFormat"),v.label=4;case 4:return a=u?"{"+e.name+":"+u+"}":t,y=l.create("td"),null,e.length>=m.options.hightLength?l.create("textarea",{rows:5,cols:25,readonly:!0,innerHTML:a,style:"background: transparent;border:none"},y):y.innerHTML=a,l.place(i,n),l.place(y,n),l.place(n,c),[2]}})},m=this,f=0,y=i.fields,b.label=1;case 1:return f<y.length?(v=y[f],[5,g(v)]):[3,4];case 2:b.sent(),b.label=3;case 3:return f++,[3,1];case 4:return i.hasAttachments&&i.getAttachments(r.OBJECTID).then(function(e){if(e&&e.attachmentInfos&&e.attachmentInfos.length>0){var t=l.create("div",{class:"attachment-container"},document.getElementById("popup-content"));l.create("legend",{innerHTML:"Hình ảnh"},t);for(var n=i.url+"/"+i.layerId+"/"+r.OBJECTID,o=function(e){var i=l.create("div",{class:"col-lg-3 col-md-4 col-xs-6 thumb"},t),r=l.create("a",{class:"thumbnail",href:"javascript:void(0)"},i),o=l.create("img",{class:"img-responsive",id:n+"/attachments/"+e.id,src:n+"/attachments/"+e.id,alt:n+"/attachments/"+e.name},r);a(r,"click",function(){var t=h.modal("attachments-"+e.id,e.name,o.cloneNode(!0));t&&t.modal()})},s=0,u=e.attachmentInfos;s<u.length;s++){o(u[s])}}}),[2,u.outerHTML];case 5:throw b.sent();case 6:return[2]}})})},e.prototype.triggerActionViewDetailTrongtrot=function(e){var t=this,n=$.notify({title:"Thời gian trồng trọt thửa đất: "+e,message:"Đang truy vấn..."},{delay:2e4,showProgressbar:!0});this.thoiGianSanXuatTrongTrot.findById(e).then(function(e){if(e.features.length>0){n.update("message","Tìm thấy "+e.features.length+" dữ liệu"),n.update("progress",100),n.update("type","success");var i=document.createElement("table");i.classList.add("table","table-hover");var a=document.createElement("thead");a.innerHTML="<tr>\n              <th>Nhóm cây trồng</th>\n              <th>Loại cây trồng</th>\n              <th>Diện tích</th>\n              <th>Thời gian bắt đầu trồng</th>\n              <th>Thời gian trồng trọt</th>\n              <th>Giai đoạn sinh trưởng</th>\n            </tr>\n            </thead>",l.place(a,i),i.appendChild(a);var o=document.createElement("tbody");i.appendChild(o);for(var s=function(e){var n=e.attributes,i=document.createElement("tr");i.classList.add("Info"),o.appendChild(i);var a=document.createElement("td"),r=t.layer.getFieldDomain("NhomCayTrong").codedValues;r&&((c=r.find(function(e){return e.code==n.NhomCayTrong}))&&(a.innerText=c.name));a.innerText||(a.innerText=n.NhomCayTrong+""||"");var s=document.createElement("td"),l=t.getSubtype("NhomCayTrong",n.NhomCayTrong);if(!l)return{value:void 0};var u=l.domains.LoaiCayTrong;if(u){var c,d=void 0;if("inherited"===u.type){var h=t.layer.getFieldDomain("LoaiCayTrong");h&&(d=h.codedValues)}else d=u.codedValues;if(d)(c=d.find(function(e){return e.code==n.LoaiCayTrong}))&&(s.innerText=c.name)}s.innerText||(s.innerText=n.LoaiCayTrong||"");var p=document.createElement("td");p.innerText=n.DienTich+""||"0";var g=document.createElement("td");if(n.ThoiGianBatDauTrong){var m=new Date(n.ThoiGianBatDauTrong);g.innerText=m.getDate()+"/"+(m.getMonth()+1)+"/"+m.getFullYear()}var f=document.createElement("td");if(n.ThoiGianTrongTrot){var y=new Date(n.ThoiGianTrongTrot);f.innerText=y.getDate()+"/"+(y.getMonth()+1)+"/"+y.getFullYear()}var v=document.createElement("td");v.innerText=n.GiaiDoanSinhTruong,i.appendChild(a),i.appendChild(s),i.appendChild(p),i.appendChild(g),i.appendChild(f),i.appendChild(v)},u=0,c=e.features.sort(function(e,t){var n=e.attributes,i=t.attributes;return n.Nam==i.Nam?n.Thang>i.Thang:n.Nam>i.Nam});u<c.length;u++){var d=s(c[u]);if("object"===(void 0===d?"undefined":r(d)))return d.value}h.modal("ttModal","Thời gian trồng trọt",i).modal()}else n.update("type","danger"),n.update("message","Không tìm thấy dữ liệu"),n.update("progress",100)})},e}()}.apply(t,i))||(e.exports=a)},function(e,t,n){"use strict";var i,a,r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();i=[n(0),n(1),n(32),n(31),n(7)],void 0===(a=function(e,t,n,i,a){return function(){function n(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};for(var i in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.view=e,this.options={position:"top-left",icon:"esri-icon-user",title:"Người dùng"},t)this.options[i]=t[i];this.isStartup=!1}return r(n,[{key:"startup",value:function(){this.user&&(this.isStartup||(this.initView(),this.view.ui.add(this.expand,this.options.position),this.isStartup=!0))}},{key:"destroy",value:function(){this.isStartup&&(this.view.ui.remove(this.expand),delete this.DOM,delete this.expand,this.isStartup=!1)}},{key:"initView",value:function(){var n=this;try{this.DOM={},this.DOM.container=t.create("div",{class:"esri-widget ditagis-widget-user"}),this.DOM.ul=t.create("ul",{},this.DOM.container),t.create("li",{class:"title",innerHTML:this.user.displayName},this.DOM.ul),this.DOM.infoLi=t.create("li",{class:"item"},this.DOM.ul),this.DOM.infoDiv=t.create("div",{class:"container info"},this.DOM.infoLi),this.DOM.setting=t.create("button",{class:"dtg-btn-widget setting",innerHTML:"Cập nhật tài khoản"},this.DOM.infoDiv),e(this.DOM.setting,"click",function(){return n.settingUserClickHandler()}),this.DOM.btnLogout=t.create("button",{class:"dtg-btn-widget btn-logout",innerHTML:"Đăng xuất"},this.DOM.infoDiv),e(this.DOM.btnLogout,"click",function(){return n.logoutClickHandler()}),this.expand=new a({expandIconClass:this.options.icon,expandTooltip:this.options.title,view:this.view,content:this.DOM.container})}catch(e){console.log(e)}}},{key:"logoutClickHandler",value:function(){location.href="/account/logout"}},{key:"successLogout",value:function(){}},{key:"failLogout",value:function(){}},{key:"settingUserClickHandler",value:function(){}},{key:"user",get:function(){return this.view.systemVariable.user}}]),n}()}.apply(t,i))||(e.exports=a)},,,function(e,t,n){"use strict";var i,a,r,o=(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});i=[n,t,n(43),n(30),n(5)],void 0===(a=function(e,t,n,i,a){return function(e){function t(t){var n=e.call(this,t)||this;return n.systemVariable=new i,n}return o(t,e),t.prototype.session=function(){var e=this;return new Promise(function(t,n){a("/map",{method:"post"}).then(function(n){e.systemVariable.user=n.data,t(n.data)})})},t}(n)}.apply(t,i))||(e.exports=a)},,function(e,t,n){"use strict";var i,a;i=[n,t,n(1),n(42)],void 0===(a=function(e,t,n,i){return function(){function e(){this.container=n.toDom('<div class="dtg-tooltip-map"></div>'),i.set(this.container,{position:"fixed"})}return e.instance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.show=function(e,t){i.set(this.container,{left:e[0]+30+"px",top:e[1]+"px"}),this.container.innerHTML=t,document.body.contains(this.container)||document.body.appendChild(this.container)},e.prototype.hide=function(){document.body.contains(this.container)&&document.body.removeChild(this.container)},e}()}.apply(t,i))||(e.exports=a)},,,,function(e,t,n){"use strict";var i,a;i=[n,t,n(29)],void 0===(a=function(e,t,n){return function(){function e(){}return e.modal=function(e,t,i,a){try{var r=n.getBox().w+"px",o=void 0,s=void 0,l=void 0,u=void 0,c=void 0,d=void 0;(o=document.createElement("div")).classList.add("modal","fade"),o.id=e,o.setAttribute("tabindex","-1"),o.setAttribute("role","dialog"),o.setAttribute("aria-labelledby","myModalLabel"),o.setAttribute("aria-hidden","true"),(s=document.createElement("div")).classList.add("modal-dialog"),(l=document.createElement("div")).classList.add("modal-content"),l.style.maxWidth=r,l.style.width="fit-content",(u=document.createElement("div")).classList.add("modal-header");var h=document.createElement("button");h.type="button",h.classList.add("close"),h.setAttribute("data-dismiss","modal"),h.innerHTML='<span aria-hidden="true">×</span><span class="sr-only">Đóng</span>',u.appendChild(h),u.innerHTML+='<h4 class="modal-title">'+t+"</h4>",(c=document.createElement("div")).classList.add("modal-body"),c.appendChild(i),a&&((d=document.createElement("div")).classList.add("modal-footer"),d.appendChild(a)),l.appendChild(u),l.appendChild(c),d&&l.appendChild(d),s.appendChild(l),o.appendChild(s),document.body.appendChild(o);var p=$("#"+e);return p?(p.on("hidden.bs.modal",function(){p.remove()}),p):null}catch(e){throw e}},e}()}.apply(t,i))||(e.exports=a)},function(e,t,n){"use strict";var i,a;i=[n,t,n(12),n(2),n(28),n(8),n(4),n(3),n(36),n(10)],void 0===(a=function(e,t,n,i,a,r,o,s,l,u){var c=new o({outline:new s({color:new u("red")})});return function(){function e(e){this.mergeGraphics=new l,this.unionGraphic=null,this.mainGraphic=null,this.view=e.view,this.layer=e.layer,this.initWnd(),this.graphicLayers=new a({listMode:"hide"})}return Object.defineProperty(e.prototype,"isRun",{get:function(){return this._isRun},set:function(e){e?this.view.ui.add(this.widgetContainer,"top-right"):this.clear(),this._isRun=e},enumerable:!0,configurable:!0}),e.prototype.initWnd=function(){var e=document.createElement("div");e.id="dtg-wget-split-polygon",e.classList.add("esri-widget","esri-widget-button","esri-icon-close-circled"),e.title="Hủy",e.addEventListener("click",this.clear.bind(this)),this.widgetContainer=e},e.prototype.run=function(e){var t=this;this.mainGraphic=e,this.isRun=!0,this.graphicLayers.removeAll(),this.mergeGraphics.add(e),this.graphicLayers.add(new r({geometry:e.geometry,symbol:c})),this.view.map.add(this.graphicLayers),this.clickHandler=this.view.on("click",function(n){n.stopPropagation(),t.view.hitTest({x:n.x,y:n.y}).then(function(n){if(n.results.length>0){var a=n.results.find(function(e){return e.graphic.layer.id===i.TRONGTROT});if(a){if(a.graphic===e)return;t.mergeGraphics.some(function(e){return e===a.graphic})?t.remove(a.graphic):t.add(a.graphic)}}})}),this.dblClickHandler=this.view.on("double-click",this.dblClickHandlerEvent.bind(this))},e.prototype.add=function(e){this.graphicLayers.removeAll(),this.mergeGraphics.add(e);var t=n.union(this.mergeGraphics.map(function(e){return e.geometry}).toArray());return this.graphicLayers.add(new r({geometry:t,symbol:c})),this.unionGraphic=t,t},e.prototype.remove=function(e){this.graphicLayers.removeAll(),this.mergeGraphics.remove(e);var t=n.union(this.mergeGraphics.map(function(e){return e.geometry}).toArray());return this.graphicLayers.add(new r({geometry:t,symbol:c})),this.unionGraphic=t,t},e.prototype.dblClickHandlerEvent=function(e){if(e.stopPropagation(),confirm("Có chắc chắn ghép thửa?")){var t=this.mergeGraphics.slice(1,this.mergeGraphics.length).map(function(e){return{objectId:e.attributes.OBJECTID}}).toArray(),n=this.mainGraphic.clone();n.geometry=this.unionGraphic,this.layer.applyEdits({updateFeatures:[n],deleteFeatures:t})}this.clear()},e.prototype.clear=function(){this.view.ui.remove(this.widgetContainer),this.mainGraphic=null,this.clickHandler&&(this.clickHandler.remove(),delete this.clickHandler),this.graphicLayers.removeAll(),this.view.map.remove(this.graphicLayers),this.mergeGraphics.removeAll(),this.dblClickHandler&&(this.dblClickHandler.remove(),delete this.dblClickHandler)},e}()}.apply(t,i))||(e.exports=a)},function(e,t,n){"use strict";var i,a,r=function(e,t,n,i){return new(n||(n=Promise))(function(a,r){function o(e){try{l(i.next(e))}catch(e){r(e)}}function s(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){e.done?a(e.value):new n(function(t){t(e.value)}).then(o,s)}l((i=i.apply(e,t||[])).next())})},o=function(e,t){var n,i,a,r,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(a=i[2&r[0]?"return":r[0]?"throw":"next"])&&!(a=a.call(i,r[1])).done)return a;switch(i=0,a&&(r=[0,a.value]),r[0]){case 0:case 1:a=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,i=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===r[0]||2===r[0])){o=0;continue}if(3===r[0]&&(!a||r[1]>a[0]&&r[1]<a[3])){o.label=r[1];break}if(6===r[0]&&o.label<a[1]){o.label=a[1],a=r;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(r);break}a[2]&&o.ops.pop(),o.trys.pop();continue}r=t.call(e,o)}catch(e){r=[6,e],i=0}finally{n=a=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}};i=[n,t,n(1),n(0),n(46),n(27),n(4),n(3),n(10),n(8),n(38),n(37),n(12)],void 0===(a=function(e,t,n,i,a,s,l,u,c,d,h,p,g){return function(){function e(e,t){void 0===t&&(t={}),this.view=e,this.options={position:"top-right",icon:"esri-widget esri-widget-button esri-icon-basemap",icon_cancel:"esri-widget esri-widget-button esri-icon-close-circled",title:"Chia thửa",tooltip:{move:"Nhấn để vẽ đường chia thửa"}},this.initView()}return e.prototype.startup=function(e,t){var n=this;this.selectedFeature=e,this.layer=t,this.hightlightGraphic.clear(),this.hightlightGraphic.add(e),this.add_dtg_wget_cancel(),this.clickEvent=i(this.view,"click",function(e){n.clickHandler(e)}),this.pointerMoveEvent=i(this.view,"pointer-move",function(e){a.instance().show([e.x,e.y],n.options.tooltip.move),n.pointerMoveHandler(e)}),this.dblClickHandler=i(this.view,"double-click",function(e){e.stopPropagation(),n.finish(e)})},e.prototype.pointerMoveHandler=function(e){e.stopPropagation();var t={x:e.x,y:e.y},n=this.view.toMap(t),i=[n.x,n.y],a=[];if(this.vertices.length>0)for(var r=0,o=this.vertices;r<o.length;r++){var s=o[r];a.push(s)}a.push(i),this.refreshMainGraphic(a)},e.prototype.finish=function(e){var t={x:e.x,y:e.y},n=this.view.toMap(t),i=[n.x,n.y];this.vertices.push(i),this.refreshMainGraphic(this.vertices),this.xuly(),this.clearEvent()},e.prototype.xuly=function(){return r(this,void 0,void 0,function(){var e,t,n,i,a,r,s,l,u,c,m,f,y,v,T,b,D,C;return o(this,function(o){switch(o.label){case 0:if(!confirm("Có chắc chắn tách thửa?"))return[3,2];for(r in e=this.selectedFeature.attributes,t=this.selectedFeature.geometry,n=new h({paths:this.vertices,spatialReference:this.view.spatialReference}),i=g.cut(t,n),a=[],i)for(s=i[r],l=0,u=s.rings;l<u.length;l++)c=u[l],a.push(c);return[4,this.taoMaDoiTuong()];case 1:for(m=o.sent(),f=[],y=[],v=0;v<a.length;v++)T=new p({rings:a[v],spatialReference:this.view.spatialReference}),0==v?(D=new d({geometry:T,attributes:e}),f.push(D)):((b={}).LoaiCayTrong=e.LoaiCayTrong,b.OBJECTID=e.OBJECTID,b.MaHuyenTP=e.MaHuyenTP,b.NhomCayTrong=e.NhomCayTrong,b.MaDoiTuong=e.MaDoiTuong+"_"+(m+v),D=new d({geometry:T,attributes:b}),y.push(D));C={updateFeatures:f,addFeatures:y},this.layer.applyEdits(C),this.vertices=[],o.label=2;case 2:return[2]}})})},e.prototype.taoMaDoiTuong=function(){return r(this,void 0,void 0,function(){var e,t,n,i,a,r,s,l,u,c,d,h;return o(this,function(o){switch(o.label){case 0:return e=this.selectedFeature.attributes.MaDoiTuong,t=e.split("_"),n=t.length,(i=this.layer.createQuery()).outFields=["MaDoiTuong"],i.where="MaDoiTuong like '"+e+"[_]%'",[4,this.layer.queryFeatures(i)];case 1:for(a=o.sent(),r=0,s=0,l=a.features;s<l.length;s++)u=l[s],(c=u.attributes.MaDoiTuong)&&(d=c.split("_"),(h=parseInt(d[n]))>r&&(r=h));return[2,r]}})})},e.prototype.add_dtg_wget_cancel=function(){this.view.ui.add(this.DOM.cancel_wget,this.options.position)},e.prototype.initView=function(){var e=this;try{this.vertices=[],this.hightlightGraphic=new s(this.view,{symbolPlg:new l({style:"none",outline:new u({color:new c("#0000ff"),width:1})})}),this.DOM={},this.DOM.cancel_wget=n.create("div",{id:"dtg-wget-split-polygon",class:this.options.icon_cancel,title:"Hủy"}),i(this.DOM.cancel_wget,"click",function(t){e.clearEvent()})}catch(e){throw e}},e.prototype.clickHandler=function(e){e.stopPropagation();var t={x:e.x,y:e.y},n=this.view.toMap(t),i=[n.x,n.y];this.vertices.push(i),this.refreshMainGraphic(this.vertices)},e.prototype.refreshMainGraphic=function(e){try{if(this.graphic&&(this.view.graphics.remove(this.graphic),this.graphic=null),e){var t=new h({paths:e,spatialReference:this.view.spatialReference});this.graphic=new d({geometry:t,symbol:new u({color:new c([255,0,0]),width:1})}),this.view.graphics.add(this.graphic)}}catch(e){console.log(e)}},e.prototype.clearEvent=function(){this.clickEvent&&(this.clickEvent.remove(),this.clickEvent=null),this.pointerMoveEvent&&(a.instance().hide(),this.pointerMoveEvent.remove(),this.pointerMoveEvent=null),this.dblClickHandler&&(this.dblClickHandler.remove(),this.dblClickHandler=null),this.view.ui.remove(this.DOM.cancel_wget),this.vertices=[],this.hightlightGraphic.clear(),this.graphic&&(this.view.graphics.remove(this.graphic),this.graphic=null)},e}()}.apply(t,i))||(e.exports=a)},function(e,t,n){"use strict";var i;void 0===(i=function(e,t){return function(){function e(e){this.date=e}return e.prototype.checkOutOfDate=function(e){return!((new Date).getTime()-e>0)},e.prototype.checkUnexpired=function(e){return!this.checkOutOfDate(e)},e.formatDateValue=function(e){if(!e)return"";var t=e.getDate(),n=e.getMonth()+1,i=e.getFullYear();return t/10<1&&(t="0"+t),n/10<1&&(n="0"+n),i+"-"+n+"-"+t},e.formatNumberDate=function(e){if(!e)return"";var t=new Date(e),n=t.getDate(),i=t.getMonth()+1,a=t.getFullYear();return n/10<1&&(n="0"+n),i/10<1&&(i="0"+i),n+"/"+i+"/"+a},e}()}.apply(t,[n,t]))||(e.exports=i)},function(e,t,n){"use strict";var i,a;i=[n,t,n(29)],void 0===(a=function(e,t,n){return function(){function e(){}return e.modal=function(e,t,i,a){try{var r=n.getBox().w+"px",o=void 0,s=void 0,l=void 0,u=void 0,c=void 0,d=void 0;(o=document.createElement("div")).classList.add("modal","fade"),o.id=e,o.setAttribute("tabindex","-1"),o.setAttribute("role","dialog"),o.setAttribute("aria-labelledby","myModalLabel"),o.setAttribute("aria-hidden","true"),(s=document.createElement("div")).classList.add("modal-dialog"),(l=document.createElement("div")).classList.add("modal-content"),l.style.maxWidth=r,l.style.width="fit-content",(u=document.createElement("div")).classList.add("modal-header");var h=document.createElement("button");h.type="button",h.classList.add("close"),h.setAttribute("data-dismiss","modal"),h.innerHTML='<span aria-hidden="true">×</span><span class="sr-only">Đóng</span>',u.appendChild(h),u.innerHTML+='<h4 class="modal-title">'+t+"</h4>",(c=document.createElement("div")).classList.add("modal-body"),c.appendChild(i),a&&((d=document.createElement("div")).classList.add("modal-footer"),d.appendChild(a)),l.appendChild(u),l.appendChild(c),d&&l.appendChild(d),s.appendChild(l),o.appendChild(s),document.body.appendChild(o);var p=$("#"+e);return p?(p.on("hidden.bs.modal",function(){p.remove()}),p):null}catch(e){throw e}},e}()}.apply(t,i))||(e.exports=a)},function(e,t,n){"use strict";var i,a;i=[n,t,n(54),n(53),n(8),n(33),n(0),n(12),n(2),n(11)],void 0===(a=function(e,t,n,i,a,r,o,s,l,u){return function(){function e(e){this.view=e.view,this.thoiGianSanXuatTrongTrot=e.table,this.tblGiaiDoanSinhTruong=new r({url:u.tables.find(function(e){return e.id===l.TBL_GIAI_DOAN_SINH_TRUONG}).url,fieldID:"OBJECTID"}),this.dataDetails=[]}return Object.defineProperty(e.prototype,"selectFeature",{get:function(){return this.view.popup.viewModel.selectedFeature},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layer",{get:function(){return this.view.map.findLayerById(l.TRONGTROT)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"attributes",{get:function(){return this.selectFeature.attributes},enumerable:!0,configurable:!0}),e.prototype.getSubtype=function(e,t){if(e=e||this.layer.typeIdField,t=t||this.attributes[e],this.tblGiaiDoanSinhTruong.typeIdField===e){this.tblGiaiDoanSinhTruong.typeIdField;return this.tblGiaiDoanSinhTruong.types.find(function(e){return e.id==t})}return null},e.prototype.renderDomain=function(e,t){var n;if("inherited"===e.type){var i=this.layer.getFieldDomain(t);i&&(n=i.codedValues)}else n=e.codedValues;if(!n)return null;var a=this.attributes[t],r=document.createElement("select");r.classList.add("form-control");var o=document.createElement("option");o.value="-1",o.innerText="Chọn giá trị...",r.appendChild(o);for(var s=0,l=n;s<l.length;s++){var u=l[s],c=u.code,d=u.name,h=document.createElement("option");h.setAttribute("value",c),a===c&&(h.selected=!0),h.innerHTML=d,r.appendChild(h)}return r},e.prototype.addDetailTrongTrot=function(){var e,t,i,a,r,l,u,c,d,h,p,g=this,m=document.createElement("div");e=document.createElement("div"),(i=document.createElement("div")).classList.add("form-group"),(d=document.createElement("select")).id="LoaiCayTrong",d.classList.add("form-control"),(c=document.createElement("label")).innerText="Loại cây trồng",c.setAttribute("for",d.id),i.appendChild(c),i.appendChild(d),(t=document.createElement("div")).classList.add("form-group"),(p=document.createElement("select")).id="NhomCayTrong",p.classList.add("form-control");for(var f=0,y=this.layer.getFieldDomain("NhomCayTrong").codedValues;f<y.length;f++){var v=y[f],T=v.code,b=v.name,D=document.createElement("option");D.setAttribute("value",T+""),D.innerHTML=b,p.appendChild(D)}var C,w,E,L,x,N,G=function(){d.innerHTML="";var e=document.createElement("option");e.value="-1",e.innerText="Chọn giá trị...",d.appendChild(e);var t=g.getSubtype("NhomCayTrong",p.value);if(t){var n=t.domains.LoaiCayTrong;if(n){var i;if("inherited"===n.type){var a=g.layer.getFieldDomain("LoaiCayTrong");a&&(i=a.codedValues)}else i=n.codedValues;if(i)for(var r=0,o=i;r<o.length;r++){var s=o[r],l=s.code,u=s.name,c=document.createElement("option");c.setAttribute("value",l),c.innerHTML=u,d.appendChild(c)}}}};if(o(p,"change",function(){G()}),G(),(h=document.createElement("label")).innerText="Nhóm cây trồng",h.setAttribute("for",p.id),t.appendChild(h),t.appendChild(p),(a=document.createElement("div")).classList.add("form-group"),(w=document.createElement("input")).id="DienTich",w.classList.add("form-control"),this.selectFeature.geometry){var O=s.geodesicArea(this.selectFeature.geometry,"square-meters").toFixed(1);w.value=O+""}(C=document.createElement("label")).innerText="Diện tích (m2)",C.setAttribute("for",w.id),a.appendChild(C),a.appendChild(w),(l=document.createElement("div")).classList.add("form-group"),(E=document.createElement("input")).type="date",E.id="ThoiGianTrongTrot",E.classList.add("form-control"),(L=document.createElement("label")).innerText="Thời gian trồng trọt",L.setAttribute("for",E.id),l.appendChild(L),l.appendChild(E),(r=document.createElement("div")).classList.add("form-group"),(x=document.createElement("input")).type="date",x.id="ThoiGianBatDauTrong",x.classList.add("form-control"),(N=document.createElement("label")).innerText="Thời gian bắt đầu trồng",N.setAttribute("for",x.id),r.appendChild(N),r.appendChild(x),(u=document.createElement("button")).classList.add("btn","btn-primary"),u.innerText="Thêm",o(u,"click",function(){for(var e={OBJECTID:g.tmpDatasDetailTrongTrong.adds.length+1,MaDoiTuong:g.attributes.MaDoiTuong,NhomCayTrong:parseInt(p.value),LoaiCayTrong:-1==d.value?null:d.value,DienTich:w.value?parseFloat(w.value):0,ThoiGianBatDauTrong:x.value?new Date(x.value):null,ThoiGianTrongTrot:E.value?new Date(E.value):x.value?new Date(x.value):null,GiaiDoanSinhTruong:"Trồng mới"},t=(g.tmpDatasDetailTrongTrong.tableDatas,0),n=g.tmpDatasDetailTrongTrong.adds;t<n.length;t++){var i=n[t];if(e.LoaiCayTrong==i.LoaiCayTrong&&e.NhomCayTrong==i.NhomCayTrong&&e.ThoiGianBatDauTrong.getTime()===i.ThoiGianBatDauTrong.getTime())return void alert("Dữ liệu vừa mới thêm - Không được thêm nữa")}g.tmpDatasDetailTrongTrong.tableDatas.push(e),g.tmpDatasDetailTrongTrong.adds.push(e),g.addDataToDetailTrongtrot(e),$("#ModalDetail").modal("toggle")}),e.appendChild(t),e.appendChild(i),e.appendChild(a),e.appendChild(r),e.appendChild(l),m.appendChild(e);var I=document.createElement("div");I.appendChild(u),n.modal("ModalDetail","Thêm dữ liệu",m,I).modal()},e.prototype.editDetailTrongTrot=function(e){var t,a,r,s,l,u,c,d,h,p,g,m,f=this,y=document.createElement("div");t=document.createElement("div"),(r=document.createElement("div")).classList.add("form-group"),(p=document.createElement("select")).classList.add("form-control"),(h=document.createElement("label")).innerText="Loại cây trồng",r.appendChild(h),r.appendChild(p),(a=document.createElement("div")).classList.add("form-group"),(m=document.createElement("select")).classList.add("form-control");for(var v=0,T=this.layer.getFieldDomain("NhomCayTrong").codedValues;v<T.length;v++){var b=T[v],D=b.code,C=b.name,w=document.createElement("option");w.setAttribute("value",D+""),w.innerHTML=C,m.appendChild(w)}m.value=e.NhomCayTrong+"";var E,L,x,N,G,O,I,M,F=function(){p.innerHTML="";var e=document.createElement("option");e.value="-1",e.innerText="Chọn giá trị...",p.appendChild(e);var t=f.getSubtype("NhomCayTrong",m.value);if(t){var n=t.domains.LoaiCayTrong;if(n){var i;if("inherited"===n.type){var a=f.layer.getFieldDomain("LoaiCayTrong");a&&(i=a.codedValues)}else i=n.codedValues;if(i)for(var r=0,o=i;r<o.length;r++){var s=o[r],l=s.code,u=s.name,c=document.createElement("option");c.setAttribute("value",l),c.innerHTML=u,p.appendChild(c)}}}};o(m,"change",function(){F(),B()}),F(),p.value=e.LoaiCayTrong,o(p,"change",function(e){B()}),(g=document.createElement("label")).innerText="Nhóm cây trồng",a.appendChild(g),a.appendChild(m),(s=document.createElement("div")).classList.add("form-group"),(L=document.createElement("input")).type="number",L.value=e.DienTich+"",L.classList.add("form-control"),(E=document.createElement("label")).innerText="Diện tích (m2)",s.appendChild(E),s.appendChild(L),(l=document.createElement("div")).classList.add("form-group"),(x=document.createElement("input")).type="date",x.value=i.formatDateValue(e.ThoiGianTrongTrot),x.classList.add("form-control"),(N=document.createElement("label")).innerText="Thời gian trồng trọt",l.appendChild(N),l.appendChild(x),(u=document.createElement("div")).classList.add("form-group"),(G=document.createElement("input")).type="date",G.value=i.formatDateValue(e.ThoiGianBatDauTrong),G.classList.add("form-control"),(O=document.createElement("label")).innerText="Thời gian bắt đầu trồng",u.appendChild(O),u.appendChild(G),(c=document.createElement("div")).classList.add("form-group"),(I=document.createElement("label")).innerText="Giai đoạn sinh trưởng",(M=document.createElement("select")).classList.add("form-control");var S=document.createElement("option");S.value="Chưa xác định",S.innerText="Chọn giá trị...",S.selected=!0,M.appendChild(S);var B=function(){M.innerHTML="",M.appendChild(S),f.tblGiaiDoanSinhTruong.queryFeatures({where:"NhomCayTrong = "+m.value+" and LoaiCayTrong = '"+p.value+"'",outFields:["GiaiDoanSinhTruong"],orderByFields:["MocTG"]}).then(function(t){t.features.forEach(function(e){var t=e.attributes.GiaiDoanSinhTruong,n=document.createElement("option");n.value=n.innerText=t,M.appendChild(n)}),M.value=e.GiaiDoanSinhTruong})};c.appendChild(I),c.appendChild(M),(d=document.createElement("button")).classList.add("btn","btn-primary"),d.innerText="Chấp nhận",o(d,"click",function(){var t={OBJECTID:e.OBJECTID,NhomCayTrong:parseInt(m.value),LoaiCayTrong:"-1"==p.value?null:p.value,DienTich:L.value?parseFloat(L.value):0,ThoiGianTrongTrot:x.value?new Date(x.value):null,ThoiGianBatDauTrong:G.value?new Date(G.value):null,GiaiDoanSinhTruong:M.value};f.renderEditDetailTrongTrot(t),$("#ModalDetail").modal("toggle")}),t.appendChild(a),t.appendChild(r),t.appendChild(s),t.appendChild(u),t.appendChild(l),t.appendChild(c),y.appendChild(t);var H=document.createElement("div");H.appendChild(d),n.modal("ModalDetail","Sửa dữ liệu",y,H).modal()},e.prototype.showTableDetailTrongTrot=function(){var e=this,t=$.notify({message:"Đang tai dữ liệu..."},{showProgressbar:!0,delay:2e4,placement:{from:"top",align:"left"}});this.tmpDatasDetailTrongTrong={adds:[],edits:[],deletes:[],tableDatas:[],tbody:null},this.dataDetails=[];var i=document.createElement("div"),a=document.createElement("div");a.classList.add("table-responsive");var r=document.createElement("table");r.classList.add("table"),a.appendChild(r);var s=document.createElement("thead");s.innerHTML="<tr>\n          <th>Nhóm cây trồng</th>\n          <th>Loại cây trồng</th>\n          <th>Diện tích (m2)</th>\n          <th>Thời gian trồng trọt</th>\n          <th>Thời gian bắt đầu trồng</th>\n          <th>Giai đoạn sinh trưởng</th>\n          <th>Tác vụ</th>\n        </tr>",r.appendChild(s);var l=document.createElement("tbody");r.appendChild(l),this.tmpDatasDetailTrongTrong.tbody=l;var u=document.createElement("div"),c=document.createElement("button");c.classList.add("btn","btn-default"),c.innerText="Thêm dữ liệu",o(c,"click",function(){e.addDetailTrongTrot()});var d=document.createElement("button");d.classList.add("btn","btn-primary"),d.innerText="Chấp nhận",o(d,"click",function(){e.submitDetailTrongtrot(e.tmpDatasDetailTrongTrong)});var h=document.createElement("button");h.type="button",h.classList.add("btn","btn-default"),h.setAttribute("data-dismiss","modal"),h.innerText="Đóng",u.appendChild(d),u.appendChild(c),u.appendChild(h),i.appendChild(a),this.thoiGianSanXuatTrongTrot.findById(this.attributes.MaDoiTuong).then(function(a){a.features.length>0&&a.features.forEach(function(t){var n=t.attributes,i={DienTich:n.DienTich,GiaiDoanSinhTruong:n.GiaiDoanSinhTruong,MaDoiTuong:n.MaDoiTuong,LoaiCayTrong:n.LoaiCayTrong,NhomCayTrong:n.NhomCayTrong,OBJECTID:n.OBJECTID};n.ThoiGianBatDauTrong&&(i.ThoiGianBatDauTrong=new Date(n.ThoiGianBatDauTrong)),n.ThoiGianTrongTrot&&(i.ThoiGianTrongTrot=new Date(n.ThoiGianTrongTrot)),e.tmpDatasDetailTrongTrong.tableDatas.push(i),e.dataDetails.push(t.attributes);var a=e.renderDetailTrongtrot(i);l.appendChild(a)});n.modal("ttModal","Thời gian trồng trọt",i,u).modal(),t.update("type","success"),t.update("progress",90)})},e.prototype.renderEditDetailTrongTrot=function(e){var t=this;try{this.tmpDatasDetailTrongTrong.edits.map(function(n){n.OBJECTID==e.OBJECTID&&t.tmpDatasDetailTrongTrong.edits.splice(t.tmpDatasDetailTrongTrong.edits.indexOf(n))});var n=[];this.tmpDatasDetailTrongTrong.tableDatas.map(function(t){t.OBJECTID==e.OBJECTID?n.push(e):n.push(t)}),this.tmpDatasDetailTrongTrong.tableDatas=n,this.tmpDatasDetailTrongTrong.edits.push(e);for(var a=this.tmpDatasDetailTrongTrong.tbody.getElementsByTagName("tr"),r=void 0,o=0,s=a;o<s.length;o++){var l=s[o],u=parseInt(l.id);if(u==e.OBJECTID||u==e.ID){r=l;break}}var c=r.getElementsByTagName("td"),d=c[0],h=c[1],p=c[2],g=c[3],m=c[4],f=c[5],y=this.layer.getFieldDomain("NhomCayTrong").codedValues;if(y)(b=y.find(function(t){return t.code==e.NhomCayTrong}))&&(d.innerText=b.name);d.innerText||(d.innerText=e.NhomCayTrong+""||"");var v=this.getSubtype("NhomCayTrong",e.NhomCayTrong);if(!v)return;var T=v.domains.LoaiCayTrong;if(T){var b,D=void 0;if("inherited"===T.type){var C=this.layer.getFieldDomain("LoaiCayTrong");C&&(D=C.codedValues)}else D=T.codedValues;if(D)(b=D.find(function(t){return t.code==e.LoaiCayTrong}))&&(h.innerText=b.name)}h.innerText||(h.innerText=e.LoaiCayTrong||""),p.innerText=e.DienTich+""||"0",g.innerText=i.formatDateValue(e.ThoiGianTrongTrot),m.innerText=i.formatDateValue(e.ThoiGianBatDauTrong),f.innerText=e.GiaiDoanSinhTruong}catch(e){throw"Có lỗi xảy ra trong quá trình thực hiện"}},e.prototype.renderDetailTrongtrot=function(e,t){var n=this;void 0===t&&(t=!1);try{var a=document.createElement("tr");a.id=e.OBJECTID||e.ID,t&&a.classList.add("info");var r=document.createElement("td"),s=this.layer.getFieldDomain("NhomCayTrong").codedValues;if(s)(d=s.find(function(t){return t.code==e.NhomCayTrong}))&&(r.innerText=d.name);r.innerText||(r.innerText=e.NhomCayTrong+""||"");var l=document.createElement("td"),u=this.getSubtype("NhomCayTrong",e.NhomCayTrong);if(!u)return;var c=u.domains.LoaiCayTrong;if(c){var d,h=void 0;if("inherited"===c.type){var p=this.layer.getFieldDomain("LoaiCayTrong");p&&(h=p.codedValues)}else h=c.codedValues;if(h)(d=h.find(function(t){return t.code==e.LoaiCayTrong}))&&(l.innerText=d.name)}l.innerText||(l.innerText=e.LoaiCayTrong||"");var g=document.createElement("td");g.innerText=e.DienTich+""||"0";var m=document.createElement("td");m.innerText=i.formatDateValue(e.ThoiGianTrongTrot);var f=document.createElement("td");f.innerText=i.formatDateValue(e.ThoiGianBatDauTrong);var y=document.createElement("td"),v=document.createElement("td");v.innerText=e.GiaiDoanSinhTruong||"N/A";var T=document.createElement("span");T.classList.add("esri-icon-edit"),o(T,"click",function(t){n.tmpDatasDetailTrongTrong.tableDatas.map(function(t){t.OBJECTID==e.OBJECTID&&n.editDetailTrongTrot(t)})});var b=document.createElement("span");return b.classList.add("esri-icon-trash"),o(b,"click",function(){e.OBJECTID&&(n.tmpDatasDetailTrongTrong.deletes.push(e.OBJECTID),n.tmpDatasDetailTrongTrong.tableDatas.map(function(t){if(t.OBJECTID==e.OBJECTID){var i=n.tmpDatasDetailTrongTrong.tableDatas.indexOf(t);n.tmpDatasDetailTrongTrong.tableDatas.splice(i,1)}})),n.tmpDatasDetailTrongTrong.tbody.removeChild(a);var t=n.tmpDatasDetailTrongTrong.adds.find(function(t){return t.OBJECTID==e.OBJECTID});t&&n.tmpDatasDetailTrongTrong.adds.splice(n.tmpDatasDetailTrongTrong.adds.indexOf(t))}),y.appendChild(T),y.appendChild(b),a.appendChild(r),a.appendChild(l),a.appendChild(g),a.appendChild(m),a.appendChild(f),a.appendChild(v),a.appendChild(y),a}catch(e){throw e}},e.prototype.addDataToDetailTrongtrot=function(e){var t=this.renderDetailTrongtrot(e,!0);this.tmpDatasDetailTrongTrong.tbody.appendChild(t)},e.prototype.submitData=function(e){var t,n=[];e.tableDatas.map(function(t){e.adds.some(function(e){return e.OBJECTID==t.OBJECTID})&&n.push(t)}),this.tmpDatasDetailTrongTrong.adds=n,t=e.edits.filter(function(t){return e.adds.indexOf(t)}),this.tmpDatasDetailTrongTrong.edits=t},e.prototype.submitDetailTrongtrot=function(e){var t=this;this.submitData(e);var n={addFeatures:[],updateFeatures:[],deleteFeatures:[]};if(e.deletes.length>0&&(n.deleteFeatures=e.deletes),e.adds.length>0)for(var i=0,a=e.adds;i<a.length;i++){var r={DienTich:(l=a[i]).DienTich,GiaiDoanSinhTruong:l.GiaiDoanSinhTruong,LoaiCayTrong:l.LoaiCayTrong,MaDoiTuong:l.MaDoiTuong,NhomCayTrong:l.NhomCayTrong};l.ThoiGianBatDauTrong&&(r.ThoiGianBatDauTrong=l.ThoiGianBatDauTrong.getTime()),l.ThoiGianTrongTrot&&(r.ThoiGianTrongTrot=l.ThoiGianTrongTrot.getTime()),n.addFeatures.push({attributes:r})}if(e.edits.length>0)for(var o=0,s=e.edits;o<s.length;o++){var l;r={DienTich:(l=s[o]).DienTich,GiaiDoanSinhTruong:l.GiaiDoanSinhTruong,LoaiCayTrong:l.LoaiCayTrong,MaDoiTuong:l.MaDoiTuong,NhomCayTrong:l.NhomCayTrong,OBJECTID:l.OBJECTID};l.ThoiGianBatDauTrong&&(r.ThoiGianBatDauTrong=l.ThoiGianBatDauTrong.getTime()),l.ThoiGianTrongTrot&&(r.ThoiGianTrongTrot=l.ThoiGianTrongTrot.getTime()),n.updateFeatures.push({attributes:r})}this.thoiGianSanXuatTrongTrot.applyEdits(n).then(function(n){t.refreshNhomCayTrong(t.dataDetails,e.adds),t.tmpDatasDetailTrongTrong=null,t.dataDetails=null}),$("#ttModal").modal("toggle")},e.prototype.refreshNhomCayTrong=function(e,t){var n=this;if(0!==t.length){var i=e.filter(function(e){return e.NhomCayTrong===n.attributes.NhomCayTrong}),r=!1;if(i.length>0){var o={};for(var s in i.forEach(function(e){var t=e.ThoiGianBatDauTrong;o[t]||(o[t]=[]),o[t].push(e.GiaiDoanSinhTruong)}),o){if(-1!==o[s].indexOf("Thu hoạch")){r=!0;break}}}else r=!0;if(r){var l=t[0];this.layer.applyEdits({updateFeatures:[new a({attributes:{OBJECTID:this.attributes.OBJECTID,NhomCayTrong:l.NhomCayTrong}})]})}}},e}()}.apply(t,i))||(e.exports=a)},function(e,t,n){"use strict";var i,a;i=[n,t,n(2),n(11),n(0),n(1),n(5),n(35),n(39),n(34),n(55),n(33),n(52),n(51)],void 0===(a=function(e,t,n,i,a,r,o,s,l,u,c,d,h,p){return function(){function e(e,t){var a=this;this.view=e,this.options=t,this.locateViewModel=new l({view:e,graphic:null}),this.tblGiaiDoanSinhTruong=new d({url:i.tables.find(function(e){return e.id===n.TBL_GIAI_DOAN_SINH_TRUONG}).url,fieldID:"OBJECTID"}),this.fireFields=["NgayCapNhat","NguoiCapNhat","MaPhuongXa","MaHuyenTP","MaDoiTuong"],this.inputElement={},this.thoiGianSanXuatTrongTrotPopup=new c({view:e,table:t.table}),this.thoiGianSanXuatTrongTrotTbl=t.table,"/congtacvien"!==location.pathname&&(this._splitPolygon=new h(e),this.view.on("layerview-create",function(t){t.layer.id===n.TRONGTROT&&(a._mergePolygon=new p({view:e,layer:t.layer}))}))}return Object.defineProperty(e.prototype,"selectFeature",{get:function(){return this.view.popup.viewModel.selectedFeature},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layer",{get:function(){return this.selectFeature.layer||this._layer},set:function(e){this.selectFeature.layer||(this._layer=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"attributes",{get:function(){return this.selectFeature.attributes},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"objectId",{get:function(){return this.attributes.OBJECTID},enumerable:!0,configurable:!0}),e.prototype.resetInputElement=function(){this.inputElement={}},e.prototype.isFireField=function(e){return-1!==this.fireFields.indexOf(e)},e.prototype.getSubtype=function(e,t){if(e=e||this.layer.typeIdField,t=t||this.attributes[e],this.tblGiaiDoanSinhTruong.typeIdField===e){this.tblGiaiDoanSinhTruong.typeIdField;return this.tblGiaiDoanSinhTruong.types.find(function(e){return e.id==t})}return null},e.prototype.renderDomain=function(e,t){var n;if("inherited"===e.type){var i=this.layer.getFieldDomain(t);i&&(n=i.codedValues)}else n=e.codedValues;if(!n)return null;var a=this.attributes[t],r=document.createElement("select");r.classList.add("form-control");var o=document.createElement("option");o.value="-1",o.innerText="Chọn giá trị...",r.appendChild(o);for(var s=0,l=n;s<l.length;s++){var u=l[s],c=u.code,d=u.name,h=document.createElement("option");h.setAttribute("value",c),a===c&&(h.selected=!0),h.innerHTML=d,r.appendChild(h)}return r},e.prototype.showEdit=function(){var e=this,t=this.getSubtype();this.resetInputElement();for(var i=r.create("div",{id:"show-edit-container",class:"popup-content"}),a=r.create("table",{class:"table"},i),o=0,l=this.layer.fields;o<l.length;o++){var u=l[o];if("oid"!==u.type&&!this.isFireField(u.name)){var c=r.create("tr"),d=r.create("td",{innerHTML:u.alias}),h=void 0,p=r.create("td");if(t&&t.domains[u.name])h=this.renderDomain(t.domains[u.name],u.name);else if(u.domain)h=this.renderDomain(u.domain,u.name);else{var g=void 0,m=void 0;if("small-integer"===u.type||"integer"===u.type||"double"===u.type)g="number";else if("date"===u.type){g="date";var f=new Date(this.attributes[u.name]),y=f.getDate(),v=f.getMonth()+1,T=f.getFullYear();y/10<1&&(y="0"+y),v/10<1&&(v="0"+v),m=T+"-"+v+"-"+y}else g="text";h=length>=this.options.hightLength?r.create("textarea",{rows:5,cols:25,class:"form-control",innerHTML:m||this.attributes[u.name],value:m||this.attributes[u.name]}):r.create("input",{type:g,value:m||this.attributes[u.name],class:"form-control"})}h.name=u.name,r.place(h,p),r.place(d,c),r.place(p,c),r.place(c,a),this.inputElement[u.name]=h,this.registerChangeEvent(h)}}for(var b in this.layer.hasAttachments&&this.layer.getAttachments(this.objectId).then(function(t){var n=r.create("div",{class:"attachment-header",id:"attachment-"+e.layer.id+"-"+e.attributes.OBJECTID},document.getElementById("show-edit-container"));n.innerText="Hình ảnh";var i=document.createElement("form");i.id="attachment-data",i.enctype="multipart/form-data",i.method="post";var a=document.createElement("input");a.type="file",a.name="attachment",i.appendChild(a);var o=document.createElement("input");if(o.hidden=!0,o.name="f",o.value="json",i.appendChild(o),n.appendChild(i),e.registerChangeEvent(a),t&&t.attachmentInfos&&t.attachmentInfos.length>0)for(var s=0,l=t.attachmentInfos;s<l.length;s++){var u=l[s];e.renderAttachmentEditPopup(u,{container:n})}}),this.inputElement)this.inputChangeHandler(this.inputElement[b]);this.view.popup.content=i,this.view.popup.title=this.layer.title;var D=this.view.popup.actions.find(function(e){return"update"===e.id});D.className="esri-icon-check-mark",this.view.popup.actions.add({id:"update-geometry",title:"Cập nhật vị trí đối tượng",className:"esri-icon-locate"});var C=this.view.popup.actions.find(function(e){return"view-detail"===e.id});this.layer.id===n.TRONGTROT&&C&&(C.id="view-detail-edit");var w=function(){D.className="esri-icon-edit";var t=e.view.popup.actions.find(function(e){return"update-geometry"===e.id});t&&e.view.popup.actions.remove(t),e.layer.id===n.TRONGTROT&&C&&(C.id="view-detail")};s.once(this.view.popup,"selectedFeature").then(w),s.once(this.view.popup,"visible").then(w)},e.prototype.renderAttachmentEditPopup=function(e,t){var n=this,i=t.container||document.getElementById("attachment-"+this.layer.id+"-"+this.attributes.OBJECTID),o=this.layer.url+"/"+this.layer.layerId+"/"+this.attributes.OBJECTID,s=r.create("div",{class:"attachment-item"},i),l=r.create("div",{class:"attachment-name"},s);r.create("a",{href:o+"/attachments/"+e.id,target:"_blank"},l).innerText=e.name;var u=r.create("div",{class:"delete-attachment esri-icon-trash"},s);a(u,"click",function(){n.attributes.deleteAttachment||(n.attributes.deleteAttachment=[]),n.attributes.deleteAttachment.push(o+"/deleteAttachments?f=json&attachmentIds="+e.id),i.removeChild(s)})},e.prototype.registerChangeEvent=function(e){var t=this;a(e,"change",function(){return t.inputChangeHandler(e)})},e.prototype.inputChangeHandler=function(e){var t=e.name,n=e.value;if(n)if(-1!=n){if("attachment"===t)this.attributes[t]=n;else{var i=this.layer.fields.find(function(e){return e.name===t});if(i){var a=i.type;if(a){var r=void 0;r="small-integer"===a||"integer"===a?parseInt(n):"double"===a?parseFloat(n):n,this.attributes[t]=r}}}var o=this.getSubtype(t);if(o)for(var s in o.domains){var l=o.domains[s],u=this.inputElement[s];if(u){var c=void 0;if("inherited"===l.type){var d=this.layer.getFieldDomain(s);d&&(c=d.codedValues)}else c=l.codedValues;if("SELECT"===u.tagName){u.innerHTML="",(m=document.createElement("option")).value="-1",m.innerText="Chọn giá trị...",u.appendChild(m);for(var h=0,p=c;h<p.length;h++){var g=p[h];(T=document.createElement("option")).setAttribute("value",g.code),T.innerText=g.name,g.code===this.attributes[s]&&T.setAttribute("selected","selected"),u.appendChild(T)}this.attributes[s]=-1==u.value?null:u.value}else{var m,f=document.createElement("select");f.classList.add("form-control"),f.setAttribute("name",s),(m=document.createElement("option")).value="-1",m.innerText="Chọn giá trị...",f.appendChild(m),this.registerChangeEvent(f);for(var y=0,v=c;y<v.length;y++){var T;g=v[y];(T=document.createElement("option")).setAttribute("value",g.code),T.innerText=g.name,f.appendChild(T)}if(u.parentElement){var b=u.parentElement;u.parentElement.removeChild(b.firstChild),b.appendChild(f)}this.attributes[s]=-1==u.value?null:u.value,this.inputElement[s]=f}}}}else this.attributes[t]=null},e.prototype.uploadFile=function(){var e=this.layer.url+"/"+this.layer.layerId+"/"+this.objectId+"/addAttachment",t=document.getElementById("attachment-data");t&&o(e,{responseType:"json",body:t}).then(function(e){e.data&&e.data.addAttachmentResult&&e.data.addAttachmentResult.success?$.notify({message:"Thêm hình ảnh thành công"},{type:"success",placement:{from:"top",align:"left"}}):$.notify({message:"Thêm hình ảnh không thành công"},{type:"danger",placement:{from:"top",align:"left"}})})},e.prototype.editFeature=function(){var e=this,t=$.notify({title:"<strong>Cập nhật <i>"+this.layer.title+"</i></strong>",message:"Cập nhật..."},{showProgressbar:!0,delay:2e4,placement:{from:"top",align:"left"}});try{if(this.attributes){if(this.attributes.attachment&&this.uploadFile(),this.attributes.deleteAttachment){for(var n=0,i=this.attributes.deleteAttachment;n<i.length;n++){var a=i[n];o(a)}this.attributes.deleteAttachment=[]}for(var r=0,s=this.layer.fields;r<s.length;r++){var l=s[r],c=l.type,d=l.name;if("date"===c){var h=this.attributes[d];if(h&&!Number.isInteger(h)){var p=h.split("-");if(3!=p.length)throw"Không thể lấy dữ liệu thời gian";var g=p[2],m=p[1],f=p[0],y=new Date(m+"/"+g+"/"+f).getTime();this.attributes[d]=y}}}var v=u.getUpdatedInfo(this.view);for(var T in v)this.attributes[T]=v[T];this.layer.applyEdits({updateFeatures:[{attributes:this.attributes}]}).then(function(n){for(var i=!1,a=0,r=n.updateFeatureResults;a<r.length;a++){if(r[a].error){i=!0;break}}if(!i){t.update("type","success"),t.update("message","Cập nhật thành công!"),t.update("progress",90);var o=e.layer.createQuery();o.outFields=["*"],o.where="OBJECTID="+e.attributes.OBJECTID,e.layer.queryFeatures(o).then(function(t){e.view.popup.open({features:t.features})})}})}}catch(e){throw t.update("type","danger"),t.update("message","Có lỗi xảy ra trong quá trình cập nhật!"),t.update("progress",90),e}},e.prototype.deleteFeature=function(){var e=this;if(confirm("Chắc chắn muốn xóa?")){var t=this.objectId,n=$.notify({title:"<strong>Xóa <i>"+this.layer.title+"</i></strong>",message:"Đang xóa..."},{showProgressbar:!0,delay:2e4});this.layer.applyEdits({deleteFeatures:[{objectId:t}]}).then(function(t){t.deleteFeatureResults.length>0&&!t.deleteFeatureResults[0].error&&(e.view.popup.visible=!1,n.update("type","success"),n.update("message","Xóa thành công!"),n.update("progress",100))})}},e.prototype.splitPolygon=function(){this.view.popup.visible=!1,this._splitPolygon.startup(this.selectFeature,this.layer)},e.prototype.mergePolygon=function(){this.view.popup.visible=!1,this._mergePolygon.run(this.selectFeature)},e.prototype.updateGeometryGPS=function(){var e=this,t=this.objectId;$.notify({message:"Chọn vị trí trên bản đồ"});var n=$.notify({title:"<strong>Cập nhật vị trí</strong>",message:"Cập nhật..."},{showProgressbar:!0,delay:2e4,placement:{from:"top",align:"left"}}),i=this.view.on("click",function(a){a.stopPropagation(),e.layer.applyEdits({updateFeatures:[{attributes:{objectId:t,NguoiCapNhat:e.view.systemVariable.user.userName,NgayCapNhat:(new Date).getTime()},geometry:a.mapPoint}]}).then(function(t){t.updateFeatureResults[0].error?(n.update("type","danger"),n.update("message","Cập nhật không thành công!"),n.update("progress",90)):(n.update("type","success"),n.update("message","Cập nhật thành công!"),n.update("progress",90),e.view.popup.close())}),i.remove()})},e.prototype.showTableDetailTrongTrot=function(){this.thoiGianSanXuatTrongTrotPopup.showTableDetailTrongTrot()},e}()}.apply(t,i))||(e.exports=a)}]]);