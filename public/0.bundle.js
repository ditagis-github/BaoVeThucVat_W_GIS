(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[,,function(e,t,n){"use strict";var i;void 0===(i=function(e,t){return{BASEMAP:"dulieunen",SAUBENH:"SauBenh",DOANHNGHIEP:"DoanhNghiep",TRONGTROT:"TrongTrot",INDEX_HANHCHINHXA:4,INDEX_HANHCHINHHUYEN:5,TABLE_SXTT_URL:"https://ditagis.com:6443/arcgis/rest/services/BinhDuong/BaoVeThucVat/FeatureServer/3",THOI_GIAN_SAN_XUAT_TRONG_TROT:"thoigiansxtt",TBL_GIAI_DOAN_SINH_TRUONG:"tblgiaidoansinhtruong"}}.apply(t,[n,t]))||(e.exports=i)},,,,,,,,,function(e,t,n){"use strict";var i;void 0===(i=function(e,t){return{basemap:{title:"Dữ liệu nền",id:"dulieunen",url:"https://ditagis.com:6443/arcgis/rest/services/BinhDuong/DuLieuNen/MapServer",visible:!0,copyright:"Bản đồ biên tập bởi Trung tâm DITAGIS",sublayers:[{id:5,title:"Hành chính huyện"},{id:4,title:"Hành chính xã"},{id:3,title:"Sông hồ"},{id:2,title:"Phủ bề mặt",visible:!1},{id:1,title:"Mặt giao thông"},{id:0,title:"Tim đường"}]},layers:[{title:"Trồng trọt",id:"TrongTrot",url:"https://ditagis.com:6443/arcgis/rest/services/BinhDuong/BaoVeThucVat_ChuyenDe/FeatureServer/2",outFields:["*"]},{title:"Sâu bệnh",id:"SauBenh",url:"https://ditagis.com:6443/arcgis/rest/services/BinhDuong/BaoVeThucVat_ChuyenDe/FeatureServer/1",outFields:["*"]},{title:"Doanh nghiệp",id:"DoanhNghiep",url:"https://ditagis.com:6443/arcgis/rest/services/BinhDuong/BaoVeThucVat_ChuyenDe/FeatureServer/0",outFields:["*"]}],tables:[{id:"thoigiansxtt",url:"https://ditagis.com:6443/arcgis/rest/services/BinhDuong/BaoVeThucVat_ChuyenDe/FeatureServer/3"},{id:"tblgiaidoansinhtruong",url:"https://ditagis.com:6443/arcgis/rest/services/BinhDuong/BaoVeThucVat_ChuyenDe/FeatureServer/4"}],zoom:10,center:[106.6843694,11.158752270428375]}}.apply(t,[n,t]))||(e.exports=i)},,,,,,,,,,,,,,,function(e,t,n){"use strict";var i,a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();void 0===(i=function(e,t){return function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.eventListeners={},t.on=this.on,t.fire=this.fire,t.eventListeners=this.eventListeners}return a(e,[{key:"on",value:function(e,t){this.eventListeners[e]?this.eventListeners[e].push(t):this.eventListeners[e]=[t]}},{key:"fire",value:function(e,t){var n=this.eventListeners[e];if(n){var i=!0,a=!1,r=void 0;try{for(var o,s=n[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){(0,o.value)(t)}}catch(e){a=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(a)throw r}}}}}]),e}()}.apply(t,[n,t]))||(e.exports=i)},function(e,t,n){"use strict";var i,a,r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();i=[n,t,n(8),n(6),n(3),n(4),n(10),n(28)],void 0===(a=function(e,t,n,i,a,o,s,l){return function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n=n||{},this.view=t,this.graphics=new l({listMode:"hide"}),this.view.map.add(this.graphics),this.symbolMarker=n.symbolMarker||new i({color:new s([255,0,0]),size:3,outline:new a({width:7,color:new s([255,64,0,.4])})}),this.symbolLine=n.symbolLine||new a({color:new s([255,0,0]),width:4}),this.symbolPlg=n.symbolPlg||new o({style:"none",outline:new a({color:new s([255,64,0,.4]),width:1})})}return r(e,[{key:"hightlight",value:function(e){var t=this;this.clear(),this.view.hitTest(e).then(function(e){var n=!0,i=!1,a=void 0;try{for(var r,o=e.results[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){var s=r.value.graphic;s.attributes&&null!=s.attributes&&t.add(s)}}catch(e){i=!0,a=e}finally{try{!n&&o.return&&o.return()}finally{if(i)throw a}}})}},{key:"clear",value:function(){this.removeAll()}},{key:"rendererGraphic",value:function(e,t){var i=void 0;return i="point"===e?this.symbolMarker:"polyline"===e?this.symbolLine:this.symbolPlg,new n({geometry:t,symbol:i})}},{key:"add",value:function(e){var t=e.geometry.type,n=this.rendererGraphic(t,e.geometry);this.graphics.add(n)}},{key:"addAll",value:function(e){var t=!0,n=!1,i=void 0;try{for(var a,r=e[Symbol.iterator]();!(t=(a=r.next()).done);t=!0){var o=a.value;this.add(o)}}catch(e){n=!0,i=e}finally{try{!t&&r.return&&r.return()}finally{if(n)throw i}}}},{key:"removeAll",value:function(){this.graphics.removeAll()}}]),e}()}.apply(t,i))||(e.exports=a)},,,function(e,t,n){"use strict";var i,a;i=[n,t,n(26)],void 0===(a=function(e,t,n){return function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.eventListener=new n(this)}}.apply(t,i))||(e.exports=a)},,,function(e,t,n){"use strict";var i,a,r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();i=[n,t,n(9),n(5)],void 0===(a=function(e,t,n,i){return function(){function e(){var t=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=i.url,this.fieldID=i.fieldID||"OBJECTID",this.queryTask=new n(this.url),$.get(this.url+"?f=json").done(function(e){for(var n in e=JSON.parse(e))t[n]=e[n]})}return r(e,[{key:"findById",value:function(e){return this.queryTask.execute({outFields:["*"],where:this.fieldID+" = '"+e+"'"})}},{key:"getFieldDomain",value:function(e){return this.fields.find(function(t){return t.name===e}).domain}},{key:"applyEdits",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{addFeatures:[],updateFeatures:[],deleteFeatures:[]},t=document.createElement("form");if(t.method="post",e.addFeatures.length>0){var n=document.createElement("input");n.name="adds",n.type="text",n.value=JSON.stringify(e.addFeatures),t.appendChild(n)}if(e.deleteFeatures.length>0){var a=document.createElement("input");a.name="deletes",a.type="text",a.value=e.deleteFeatures.join(","),t.appendChild(a)}if(e.updateFeatures.length>0){var r=document.createElement("input");r.name="updates",r.type="text",r.value=JSON.stringify(e.updateFeatures),t.appendChild(r)}var o=document.createElement("input");return o.name="f",o.type="text",o.value="json",t.appendChild(o),i(this.url+"/applyEdits?f=json",{method:"post",body:t})}},{key:"queryFeatures",value:function(e){return this.queryTask.execute(e)}}]),e}()}.apply(t,i))||(e.exports=a)},function(e,t,n){"use strict";var i,a,r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var o=function(e,t,n,i){return new(n||(n=Promise))(function(a,r){function o(e){try{l(i.next(e))}catch(e){r(e)}}function s(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){e.done?a(e.value):new n(function(t){t(e.value)}).then(o,s)}l((i=i.apply(e,t||[])).next())})};i=[n,t,n(9),n(2)],void 0===(a=function(e,t,n,i){return function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,null,[{key:"getQueryLocation",value:function(e){return this._queryLocation||(this._queryLocation=new n({url:e.map.findLayerById(i.BASEMAP).findSublayerById(i.INDEX_HANHCHINHXA).url})),this._queryLocation}},{key:"getLocationName",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{PhuongXa:null,HuyenTP:null};return new Promise(function(i,a){try{var r=t.getQueryLocation(e),o=[];n.PhuongXa&&o.push("MaPhuongXa = '"+n.PhuongXa+"'"),n.HuyenTP&&o.push("MaHuyenTP = '"+n.HuyenTP+"'"),r.execute({outFields:["TenXa","TenHuyen"],where:o.join(" and ")}).then(function(e){if(e&&e.features.length>0){var t=e.features[0];t&&t.attributes&&i(t.attributes)}else i(null)})}catch(e){console.log(e),a(e)}})}},{key:"getCreatedInfo",value:function(e){return{NguoiCapNhat:e.systemVariable.user.userName,NgayCapNhat:(new Date).getTime()}}},{key:"getUpdatedInfo",value:function(e){return{NguoiCapNhat:e.systemVariable.user.userName,NgayCapNhat:(new Date).getTime()}}},{key:"getNhomCayTrong",value:function(e,t){return o(this,void 0,void 0,regeneratorRuntime.mark(function n(){var a,r,o;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return a=e.toScreen(t),n.next=3,e.hitTest(a);case 3:if(!((r=n.sent).results.length>0)){n.next=13;break}if(!((o=r.results.find(function(e){return e.graphic.layer.id===i.TRONGTROT}))&&o.graphic&&o.graphic.attributes)){n.next=10;break}return n.abrupt("return",{NhomCayTrong:o.graphic.attributes.NhomCayTrong,LoaiCayTrong:o.graphic.attributes.LoaiCayTrong});case 10:return n.abrupt("return",null);case 11:n.next=14;break;case 13:return n.abrupt("return",null);case 14:case"end":return n.stop()}},n,this)}))}},{key:"getLocationInfo",value:function(e,t){var n=this;return new Promise(function(i,a){try{n.getQueryLocation(e).execute({outFields:["MaPhuongXa","MaHuyenTP"],geometry:t}).then(function(e){if(e&&e.features.length>0){var t=e.features[0];t&&t.attributes&&i(t.attributes)}else i(null)})}catch(e){console.log(e),a(e)}})}}]),e}()}.apply(t,i))||(e.exports=a)},,,,,,function(e,t,n){"use strict";var i,a,r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var s=function(e,t,n,i){return new(n||(n=Promise))(function(a,r){function o(e){try{l(i.next(e))}catch(e){r(e)}}function s(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){e.done?a(e.value):new n(function(t){t(e.value)}).then(o,s)}l((i=i.apply(e,t||[])).next())})};i=[n,t,n(2),n(11),n(0),n(1),n(57),n(27),n(34),n(50),n(6),n(4),n(3),n(33),n(10)],void 0===(a=function(e,t,n,i,a,l,u,c,d,h,p,v,f,m,g){return function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.view=t,this.options={hightLength:100};var a=i.tables.find(function(e){return e.id===n.THOI_GIAN_SAN_XUAT_TRONG_TROT}).url;this.thoiGianSanXuatTrongTrot=new m({url:a,fieldID:"MaDoiTuong"}),this.popupEdit=new u(t,{hightLength:this.options.hightLength,table:this.thoiGianSanXuatTrongTrot}),this.tblGiaiDoanSinhTruong=new m({url:i.tables.find(function(e){return e.id===n.TBL_GIAI_DOAN_SINH_TRUONG}).url,fieldID:"OBJECTID"}),this.hightlightGraphic=new c(t,{symbolMarker:new p({outline:new f({color:new g("#7EABCD"),width:2})}),symbolFill:new v({outline:new f({color:new g("#7EABCD"),width:2})})})}return o(e,[{key:"startup",value:function(){var e=this;this.view.map.layers.map(function(t){t.then(function(){if("feature"==t.type){var i=[];t.permission.edit&&(i.push({id:"update",title:"Cập nhật",className:"esri-icon-edit",layer:t}),i.push({id:"update-geometry",title:"Cập nhật vị trí",className:"esri-icon-locate",layer:t})),t.permission.delete&&i.push({id:"delete",title:"Xóa",className:"esri-icon-erase",layer:t}),t.id===n.TRONGTROT&&("/cattachthua"!==location.pathname&&i.push({id:"view-detail",title:"Chi tiết thời gian trồng trọt",className:"esri-icon-table",layer:t}),"/congtacvien"!==location.pathname&&(i.push({id:"split",title:"Chia thửa",className:"esri-icon-zoom-out-fixed",layer:t}),i.push({id:"merge",title:"Ghép thửa",className:"esri-icon-zoom-in-fixed",layer:t}))),t.popupTemplate={content:function(n){var i=e.contentPopup(n,t);return i},title:t.title,actions:i}}})}),this.view.popup.watch("visible",function(t){t||e.hightlightGraphic.clear()}),this.view.popup.on("trigger-action",function(t){e.triggerActionHandler(t)}),this.view.popup.dockOptions={buttonEnabled:!0,breakpoint:{width:600,height:1e3},position:"bottom-center"}}},{key:"triggerActionHandler",value:function(e){var t=e.action.id,n=this.layer||e.action.layer;this.popupEdit.layer=n;var i=!1;switch(t){case"update":n.permission&&n.permission.edit?"esri-icon-check-mark"===e.action.className?this.popupEdit.editFeature():this.popupEdit.showEdit():i=!0;break;case"delete":n.permission&&n.permission.delete?this.popupEdit.deleteFeature():i=!0;break;case"view-detail":this.attributes.MaDoiTuong?this.triggerActionViewDetailTrongtrot(this.attributes.MaDoiTuong):$.notify({message:"Không xác được định danh"},{type:"danger"});break;case"view-detail-edit":this.attributes.MaDoiTuong?this.popupEdit.showTableDetailTrongTrot():$.notify({message:"Không xác được định danh"},{type:"danger"});break;case"update-geometry":if("polygon"===n.geometryType){alert("Không thể thay đổi vị trí vùng...");break}this.popupEdit.updateGeometryGPS();break;case"split":this.popupEdit.splitPolygon();break;case"merge":this.popupEdit.mergePolygon()}i&&$.notify({message:"Không có quyền thực hiện tác vụ"},{type:"danger"})}},{key:"getSubtype",value:function(e,t){if(e=e||this.layer.typeIdField,t=t||this.attributes[e],this.tblGiaiDoanSinhTruong.typeIdField===e){this.tblGiaiDoanSinhTruong.typeIdField;return this.tblGiaiDoanSinhTruong.types.find(function(e){return e.id==t})}return null}},{key:"renderDomain",value:function(e,t){var n=void 0;if("inherited"===e.type){var i=this.layer.getFieldDomain(t);i&&(n=i.codedValues)}else n=e.codedValues;return n}},{key:"contentPopup",value:function(e,t){return s(this,void 0,void 0,regeneratorRuntime.mark(function n(){var i,r,o,u,c,p,v,f,m,g,y,T,b,D=this;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:n.prev=0,i=e.graphic,r=i.layer||t,o=i.attributes,i.layer||(i.layer=r),this.hightlightGraphic.clear(),this.hightlightGraphic.add(i),u=l.create("div",{class:"popup-content",id:"popup-content"}),c=l.create("table",{},u),p=this.getSubtype(),v=regeneratorRuntime.mark(function e(t){var n,i,a,r,u,h,v,f,m;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=o[t.name],"oid"!==t.type){e.next=3;break}return e.abrupt("return","continue");case 3:if(i=l.create("tr"),a=l.create("td",{innerHTML:t.alias}),void 0,r=void 0,u=void 0,h=void 0,p&&p.domains[t.name]?h=D.renderDomain(p.domains[t.name],t.name):t.domain&&(h=D.renderDomain(t.domain,t.name)),!h){e.next=12;break}(v=h.find(function(e){return e.code===n}))&&(n=v.name),e.next=20;break;case 12:if("MaPhuongXa"!==t.name&&"MaHuyenTP"!==t.name||!o[t.name]){e.next=19;break}return e.next=15,d.getLocationName(D.view,{PhuongXa:o.MaPhuongXa,HuyenTP:o.MaHuyenTP}).then(function(e){return s(D,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e;case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)}))});case 15:f=e.sent,n="MaPhuongXa"==t.name?f.TenPhuong:f.TenHuyen,e.next=20;break;case 19:"small-integer"===t.type||"integer"===t.type||"double"===t.type||"date"===t.type&&(u="DateFormat");case 20:r=u?"{"+t.name+":"+u+"}":n,m=l.create("td"),null,t.length>=D.options.hightLength?l.create("textarea",{rows:5,cols:25,readonly:!0,innerHTML:r,style:"background: transparent;border:none"},m):m.innerHTML=r,l.place(a,i),l.place(m,i),l.place(i,c);case 27:case"end":return e.stop()}},e,D)}),f=!0,m=!1,g=void 0,n.prev=11,y=r.fields[Symbol.iterator]();case 13:if(f=(T=y.next()).done){n.next=22;break}return b=T.value,n.delegateYield(v(b),"t0",16);case 16:if("continue"!==n.t0){n.next=19;break}return n.abrupt("continue",19);case 19:f=!0,n.next=13;break;case 22:n.next=28;break;case 24:n.prev=24,n.t1=n.catch(11),m=!0,g=n.t1;case 28:n.prev=28,n.prev=29,!f&&y.return&&y.return();case 31:if(n.prev=31,!m){n.next=34;break}throw g;case 34:return n.finish(31);case 35:return n.finish(28);case 36:return r.hasAttachments&&r.getAttachments(o.OBJECTID).then(function(e){if(e&&e.attachmentInfos&&e.attachmentInfos.length>0){var t=l.create("div",{class:"attachment-container"},document.getElementById("popup-content"));l.create("legend",{innerHTML:"Hình ảnh"},t);var n=r.url+"/"+r.layerId+"/"+o.OBJECTID,i=function(e){var i=l.create("div",{class:"col-lg-3 col-md-4 col-xs-6 thumb"},t),r=l.create("a",{class:"thumbnail",href:"javascript:void(0)"},i),o=l.create("img",{class:"img-responsive",id:n+"/attachments/"+e.id,src:n+"/attachments/"+e.id,alt:n+"/attachments/"+e.name},r);a(r,"click",function(){var t=h.modal("attachments-"+e.id,e.name,o.cloneNode(!0));t&&t.modal()})},s=!0,u=!1,c=void 0;try{for(var d,p=e.attachmentInfos[Symbol.iterator]();!(s=(d=p.next()).done);s=!0){i(d.value)}}catch(e){u=!0,c=e}finally{try{!s&&p.return&&p.return()}finally{if(u)throw c}}}}),n.abrupt("return",u.outerHTML);case 40:throw n.prev=40,n.t2=n.catch(0),n.t2;case 43:case"end":return n.stop()}},n,this,[[0,40],[11,24,28,36],[29,,31,35]])}))}},{key:"triggerActionViewDetailTrongtrot",value:function(e){var t=this,n=$.notify({title:"Thời gian trồng trọt thửa đất: "+e,message:"Đang truy vấn..."},{delay:2e4,showProgressbar:!0});this.thoiGianSanXuatTrongTrot.findById(e).then(function(e){if(e.features.length>0){n.update("message","Tìm thấy "+e.features.length+" dữ liệu"),n.update("progress",100),n.update("type","success");var i=document.createElement("table");i.classList.add("table","table-hover");var a=document.createElement("thead");a.innerHTML="<tr>\n              <th>Nhóm cây trồng</th>\n              <th>Loại cây trồng</th>\n              <th>Diện tích</th>\n              <th>Thời gian bắt đầu trồng</th>\n              <th>Thời gian trồng trọt</th>\n              <th>Giai đoạn sinh trưởng</th>\n            </tr>\n            </thead>",l.place(a,i),i.appendChild(a);var o=document.createElement("tbody");i.appendChild(o);var s=e.features.sort(function(e,t){var n=e.attributes,i=t.attributes;return n.Nam==i.Nam?n.Thang>i.Thang:n.Nam>i.Nam}),u=function(e){var n=e.attributes,i=document.createElement("tr");i.classList.add("Info"),o.appendChild(i);var a=document.createElement("td"),r=t.layer.getFieldDomain("NhomCayTrong").codedValues;if(r){var s=r.find(function(e){return e.code==n.NhomCayTrong});s&&(a.innerText=s.name)}a.innerText||(a.innerText=n.NhomCayTrong+""||"");var l=document.createElement("td"),u=t.getSubtype("NhomCayTrong",n.NhomCayTrong);if(!u)return{v:void 0};var c=u.domains.LoaiCayTrong;if(c){var d=void 0;if("inherited"===c.type){var h=t.layer.getFieldDomain("LoaiCayTrong");h&&(d=h.codedValues)}else d=c.codedValues;if(d){var p=d.find(function(e){return e.code==n.LoaiCayTrong});p&&(l.innerText=p.name)}}l.innerText||(l.innerText=n.LoaiCayTrong||"");var v=document.createElement("td");v.innerText=n.DienTich+""||"0";var f=document.createElement("td");if(n.ThoiGianBatDauTrong){var m=new Date(n.ThoiGianBatDauTrong);f.innerText=m.getDate()+"/"+(m.getMonth()+1)+"/"+m.getFullYear()}var g=document.createElement("td");if(n.ThoiGianTrongTrot){var y=new Date(n.ThoiGianTrongTrot);g.innerText=y.getDate()+"/"+(y.getMonth()+1)+"/"+y.getFullYear()}var T=document.createElement("td");T.innerText=n.GiaiDoanSinhTruong,i.appendChild(a),i.appendChild(l),i.appendChild(v),i.appendChild(f),i.appendChild(g),i.appendChild(T)},c=!0,d=!1,p=void 0;try{for(var v,f=s[Symbol.iterator]();!(c=(v=f.next()).done);c=!0){var m=u(v.value);if("object"===(void 0===m?"undefined":r(m)))return m.v}}catch(e){d=!0,p=e}finally{try{!c&&f.return&&f.return()}finally{if(d)throw p}}h.modal("ttModal","Thời gian trồng trọt",i).modal()}else n.update("type","danger"),n.update("message","Không tìm thấy dữ liệu"),n.update("progress",100)})}},{key:"selectFeature",get:function(){return this.view.popup.viewModel.selectedFeature}},{key:"layer",get:function(){return this.selectFeature.layer}},{key:"attributes",get:function(){return this.selectFeature.attributes}},{key:"objectId",get:function(){return this.attributes.OBJECTID}}]),e}()}.apply(t,i))||(e.exports=a)},function(e,t,n){"use strict";var i,a,r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();i=[n(0),n(1),n(32),n(31),n(7)],void 0===(a=function(e,t,n,i,a){return function(){function n(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};for(var i in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.view=e,this.options={position:"top-left",icon:"esri-icon-user",title:"Người dùng"},t)this.options[i]=t[i];this.isStartup=!1}return r(n,[{key:"startup",value:function(){this.user&&(this.isStartup||(this.initView(),this.view.ui.add(this.expand,this.options.position),this.isStartup=!0))}},{key:"destroy",value:function(){this.isStartup&&(this.view.ui.remove(this.expand),delete this.DOM,delete this.expand,this.isStartup=!1)}},{key:"initView",value:function(){var n=this;try{this.DOM={},this.DOM.container=t.create("div",{class:"esri-widget ditagis-widget-user"}),this.DOM.ul=t.create("ul",{},this.DOM.container),t.create("li",{class:"title",innerHTML:this.user.displayName},this.DOM.ul),this.DOM.infoLi=t.create("li",{class:"item"},this.DOM.ul),this.DOM.infoDiv=t.create("div",{class:"container info"},this.DOM.infoLi),this.DOM.setting=t.create("button",{class:"dtg-btn-widget setting",innerHTML:"Cập nhật tài khoản"},this.DOM.infoDiv),e(this.DOM.setting,"click",function(){return n.settingUserClickHandler()}),this.DOM.btnLogout=t.create("button",{class:"dtg-btn-widget btn-logout",innerHTML:"Đăng xuất"},this.DOM.infoDiv),e(this.DOM.btnLogout,"click",function(){return n.logoutClickHandler()}),this.expand=new a({expandIconClass:this.options.icon,expandTooltip:this.options.title,view:this.view,content:this.DOM.container})}catch(e){console.log(e)}}},{key:"logoutClickHandler",value:function(){location.href="/account/logout"}},{key:"successLogout",value:function(){}},{key:"failLogout",value:function(){}},{key:"settingUserClickHandler",value:function(){}},{key:"user",get:function(){return this.view.systemVariable.user}}]),n}()}.apply(t,i))||(e.exports=a)},,,function(e,t,n){"use strict";var i,a,r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();i=[n,t,n(43),n(30),n(5)],void 0===(a=function(e,t,n,i,a){return function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.systemVariable=new i,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n),r(t,[{key:"session",value:function(){var e=this;return new Promise(function(t,n){a("/map",{method:"post"}).then(function(n){e.systemVariable.user=n.data,t(n.data)})})}}]),t}()}.apply(t,i))||(e.exports=a)},,function(e,t,n){"use strict";var i,a,r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();i=[n,t,n(1),n(42)],void 0===(a=function(e,t,n,i){return function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.container=n.toDom('<div class="dtg-tooltip-map"></div>'),i.set(this.container,{position:"fixed"})}return r(e,[{key:"show",value:function(e,t){i.set(this.container,{left:e[0]+30+"px",top:e[1]+"px"}),this.container.innerHTML=t,document.body.contains(this.container)||document.body.appendChild(this.container)}},{key:"hide",value:function(){document.body.contains(this.container)&&document.body.removeChild(this.container)}}],[{key:"instance",value:function(){return this._instance||(this._instance=new e),this._instance}}]),e}()}.apply(t,i))||(e.exports=a)},,,,function(e,t,n){"use strict";var i,a,r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();i=[n,t,n(29)],void 0===(a=function(e,t,n){return function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,null,[{key:"modal",value:function(e,t,i,a){try{var r=n.getBox().w+"px",o=void 0,s=void 0,l=void 0,u=void 0,c=void 0,d=void 0;(o=document.createElement("div")).classList.add("modal","fade"),o.id=e,o.setAttribute("tabindex","-1"),o.setAttribute("role","dialog"),o.setAttribute("aria-labelledby","myModalLabel"),o.setAttribute("aria-hidden","true"),(s=document.createElement("div")).classList.add("modal-dialog"),(l=document.createElement("div")).classList.add("modal-content"),l.style.maxWidth=r,l.style.width="fit-content",(u=document.createElement("div")).classList.add("modal-header");var h=document.createElement("button");h.type="button",h.classList.add("close"),h.setAttribute("data-dismiss","modal"),h.innerHTML='<span aria-hidden="true">×</span><span class="sr-only">Đóng</span>',u.appendChild(h),u.innerHTML+='<h4 class="modal-title">'+t+"</h4>",(c=document.createElement("div")).classList.add("modal-body"),c.appendChild(i),a&&((d=document.createElement("div")).classList.add("modal-footer"),d.appendChild(a)),l.appendChild(u),l.appendChild(c),d&&l.appendChild(d),s.appendChild(l),o.appendChild(s),document.body.appendChild(o);var p=$("#"+e);return p?(p.on("hidden.bs.modal",function(){p.remove()}),p):null}catch(e){throw e}}}]),e}()}.apply(t,i))||(e.exports=a)},function(e,t,n){"use strict";var i,a,r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();i=[n,t,n(12),n(2),n(28),n(8),n(4),n(3),n(36),n(10)],void 0===(a=function(e,t,n,i,a,o,s,l,u,c){var d=new s({outline:new l({color:new c("red")})});return function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mergeGraphics=new u,this.unionGraphic=null,this.mainGraphic=null,this.view=t.view,this.layer=t.layer,this.initWnd(),this.graphicLayers=new a({listMode:"hide"})}return r(e,[{key:"initWnd",value:function(){var e=document.createElement("div");e.id="dtg-wget-split-polygon",e.classList.add("esri-widget","esri-widget-button","esri-icon-close-circled"),e.title="Hủy",e.addEventListener("click",this.clear.bind(this)),this.widgetContainer=e}},{key:"run",value:function(e){var t=this;this.mainGraphic=e,this.isRun=!0,this.graphicLayers.removeAll(),this.mergeGraphics.add(e),this.graphicLayers.add(new o({geometry:e.geometry,symbol:d})),this.view.map.add(this.graphicLayers),this.clickHandler=this.view.on("click",function(n){n.stopPropagation(),t.view.hitTest({x:n.x,y:n.y}).then(function(n){if(n.results.length>0){var a=n.results.find(function(e){return e.graphic.layer.id===i.TRONGTROT});if(a){if(a.graphic===e)return;t.mergeGraphics.some(function(e){return e===a.graphic})?t.remove(a.graphic):t.add(a.graphic)}}})}),this.dblClickHandler=this.view.on("double-click",this.dblClickHandlerEvent.bind(this))}},{key:"add",value:function(e){this.graphicLayers.removeAll(),this.mergeGraphics.add(e);var t=n.union(this.mergeGraphics.map(function(e){return e.geometry}).toArray());return this.graphicLayers.add(new o({geometry:t,symbol:d})),this.unionGraphic=t,t}},{key:"remove",value:function(e){this.graphicLayers.removeAll(),this.mergeGraphics.remove(e);var t=n.union(this.mergeGraphics.map(function(e){return e.geometry}).toArray());return this.graphicLayers.add(new o({geometry:t,symbol:d})),this.unionGraphic=t,t}},{key:"dblClickHandlerEvent",value:function(e){if(e.stopPropagation(),confirm("Có chắc chắn ghép thửa?")){var t=this.mergeGraphics.slice(1,this.mergeGraphics.length).map(function(e){return{objectId:e.attributes.OBJECTID}}).toArray(),n=this.mainGraphic.clone();n.geometry=this.unionGraphic,this.layer.applyEdits({updateFeatures:[n],deleteFeatures:t})}this.clear()}},{key:"clear",value:function(){this.view.ui.remove(this.widgetContainer),this.mainGraphic=null,this.clickHandler&&(this.clickHandler.remove(),delete this.clickHandler),this.graphicLayers.removeAll(),this.view.map.remove(this.graphicLayers),this.mergeGraphics.removeAll(),this.dblClickHandler&&(this.dblClickHandler.remove(),delete this.dblClickHandler)}},{key:"isRun",get:function(){return this._isRun},set:function(e){e?this.view.ui.add(this.widgetContainer,"top-right"):this.clear(),this._isRun=e}}]),e}()}.apply(t,i))||(e.exports=a)},function(e,t,n){"use strict";var i,a,r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var o=function(e,t,n,i){return new(n||(n=Promise))(function(a,r){function o(e){try{l(i.next(e))}catch(e){r(e)}}function s(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){e.done?a(e.value):new n(function(t){t(e.value)}).then(o,s)}l((i=i.apply(e,t||[])).next())})};i=[n,t,n(1),n(0),n(46),n(27),n(4),n(3),n(10),n(8),n(38),n(37),n(12)],void 0===(a=function(e,t,n,i,a,s,l,u,c,d,h,p,v){return function(){function e(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.view=t,this.options={position:"top-right",icon:"esri-widget esri-widget-button esri-icon-basemap",icon_cancel:"esri-widget esri-widget-button esri-icon-close-circled",title:"Chia thửa",tooltip:{move:"Nhấn để vẽ đường chia thửa"}},this.initView()}return r(e,[{key:"startup",value:function(e,t){var n=this;this.selectedFeature=e,this.layer=t,this.hightlightGraphic.clear(),this.hightlightGraphic.add(e),this.add_dtg_wget_cancel(),this.clickEvent=i(this.view,"click",function(e){n.clickHandler(e)}),this.pointerMoveEvent=i(this.view,"pointer-move",function(e){a.instance().show([e.x,e.y],n.options.tooltip.move),n.pointerMoveHandler(e)}),this.dblClickHandler=i(this.view,"double-click",function(e){e.stopPropagation(),n.finish(e)})}},{key:"pointerMoveHandler",value:function(e){e.stopPropagation();var t={x:e.x,y:e.y},n=this.view.toMap(t),i=[n.x,n.y],a=[];if(this.vertices.length>0){var r=!0,o=!1,s=void 0;try{for(var l,u=this.vertices[Symbol.iterator]();!(r=(l=u.next()).done);r=!0){var c=l.value;a.push(c)}}catch(e){o=!0,s=e}finally{try{!r&&u.return&&u.return()}finally{if(o)throw s}}}a.push(i),this.refreshMainGraphic(a)}},{key:"finish",value:function(e){var t={x:e.x,y:e.y},n=this.view.toMap(t),i=[n.x,n.y];this.vertices.push(i),this.refreshMainGraphic(this.vertices),this.xuly(),this.clearEvent()}},{key:"xuly",value:function(){return o(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t,n,i,a,r,o,s,l,u,c,f,m,g,y,T,b,D,w,C,E,k,x;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!confirm("Có chắc chắn tách thửa?")){e.next=39;break}t=this.selectedFeature.attributes,n=this.selectedFeature.geometry,i=new h({paths:this.vertices,spatialReference:this.view.spatialReference}),a=v.cut(n,i),r=[],e.t0=regeneratorRuntime.keys(a);case 7:if((e.t1=e.t0()).done){e.next=31;break}for(o=e.t1.value,s=a[o],l=!0,u=!1,c=void 0,e.prev=13,f=s.rings[Symbol.iterator]();!(l=(m=f.next()).done);l=!0)g=m.value,r.push(g);e.next=21;break;case 17:e.prev=17,e.t2=e.catch(13),u=!0,c=e.t2;case 21:e.prev=21,e.prev=22,!l&&f.return&&f.return();case 24:if(e.prev=24,!u){e.next=27;break}throw c;case 27:return e.finish(24);case 28:return e.finish(21);case 29:e.next=7;break;case 31:return e.next=33,this.taoMaDoiTuong();case 33:for(y=e.sent,T=[],b=[],D=0;D<r.length;D++)w=new p({rings:r[D],spatialReference:this.view.spatialReference}),0==D?(C=new d({geometry:w,attributes:t}),T.push(C)):((E={}).LoaiCayTrong=t.LoaiCayTrong,E.OBJECTID=t.OBJECTID,E.MaHuyenTP=t.MaHuyenTP,E.NhomCayTrong=t.NhomCayTrong,E.MaDoiTuong=t.MaDoiTuong+"_"+(y+D),k=new d({geometry:w,attributes:E}),b.push(k));x={updateFeatures:T,addFeatures:b},this.layer.applyEdits(x),this.vertices=[];case 39:case"end":return e.stop()}},e,this,[[13,17,21,29],[22,,24,28]])}))}},{key:"taoMaDoiTuong",value:function(){return o(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t,n,i,a,r,o,s,l,u,c,d,h,p,v,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.selectedFeature.attributes.MaDoiTuong,n=t.split("_"),i=n.length,(a=this.layer.createQuery()).outFields=["MaDoiTuong"],a.where="MaDoiTuong like '"+t+"[_]%'",e.next=8,this.layer.queryFeatures(a);case 8:for(r=e.sent,o=0,s=!0,l=!1,u=void 0,e.prev=13,c=r.features[Symbol.iterator]();!(s=(d=c.next()).done);s=!0)h=d.value,(p=h.attributes.MaDoiTuong)&&(v=p.split("_"),(f=parseInt(v[i]))>o&&(o=f));e.next=21;break;case 17:e.prev=17,e.t0=e.catch(13),l=!0,u=e.t0;case 21:e.prev=21,e.prev=22,!s&&c.return&&c.return();case 24:if(e.prev=24,!l){e.next=27;break}throw u;case 27:return e.finish(24);case 28:return e.finish(21);case 29:return e.abrupt("return",o);case 30:case"end":return e.stop()}},e,this,[[13,17,21,29],[22,,24,28]])}))}},{key:"add_dtg_wget_cancel",value:function(){this.view.ui.add(this.DOM.cancel_wget,this.options.position)}},{key:"initView",value:function(){var e=this;try{this.vertices=[],this.hightlightGraphic=new s(this.view,{symbolPlg:new l({style:"none",outline:new u({color:new c("#0000ff"),width:1})})}),this.DOM={},this.DOM.cancel_wget=n.create("div",{id:"dtg-wget-split-polygon",class:this.options.icon_cancel,title:"Hủy"}),i(this.DOM.cancel_wget,"click",function(t){e.clearEvent()})}catch(e){throw e}}},{key:"clickHandler",value:function(e){e.stopPropagation();var t={x:e.x,y:e.y},n=this.view.toMap(t),i=[n.x,n.y];this.vertices.push(i),this.refreshMainGraphic(this.vertices)}},{key:"refreshMainGraphic",value:function(e){try{if(this.graphic&&(this.view.graphics.remove(this.graphic),this.graphic=null),e){var t=new h({paths:e,spatialReference:this.view.spatialReference});this.graphic=new d({geometry:t,symbol:new u({color:new c([255,0,0]),width:1})}),this.view.graphics.add(this.graphic)}}catch(e){console.log(e)}}},{key:"clearEvent",value:function(){this.clickEvent&&(this.clickEvent.remove(),this.clickEvent=null),this.pointerMoveEvent&&(a.instance().hide(),this.pointerMoveEvent.remove(),this.pointerMoveEvent=null),this.dblClickHandler&&(this.dblClickHandler.remove(),this.dblClickHandler=null),this.view.ui.remove(this.DOM.cancel_wget),this.vertices=[],this.hightlightGraphic.clear(),this.graphic&&(this.view.graphics.remove(this.graphic),this.graphic=null)}}]),e}()}.apply(t,i))||(e.exports=a)},function(e,t,n){"use strict";var i,a=function(e,t,n,i){return new(n||(n=Promise))(function(a,r){function o(e){try{l(i.next(e))}catch(e){r(e)}}function s(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){e.done?a(e.value):new n(function(t){t(e.value)}).then(o,s)}l((i=i.apply(e,t||[])).next())})};void 0===(i=function(e,t){var n=this;return{themTGSXTT:function(e){return a(n,void 0,void 0,regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch("/trongtrot/thoigian/add",{body:JSON.stringify(e[0])});case 3:return n=t.sent,t.abrupt("return",n);case 7:throw t.prev=7,t.t0=t.catch(0),t.t0;case 10:case"end":return t.stop()}},t,this,[[0,7]])}))}}}.apply(t,[n,t]))||(e.exports=i)},function(e,t,n){"use strict";var i,a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();void 0===(i=function(e,t){return function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.date=t}return a(e,[{key:"checkOutOfDate",value:function(e){return!((new Date).getTime()-e>0)}},{key:"checkUnexpired",value:function(e){return!this.checkOutOfDate(e)}}],[{key:"formatDateValue",value:function(e){if(!e)return"";var t=e.getDate(),n=e.getMonth()+1,i=e.getFullYear();return t/10<1&&(t="0"+t),n/10<1&&(n="0"+n),i+"-"+n+"-"+t}},{key:"formatNumberDate",value:function(e){if(!e)return"";var t=new Date(e),n=t.getDate(),i=t.getMonth()+1,a=t.getFullYear();return n/10<1&&(n="0"+n),i/10<1&&(i="0"+i),n+"/"+i+"/"+a}}]),e}()}.apply(t,[n,t]))||(e.exports=i)},function(e,t,n){"use strict";var i,a,r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();i=[n,t,n(29)],void 0===(a=function(e,t,n){return function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,null,[{key:"modal",value:function(e,t,i,a){try{var r=n.getBox().w+"px",o=void 0,s=void 0,l=void 0,u=void 0,c=void 0,d=void 0;(o=document.createElement("div")).classList.add("modal","fade"),o.id=e,o.setAttribute("tabindex","-1"),o.setAttribute("role","dialog"),o.setAttribute("aria-labelledby","myModalLabel"),o.setAttribute("aria-hidden","true"),(s=document.createElement("div")).classList.add("modal-dialog"),(l=document.createElement("div")).classList.add("modal-content"),l.style.maxWidth=r,l.style.width="fit-content",(u=document.createElement("div")).classList.add("modal-header");var h=document.createElement("button");h.type="button",h.classList.add("close"),h.setAttribute("data-dismiss","modal"),h.innerHTML='<span aria-hidden="true">×</span><span class="sr-only">Đóng</span>',u.appendChild(h),u.innerHTML+='<h4 class="modal-title">'+t+"</h4>",(c=document.createElement("div")).classList.add("modal-body"),c.appendChild(i),a&&((d=document.createElement("div")).classList.add("modal-footer"),d.appendChild(a)),l.appendChild(u),l.appendChild(c),d&&l.appendChild(d),s.appendChild(l),o.appendChild(s),document.body.appendChild(o);var p=$("#"+e);return p?(p.on("hidden.bs.modal",function(){p.remove()}),p):null}catch(e){throw e}}}]),e}()}.apply(t,i))||(e.exports=a)},function(e,t,n){"use strict";var i,a,r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();i=[n,t,n(55),n(54),n(8),n(33),n(0),n(12),n(2),n(11),n(53)],void 0===(a=function(e,t,n,i,a,o,s,l,u,c,d){return function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.view=t.view,this.thoiGianSanXuatTrongTrot=t.table,this.tblGiaiDoanSinhTruong=new o({url:c.tables.find(function(e){return e.id===u.TBL_GIAI_DOAN_SINH_TRUONG}).url,fieldID:"OBJECTID"}),this.dataDetails=[]}return r(e,[{key:"getSubtype",value:function(e,t){if(e=e||this.layer.typeIdField,t=t||this.attributes[e],this.tblGiaiDoanSinhTruong.typeIdField===e){this.tblGiaiDoanSinhTruong.typeIdField;return this.tblGiaiDoanSinhTruong.types.find(function(e){return e.id==t})}return null}},{key:"renderDomain",value:function(e,t){var n=void 0;if("inherited"===e.type){var i=this.layer.getFieldDomain(t);i&&(n=i.codedValues)}else n=e.codedValues;if(!n)return null;var a=this.attributes[t],r=document.createElement("select");r.classList.add("form-control");var o=document.createElement("option");o.value="-1",o.innerText="Chọn giá trị...",r.appendChild(o);var s=!0,l=!1,u=void 0;try{for(var c,d=n[Symbol.iterator]();!(s=(c=d.next()).done);s=!0){var h=c.value,p=h.code,v=h.name,f=document.createElement("option");f.setAttribute("value",p),a===p&&(f.selected=!0),f.innerHTML=v,r.appendChild(f)}}catch(e){l=!0,u=e}finally{try{!s&&d.return&&d.return()}finally{if(l)throw u}}return r}},{key:"addDetailTrongTrot",value:function(){var e=this,t=document.createElement("div"),i=void 0,a=void 0,r=void 0,o=void 0,u=void 0,c=void 0,d=void 0;i=document.createElement("div"),(r=document.createElement("div")).classList.add("form-group");var h=void 0,p=void 0;(p=document.createElement("select")).id="LoaiCayTrong",p.classList.add("form-control"),(h=document.createElement("label")).innerText="Loại cây trồng",h.setAttribute("for",p.id),r.appendChild(h),r.appendChild(p),(a=document.createElement("div")).classList.add("form-group");var v=void 0,f=void 0;(f=document.createElement("select")).id="NhomCayTrong",f.classList.add("form-control");var m=this.layer.getFieldDomain("NhomCayTrong").codedValues,g=!0,y=!1,T=void 0;try{for(var b,D=m[Symbol.iterator]();!(g=(b=D.next()).done);g=!0){var w=b.value,C=w.code,E=w.name,k=document.createElement("option");k.setAttribute("value",C+""),k.innerHTML=E,f.appendChild(k)}}catch(e){y=!0,T=e}finally{try{!g&&D.return&&D.return()}finally{if(y)throw T}}var x=function(){p.innerHTML="";var t=document.createElement("option");t.value="-1",t.innerText="Chọn giá trị...",p.appendChild(t);var n=e.getSubtype("NhomCayTrong",f.value);if(n){var i=n.domains.LoaiCayTrong;if(i){var a=void 0;if("inherited"===i.type){var r=e.layer.getFieldDomain("LoaiCayTrong");r&&(a=r.codedValues)}else a=i.codedValues;if(a){var o=!0,s=!1,l=void 0;try{for(var u,c=a[Symbol.iterator]();!(o=(u=c.next()).done);o=!0){var d=u.value,h=d.code,v=d.name,m=document.createElement("option");m.setAttribute("value",h),m.innerHTML=v,p.appendChild(m)}}catch(e){s=!0,l=e}finally{try{!o&&c.return&&c.return()}finally{if(s)throw l}}}}}};s(f,"change",function(){x()}),x(),(v=document.createElement("label")).innerText="Nhóm cây trồng",v.setAttribute("for",f.id),a.appendChild(v),a.appendChild(f),(o=document.createElement("div")).classList.add("form-group");var L=void 0,G=void 0;if((G=document.createElement("input")).id="DienTich",G.classList.add("form-control"),this.selectFeature.geometry){var N=l.geodesicArea(this.selectFeature.geometry,"square-meters").toFixed(1);G.value=N+""}(L=document.createElement("label")).innerText="Diện tích (m2)",L.setAttribute("for",G.id),o.appendChild(L),o.appendChild(G),(c=document.createElement("div")).classList.add("form-group");var O=void 0,I=void 0;(O=document.createElement("input")).type="date",O.id="ThoiGianTrongTrot",O.classList.add("form-control"),(I=document.createElement("label")).innerText="Thời gian trồng trọt",I.setAttribute("for",O.id),c.appendChild(I),c.appendChild(O),(u=document.createElement("div")).classList.add("form-group");var M=void 0,S=void 0;(M=document.createElement("input")).type="date",M.id="ThoiGianBatDauTrong",M.classList.add("form-control"),(S=document.createElement("label")).innerText="Thời gian bắt đầu trồng",S.setAttribute("for",M.id),u.appendChild(S),u.appendChild(M),(d=document.createElement("button")).classList.add("btn","btn-primary"),d.innerText="Thêm",s(d,"click",function(){var t={OBJECTID:e.tmpDatasDetailTrongTrong.adds.length+1,MaDoiTuong:e.attributes.MaDoiTuong,NhomCayTrong:parseInt(f.value),LoaiCayTrong:-1==p.value?null:p.value,DienTich:G.value?parseFloat(G.value):0,ThoiGianBatDauTrong:M.value?new Date(M.value):null,ThoiGianTrongTrot:O.value?new Date(O.value):M.value?new Date(M.value):null,GiaiDoanSinhTruong:"Trồng mới"},n=(e.tmpDatasDetailTrongTrong.tableDatas,e.tmpDatasDetailTrongTrong.adds),i=!0,a=!1,r=void 0;try{for(var o,s=n[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var l=o.value;if(t.LoaiCayTrong==l.LoaiCayTrong&&t.NhomCayTrong==l.NhomCayTrong&&t.ThoiGianBatDauTrong.getTime()===l.ThoiGianBatDauTrong.getTime())return void alert("Dữ liệu vừa mới thêm - Không được thêm nữa")}}catch(e){a=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(a)throw r}}e.tmpDatasDetailTrongTrong.tableDatas.push(t),e.tmpDatasDetailTrongTrong.adds.push(t),e.addDataToDetailTrongtrot(t),$("#ModalDetail").modal("toggle")}),i.appendChild(a),i.appendChild(r),i.appendChild(o),i.appendChild(u),i.appendChild(c),t.appendChild(i);var F=document.createElement("div");F.appendChild(d),n.modal("ModalDetail","Thêm dữ liệu",t,F).modal()}},{key:"editDetailTrongTrot",value:function(e){var t=this,a=document.createElement("div"),r=void 0,o=void 0,l=void 0,u=void 0,c=void 0,d=void 0,h=void 0,p=void 0;r=document.createElement("div"),(l=document.createElement("div")).classList.add("form-group");var v=void 0,f=void 0;(f=document.createElement("select")).classList.add("form-control"),(v=document.createElement("label")).innerText="Loại cây trồng",l.appendChild(v),l.appendChild(f),(o=document.createElement("div")).classList.add("form-group");var m=void 0,g=void 0;(g=document.createElement("select")).classList.add("form-control");var y=this.layer.getFieldDomain("NhomCayTrong").codedValues,T=!0,b=!1,D=void 0;try{for(var w,C=y[Symbol.iterator]();!(T=(w=C.next()).done);T=!0){var E=w.value,k=E.code,x=E.name,L=document.createElement("option");L.setAttribute("value",k+""),L.innerHTML=x,g.appendChild(L)}}catch(e){b=!0,D=e}finally{try{!T&&C.return&&C.return()}finally{if(b)throw D}}g.value=e.NhomCayTrong+"";var G=function(){f.innerHTML="";var e=document.createElement("option");e.value="-1",e.innerText="Chọn giá trị...",f.appendChild(e);var n=t.getSubtype("NhomCayTrong",g.value);if(n){var i=n.domains.LoaiCayTrong;if(i){var a=void 0;if("inherited"===i.type){var r=t.layer.getFieldDomain("LoaiCayTrong");r&&(a=r.codedValues)}else a=i.codedValues;if(a){var o=!0,s=!1,l=void 0;try{for(var u,c=a[Symbol.iterator]();!(o=(u=c.next()).done);o=!0){var d=u.value,h=d.code,p=d.name,v=document.createElement("option");v.setAttribute("value",h),v.innerHTML=p,f.appendChild(v)}}catch(e){s=!0,l=e}finally{try{!o&&c.return&&c.return()}finally{if(s)throw l}}}}}};s(g,"change",function(){G(),P()}),G(),f.value=e.LoaiCayTrong,s(f,"change",function(e){P()}),(m=document.createElement("label")).innerText="Nhóm cây trồng",o.appendChild(m),o.appendChild(g),(u=document.createElement("div")).classList.add("form-group");var N=void 0,O=void 0;(O=document.createElement("input")).type="number",O.value=e.DienTich+"",O.classList.add("form-control"),(N=document.createElement("label")).innerText="Diện tích (m2)",u.appendChild(N),u.appendChild(O),(c=document.createElement("div")).classList.add("form-group");var I=void 0,M=void 0;(I=document.createElement("input")).type="date",I.value=i.formatDateValue(e.ThoiGianTrongTrot),I.classList.add("form-control"),(M=document.createElement("label")).innerText="Thời gian trồng trọt",c.appendChild(M),c.appendChild(I),(d=document.createElement("div")).classList.add("form-group");var S=void 0,F=void 0;(S=document.createElement("input")).type="date",S.value=i.formatDateValue(e.ThoiGianBatDauTrong),S.classList.add("form-control"),(F=document.createElement("label")).innerText="Thời gian bắt đầu trồng",d.appendChild(F),d.appendChild(S),(h=document.createElement("div")).classList.add("form-group");var B=void 0,H=void 0;(B=document.createElement("label")).innerText="Giai đoạn sinh trưởng",(H=document.createElement("select")).classList.add("form-control");var A=document.createElement("option");A.value="Chưa xác định",A.innerText="Chọn giá trị...",A.selected=!0,H.appendChild(A);var P=function(){H.innerHTML="",H.appendChild(A),t.tblGiaiDoanSinhTruong.queryFeatures({where:"NhomCayTrong = "+g.value+" and LoaiCayTrong = '"+f.value+"'",outFields:["GiaiDoanSinhTruong"],orderByFields:["MocTG"]}).then(function(t){t.features.forEach(function(e){var t=e.attributes.GiaiDoanSinhTruong,n=document.createElement("option");n.value=n.innerText=t,H.appendChild(n)}),H.value=e.GiaiDoanSinhTruong})};h.appendChild(B),h.appendChild(H),(p=document.createElement("button")).classList.add("btn","btn-primary"),p.innerText="Chấp nhận",s(p,"click",function(){var n={OBJECTID:e.OBJECTID,NhomCayTrong:parseInt(g.value),LoaiCayTrong:"-1"==f.value?null:f.value,DienTich:O.value?parseFloat(O.value):0,ThoiGianTrongTrot:I.value?new Date(I.value):null,ThoiGianBatDauTrong:S.value?new Date(S.value):null,GiaiDoanSinhTruong:H.value};t.renderEditDetailTrongTrot(n),$("#ModalDetail").modal("toggle")}),r.appendChild(o),r.appendChild(l),r.appendChild(u),r.appendChild(d),r.appendChild(c),r.appendChild(h),a.appendChild(r);var _=document.createElement("div");_.appendChild(p),n.modal("ModalDetail","Sửa dữ liệu",a,_).modal()}},{key:"showTableDetailTrongTrot",value:function(){var e=this,t=$.notify({message:"Đang tai dữ liệu..."},{showProgressbar:!0,delay:2e4,placement:{from:"top",align:"left"}});this.tmpDatasDetailTrongTrong={adds:[],edits:[],deletes:[],tableDatas:[],tbody:null},this.dataDetails=[];var i=document.createElement("div"),a=document.createElement("div");a.classList.add("table-responsive");var r=document.createElement("table");r.classList.add("table"),a.appendChild(r);var o=document.createElement("thead");o.innerHTML="<tr>\n          <th>Nhóm cây trồng</th>\n          <th>Loại cây trồng</th>\n          <th>Diện tích (m2)</th>\n          <th>Thời gian trồng trọt</th>\n          <th>Thời gian bắt đầu trồng</th>\n          <th>Giai đoạn sinh trưởng</th>\n          <th>Tác vụ</th>\n        </tr>",r.appendChild(o);var l=document.createElement("tbody");r.appendChild(l),this.tmpDatasDetailTrongTrong.tbody=l;var u=document.createElement("div"),c=document.createElement("button");c.classList.add("btn","btn-default"),c.innerText="Thêm dữ liệu",s(c,"click",function(){e.addDetailTrongTrot()});var d=document.createElement("button");d.classList.add("btn","btn-primary"),d.innerText="Chấp nhận",s(d,"click",function(){e.submitDetailTrongtrot(e.tmpDatasDetailTrongTrong)});var h=document.createElement("button");h.type="button",h.classList.add("btn","btn-default"),h.setAttribute("data-dismiss","modal"),h.innerText="Đóng",u.appendChild(d),u.appendChild(c),u.appendChild(h),i.appendChild(a),this.thoiGianSanXuatTrongTrot.findById(this.attributes.MaDoiTuong).then(function(a){a.features.length>0&&a.features.forEach(function(t){var n=t.attributes,i={DienTich:n.DienTich,GiaiDoanSinhTruong:n.GiaiDoanSinhTruong,MaDoiTuong:n.MaDoiTuong,LoaiCayTrong:n.LoaiCayTrong,NhomCayTrong:n.NhomCayTrong,OBJECTID:n.OBJECTID};n.ThoiGianBatDauTrong&&(i.ThoiGianBatDauTrong=new Date(n.ThoiGianBatDauTrong)),n.ThoiGianTrongTrot&&(i.ThoiGianTrongTrot=new Date(n.ThoiGianTrongTrot)),e.tmpDatasDetailTrongTrong.tableDatas.push(i),e.dataDetails.push(t.attributes);var a=e.renderDetailTrongtrot(i);l.appendChild(a)});n.modal("ttModal","Thời gian trồng trọt",i,u).modal(),t.update("type","success"),t.update("progress",90)})}},{key:"renderEditDetailTrongTrot",value:function(e){var t=this;try{this.tmpDatasDetailTrongTrong.edits.map(function(n){n.OBJECTID==e.OBJECTID&&t.tmpDatasDetailTrongTrong.edits.splice(t.tmpDatasDetailTrongTrong.edits.indexOf(n))});var n=[];this.tmpDatasDetailTrongTrong.tableDatas.map(function(t){t.OBJECTID==e.OBJECTID?n.push(e):n.push(t)}),this.tmpDatasDetailTrongTrong.tableDatas=n,this.tmpDatasDetailTrongTrong.edits.push(e);var a=this.tmpDatasDetailTrongTrong.tbody.getElementsByTagName("tr"),r=void 0,o=!0,s=!1,l=void 0;try{for(var u,c=a[Symbol.iterator]();!(o=(u=c.next()).done);o=!0){var d=u.value,h=parseInt(d.id);if(h==e.OBJECTID||h==e.ID){r=d;break}}}catch(e){s=!0,l=e}finally{try{!o&&c.return&&c.return()}finally{if(s)throw l}}var p=r.getElementsByTagName("td"),v=p[0],f=p[1],m=p[2],g=p[3],y=p[4],T=p[5],b=this.layer.getFieldDomain("NhomCayTrong").codedValues;if(b){var D=b.find(function(t){return t.code==e.NhomCayTrong});D&&(v.innerText=D.name)}v.innerText||(v.innerText=e.NhomCayTrong+""||"");var w=this.getSubtype("NhomCayTrong",e.NhomCayTrong);if(!w)return;var C=w.domains.LoaiCayTrong;if(C){var E=void 0;if("inherited"===C.type){var k=this.layer.getFieldDomain("LoaiCayTrong");k&&(E=k.codedValues)}else E=C.codedValues;if(E){var x=E.find(function(t){return t.code==e.LoaiCayTrong});x&&(f.innerText=x.name)}}f.innerText||(f.innerText=e.LoaiCayTrong||""),m.innerText=e.DienTich+""||"0",g.innerText=i.formatDateValue(e.ThoiGianTrongTrot),y.innerText=i.formatDateValue(e.ThoiGianBatDauTrong),T.innerText=e.GiaiDoanSinhTruong}catch(e){throw"Có lỗi xảy ra trong quá trình thực hiện"}}},{key:"renderDetailTrongtrot",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{var a=document.createElement("tr");a.id=e.OBJECTID||e.ID,n&&a.classList.add("info");var r=document.createElement("td"),o=this.layer.getFieldDomain("NhomCayTrong").codedValues;if(o){var l=o.find(function(t){return t.code==e.NhomCayTrong});l&&(r.innerText=l.name)}r.innerText||(r.innerText=e.NhomCayTrong+""||"");var u=document.createElement("td"),c=this.getSubtype("NhomCayTrong",e.NhomCayTrong);if(!c)return;var d=c.domains.LoaiCayTrong;if(d){var h=void 0;if("inherited"===d.type){var p=this.layer.getFieldDomain("LoaiCayTrong");p&&(h=p.codedValues)}else h=d.codedValues;if(h){var v=h.find(function(t){return t.code==e.LoaiCayTrong});v&&(u.innerText=v.name)}}u.innerText||(u.innerText=e.LoaiCayTrong||"");var f=document.createElement("td");f.innerText=e.DienTich+""||"0";var m=document.createElement("td");m.innerText=i.formatDateValue(e.ThoiGianTrongTrot);var g=document.createElement("td");g.innerText=i.formatDateValue(e.ThoiGianBatDauTrong);var y=document.createElement("td"),T=document.createElement("td");T.innerText=e.GiaiDoanSinhTruong||"N/A";var b=document.createElement("span");b.classList.add("esri-icon-edit"),s(b,"click",function(n){t.tmpDatasDetailTrongTrong.tableDatas.map(function(n){n.OBJECTID==e.OBJECTID&&t.editDetailTrongTrot(n)})});var D=document.createElement("span");return D.classList.add("esri-icon-trash"),s(D,"click",function(){e.OBJECTID&&(t.tmpDatasDetailTrongTrong.deletes.push(e.OBJECTID),t.tmpDatasDetailTrongTrong.tableDatas.map(function(n){if(n.OBJECTID==e.OBJECTID){var i=t.tmpDatasDetailTrongTrong.tableDatas.indexOf(n);t.tmpDatasDetailTrongTrong.tableDatas.splice(i,1)}})),t.tmpDatasDetailTrongTrong.tbody.removeChild(a);var n=t.tmpDatasDetailTrongTrong.adds.find(function(t){return t.OBJECTID==e.OBJECTID});n&&t.tmpDatasDetailTrongTrong.adds.splice(t.tmpDatasDetailTrongTrong.adds.indexOf(n))}),y.appendChild(b),y.appendChild(D),a.appendChild(r),a.appendChild(u),a.appendChild(f),a.appendChild(m),a.appendChild(g),a.appendChild(T),a.appendChild(y),a}catch(e){throw e}}},{key:"addDataToDetailTrongtrot",value:function(e){var t=this.renderDetailTrongtrot(e,!0);this.tmpDatasDetailTrongTrong.tbody.appendChild(t)}},{key:"submitData",value:function(e){var t,n=[];e.tableDatas.map(function(t){e.adds.some(function(e){return e.OBJECTID==t.OBJECTID})&&n.push(t)}),this.tmpDatasDetailTrongTrong.adds=n,t=e.edits.filter(function(t){return e.adds.indexOf(t)}),this.tmpDatasDetailTrongTrong.edits=t}},{key:"submitDetailTrongtrot",value:function(e){this.submitData(e);var t={addFeatures:[],updateFeatures:[],deleteFeatures:[]};if(e.deletes.length>0&&(t.deleteFeatures=e.deletes),e.adds.length>0){var n=!0,i=!1,a=void 0;try{for(var r,o=e.adds[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){var s=r.value,l={DienTich:s.DienTich,GiaiDoanSinhTruong:s.GiaiDoanSinhTruong,LoaiCayTrong:s.LoaiCayTrong,MaDoiTuong:s.MaDoiTuong,NhomCayTrong:s.NhomCayTrong,ThoiGianBatDauTrong:s.ThoiGianBatDauTrong&&s.ThoiGianBatDauTrong.getTime(),ThoiGianTrongTrot:s.ThoiGianTrongTrot?s.ThoiGianTrongTrot.getTime():s.ThoiGianBatDauTrong?s.ThoiGianBatDauTrong.getTime():null};d.themTGSXTT([l])}}catch(e){i=!0,a=e}finally{try{!n&&o.return&&o.return()}finally{if(i)throw a}}}if(e.edits.length>0){var u=!0,c=!1,h=void 0;try{for(var p,v=e.edits[Symbol.iterator]();!(u=(p=v.next()).done);u=!0){var f=p.value,m={DienTich:f.DienTich,GiaiDoanSinhTruong:f.GiaiDoanSinhTruong,LoaiCayTrong:f.LoaiCayTrong,MaDoiTuong:f.MaDoiTuong,NhomCayTrong:f.NhomCayTrong,OBJECTID:f.OBJECTID};f.ThoiGianBatDauTrong&&(m.ThoiGianBatDauTrong=f.ThoiGianBatDauTrong.getTime()),f.ThoiGianTrongTrot&&(m.ThoiGianTrongTrot=f.ThoiGianTrongTrot.getTime()),t.updateFeatures.push({attributes:m})}}catch(e){c=!0,h=e}finally{try{!u&&v.return&&v.return()}finally{if(c)throw h}}}$("#ttModal").modal("toggle")}},{key:"refreshNhomCayTrong",value:function(e,t){var n=this;if(0!==t.length){var i=e.filter(function(e){return e.NhomCayTrong===n.attributes.NhomCayTrong}),r=!1;if(i.length>0){var o={};for(var s in i.forEach(function(e){var t=e.ThoiGianBatDauTrong;o[t]||(o[t]=[]),o[t].push(e.GiaiDoanSinhTruong)}),o){if(-1!==o[s].indexOf("Thu hoạch")){r=!0;break}}}else r=!0;if(r){var l=t[0];this.layer.applyEdits({updateFeatures:[new a({attributes:{OBJECTID:this.attributes.OBJECTID,NhomCayTrong:l.NhomCayTrong}})]})}}}},{key:"selectFeature",get:function(){return this.view.popup.viewModel.selectedFeature}},{key:"layer",get:function(){return this.view.map.findLayerById(u.TRONGTROT)}},{key:"attributes",get:function(){return this.selectFeature.attributes}}]),e}()}.apply(t,i))||(e.exports=a)},function(e,t,n){"use strict";var i,a,r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();i=[n,t,n(2),n(11),n(0),n(1),n(5),n(35),n(39),n(34),n(56),n(33),n(52),n(51)],void 0===(a=function(e,t,n,i,a,o,s,l,u,c,d,h,p,v){return function(){function e(t,a){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.view=t,this.options=a,this.locateViewModel=new u({view:t,graphic:null}),this.tblGiaiDoanSinhTruong=new h({url:i.tables.find(function(e){return e.id===n.TBL_GIAI_DOAN_SINH_TRUONG}).url,fieldID:"OBJECTID"}),this.fireFields=["NgayCapNhat","NguoiCapNhat","MaPhuongXa","MaHuyenTP","MaDoiTuong"],this.inputElement={},this.thoiGianSanXuatTrongTrotPopup=new d({view:t,table:a.table}),this.thoiGianSanXuatTrongTrotTbl=a.table,"/congtacvien"!==location.pathname&&(this._splitPolygon=new p(t),this.view.on("layerview-create",function(e){e.layer.id===n.TRONGTROT&&(r._mergePolygon=new v({view:t,layer:e.layer}))}))}return r(e,[{key:"resetInputElement",value:function(){this.inputElement={}}},{key:"isFireField",value:function(e){return-1!==this.fireFields.indexOf(e)}},{key:"getSubtype",value:function(e,t){if(e=e||this.layer.typeIdField,t=t||this.attributes[e],this.tblGiaiDoanSinhTruong.typeIdField===e){this.tblGiaiDoanSinhTruong.typeIdField;return this.tblGiaiDoanSinhTruong.types.find(function(e){return e.id==t})}return null}},{key:"renderDomain",value:function(e,t){var n=void 0;if("inherited"===e.type){var i=this.layer.getFieldDomain(t);i&&(n=i.codedValues)}else n=e.codedValues;if(!n)return null;var a=this.attributes[t],r=document.createElement("select");r.classList.add("form-control");var o=document.createElement("option");o.value="-1",o.innerText="Chọn giá trị...",r.appendChild(o);var s=!0,l=!1,u=void 0;try{for(var c,d=n[Symbol.iterator]();!(s=(c=d.next()).done);s=!0){var h=c.value,p=h.code,v=h.name,f=document.createElement("option");f.setAttribute("value",p),a===p&&(f.selected=!0),f.innerHTML=v,r.appendChild(f)}}catch(e){l=!0,u=e}finally{try{!s&&d.return&&d.return()}finally{if(l)throw u}}return r}},{key:"showEdit",value:function(){var e=this,t=this.getSubtype();this.resetInputElement();var i=o.create("div",{id:"show-edit-container",class:"popup-content"}),a=o.create("table",{class:"table"},i),r=!0,s=!1,u=void 0;try{for(var c,d=this.layer.fields[Symbol.iterator]();!(r=(c=d.next()).done);r=!0){var h=c.value;if("oid"!==h.type&&!this.isFireField(h.name)){var p=o.create("tr"),v=o.create("td",{innerHTML:h.alias}),f=void 0,m=o.create("td");if(t&&t.domains[h.name])f=this.renderDomain(t.domains[h.name],h.name);else if(h.domain)f=this.renderDomain(h.domain,h.name);else{var g=void 0,y=void 0;if("small-integer"===h.type||"integer"===h.type||"double"===h.type)g="number";else if("date"===h.type){g="date";var T=new Date(this.attributes[h.name]),b=T.getDate(),D=T.getMonth()+1,w=T.getFullYear();b/10<1&&(b="0"+b),D/10<1&&(D="0"+D),y=w+"-"+D+"-"+b}else g="text";f=length>=this.options.hightLength?o.create("textarea",{rows:5,cols:25,class:"form-control",innerHTML:y||this.attributes[h.name],value:y||this.attributes[h.name]}):o.create("input",{type:g,value:y||this.attributes[h.name],class:"form-control"})}f.name=h.name,o.place(f,m),o.place(v,p),o.place(m,p),o.place(p,a),this.inputElement[h.name]=f,this.registerChangeEvent(f)}}}catch(e){s=!0,u=e}finally{try{!r&&d.return&&d.return()}finally{if(s)throw u}}for(var C in this.layer.hasAttachments&&this.layer.getAttachments(this.objectId).then(function(t){var n=o.create("div",{class:"attachment-header",id:"attachment-"+e.layer.id+"-"+e.attributes.OBJECTID},document.getElementById("show-edit-container"));n.innerText="Hình ảnh";var i=document.createElement("form");i.id="attachment-data",i.enctype="multipart/form-data",i.method="post";var a=document.createElement("input");a.type="file",a.name="attachment",i.appendChild(a);var r=document.createElement("input");if(r.hidden=!0,r.name="f",r.value="json",i.appendChild(r),n.appendChild(i),e.registerChangeEvent(a),t&&t.attachmentInfos&&t.attachmentInfos.length>0){var s=!0,l=!1,u=void 0;try{for(var c,d=t.attachmentInfos[Symbol.iterator]();!(s=(c=d.next()).done);s=!0){var h=c.value;e.renderAttachmentEditPopup(h,{container:n})}}catch(e){l=!0,u=e}finally{try{!s&&d.return&&d.return()}finally{if(l)throw u}}}}),this.inputElement)this.inputChangeHandler(this.inputElement[C]);this.view.popup.content=i,this.view.popup.title=this.layer.title;var E=this.view.popup.actions.find(function(e){return"update"===e.id});E.className="esri-icon-check-mark",this.view.popup.actions.add({id:"update-geometry",title:"Cập nhật vị trí đối tượng",className:"esri-icon-locate"});var k=this.view.popup.actions.find(function(e){return"view-detail"===e.id});this.layer.id===n.TRONGTROT&&k&&(k.id="view-detail-edit");var x=function(){E.className="esri-icon-edit";var t=e.view.popup.actions.find(function(e){return"update-geometry"===e.id});t&&e.view.popup.actions.remove(t),e.layer.id===n.TRONGTROT&&k&&(k.id="view-detail")};l.once(this.view.popup,"selectedFeature").then(x),l.once(this.view.popup,"visible").then(x)}},{key:"renderAttachmentEditPopup",value:function(e,t){var n=this,i=t.container||document.getElementById("attachment-"+this.layer.id+"-"+this.attributes.OBJECTID),r=this.layer.url+"/"+this.layer.layerId+"/"+this.attributes.OBJECTID,s=o.create("div",{class:"attachment-item"},i),l=o.create("div",{class:"attachment-name"},s);o.create("a",{href:r+"/attachments/"+e.id,target:"_blank"},l).innerText=e.name;var u=o.create("div",{class:"delete-attachment esri-icon-trash"},s);a(u,"click",function(){n.attributes.deleteAttachment||(n.attributes.deleteAttachment=[]),n.attributes.deleteAttachment.push(r+"/deleteAttachments?f=json&attachmentIds="+e.id),i.removeChild(s)})}},{key:"registerChangeEvent",value:function(e){var t=this;a(e,"change",function(){return t.inputChangeHandler(e)})}},{key:"inputChangeHandler",value:function(e){var t=e.name,n=e.value;if(n)if(-1!=n){if("attachment"===t)this.attributes[t]=n;else{var i=this.layer.fields.find(function(e){return e.name===t});if(i){var a=i.type;if(a){var r=void 0;r="small-integer"===a||"integer"===a?parseInt(n):"double"===a?parseFloat(n):n,this.attributes[t]=r}}}var o=this.getSubtype(t);if(o)for(var s in o.domains){var l=o.domains[s],u=this.inputElement[s];if(u){var c=void 0;if("inherited"===l.type){var d=this.layer.getFieldDomain(s);d&&(c=d.codedValues)}else c=l.codedValues;if("SELECT"===u.tagName){u.innerHTML="";var h=document.createElement("option");h.value="-1",h.innerText="Chọn giá trị...",u.appendChild(h);var p=!0,v=!1,f=void 0;try{for(var m,g=c[Symbol.iterator]();!(p=(m=g.next()).done);p=!0){var y=m.value,T=document.createElement("option");T.setAttribute("value",y.code),T.innerText=y.name,y.code===this.attributes[s]&&T.setAttribute("selected","selected"),u.appendChild(T)}}catch(e){v=!0,f=e}finally{try{!p&&g.return&&g.return()}finally{if(v)throw f}}this.attributes[s]=-1==u.value?null:u.value}else{var b=document.createElement("select");b.classList.add("form-control"),b.setAttribute("name",s);var D=document.createElement("option");D.value="-1",D.innerText="Chọn giá trị...",b.appendChild(D),this.registerChangeEvent(b);var w=!0,C=!1,E=void 0;try{for(var k,x=c[Symbol.iterator]();!(w=(k=x.next()).done);w=!0){var L=k.value,G=document.createElement("option");G.setAttribute("value",L.code),G.innerText=L.name,b.appendChild(G)}}catch(e){C=!0,E=e}finally{try{!w&&x.return&&x.return()}finally{if(C)throw E}}if(u.parentElement){var N=u.parentElement;u.parentElement.removeChild(N.firstChild),N.appendChild(b)}this.attributes[s]=-1==u.value?null:u.value,this.inputElement[s]=b}}}}else this.attributes[t]=null}},{key:"uploadFile",value:function(){var e=this.layer.url+"/"+this.layer.layerId+"/"+this.objectId+"/addAttachment",t=document.getElementById("attachment-data");t&&s(e,{responseType:"json",body:t}).then(function(e){e.data&&e.data.addAttachmentResult&&e.data.addAttachmentResult.success?$.notify({message:"Thêm hình ảnh thành công"},{type:"success",placement:{from:"top",align:"left"}}):$.notify({message:"Thêm hình ảnh không thành công"},{type:"danger",placement:{from:"top",align:"left"}})})}},{key:"editFeature",value:function(){var e=this,t=$.notify({title:"<strong>Cập nhật <i>"+this.layer.title+"</i></strong>",message:"Cập nhật..."},{showProgressbar:!0,delay:2e4,placement:{from:"top",align:"left"}});try{if(this.attributes){if(this.attributes.attachment&&this.uploadFile(),this.attributes.deleteAttachment){var n=!0,i=!1,a=void 0;try{for(var r,o=this.attributes.deleteAttachment[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){var l=r.value;s(l)}}catch(e){i=!0,a=e}finally{try{!n&&o.return&&o.return()}finally{if(i)throw a}}this.attributes.deleteAttachment=[]}var u=!0,d=!1,h=void 0;try{for(var p,v=this.layer.fields[Symbol.iterator]();!(u=(p=v.next()).done);u=!0){var f=p.value,m=f.type,g=f.name;if("date"===m){var y=this.attributes[g];if(y&&!Number.isInteger(y)){var T=y.split("-");if(3!=T.length)throw"Không thể lấy dữ liệu thời gian";var b=T[2],D=T[1],w=T[0],C=new Date(D+"/"+b+"/"+w).getTime();this.attributes[g]=C}}}}catch(e){d=!0,h=e}finally{try{!u&&v.return&&v.return()}finally{if(d)throw h}}var E=c.getUpdatedInfo(this.view);for(var k in E)this.attributes[k]=E[k];this.layer.applyEdits({updateFeatures:[{attributes:this.attributes}]}).then(function(n){var i=!1,a=!0,r=!1,o=void 0;try{for(var s,l=n.updateFeatureResults[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){if(s.value.error){i=!0;break}}}catch(e){r=!0,o=e}finally{try{!a&&l.return&&l.return()}finally{if(r)throw o}}if(!i){t.update("type","success"),t.update("message","Cập nhật thành công!"),t.update("progress",90);var u=e.layer.createQuery();u.outFields=["*"],u.where="OBJECTID="+e.attributes.OBJECTID,e.layer.queryFeatures(u).then(function(t){e.view.popup.open({features:t.features})})}})}}catch(e){throw t.update("type","danger"),t.update("message","Có lỗi xảy ra trong quá trình cập nhật!"),t.update("progress",90),e}}},{key:"deleteFeature",value:function(){var e=this;if(confirm("Chắc chắn muốn xóa?")){var t=this.objectId,n=$.notify({title:"<strong>Xóa <i>"+this.layer.title+"</i></strong>",message:"Đang xóa..."},{showProgressbar:!0,delay:2e4});this.layer.applyEdits({deleteFeatures:[{objectId:t}]}).then(function(t){t.deleteFeatureResults.length>0&&!t.deleteFeatureResults[0].error&&(e.view.popup.visible=!1,n.update("type","success"),n.update("message","Xóa thành công!"),n.update("progress",100))})}}},{key:"splitPolygon",value:function(){this.view.popup.visible=!1,this._splitPolygon.startup(this.selectFeature,this.layer)}},{key:"mergePolygon",value:function(){this.view.popup.visible=!1,this._mergePolygon.run(this.selectFeature)}},{key:"updateGeometryGPS",value:function(){var e=this,t=this.objectId;$.notify({message:"Chọn vị trí trên bản đồ"});var n=$.notify({title:"<strong>Cập nhật vị trí</strong>",message:"Cập nhật..."},{showProgressbar:!0,delay:2e4,placement:{from:"top",align:"left"}}),i=this.view.on("click",function(a){a.stopPropagation(),e.layer.applyEdits({updateFeatures:[{attributes:{objectId:t,NguoiCapNhat:e.view.systemVariable.user.userName,NgayCapNhat:(new Date).getTime()},geometry:a.mapPoint}]}).then(function(t){t.updateFeatureResults[0].error?(n.update("type","danger"),n.update("message","Cập nhật không thành công!"),n.update("progress",90)):(n.update("type","success"),n.update("message","Cập nhật thành công!"),n.update("progress",90),e.view.popup.close())}),i.remove()})}},{key:"showTableDetailTrongTrot",value:function(){this.thoiGianSanXuatTrongTrotPopup.showTableDetailTrongTrot()}},{key:"selectFeature",get:function(){return this.view.popup.viewModel.selectedFeature}},{key:"layer",get:function(){return this.selectFeature.layer||this._layer},set:function(e){this.selectFeature.layer||(this._layer=e)}},{key:"attributes",get:function(){return this.selectFeature.attributes}},{key:"objectId",get:function(){return this.attributes.OBJECTID}}]),e}()}.apply(t,i))||(e.exports=a)}]]);