define(["dojo/on","dojo/dom-construct","esri/symbols/SimpleFillSymbol","esri/symbols/SimpleLineSymbol","esri/request","esri/symbols/SimpleMarkerSymbol","esri/tasks/QueryTask","esri/widgets/Expand","dojo/sniff","esri/geometry/Extent","esri/renderers/UniqueValueRenderer","esri/tasks/support/Query","esri/widgets/Search","esri/widgets/Legend","esri/widgets/LayerList","esri/widgets/Locate","esri/layers/WebTileLayer","esri/layers/FeatureLayer","esri/layers/MapImageLayer","esri/layers/OpenStreetMapLayer","esri/tasks/Locator","esri/Map","esri/geometry/Point","esri/Graphic","esri/Color","esri/geometry/geometryEngine","esri/layers/GraphicsLayer","dojo/window","dojo/dom","dojo/dom-class","esri/core/Collection","esri/geometry/Polygon","esri/geometry/Polyline","esri/widgets/Locate/LocateViewModel","esri/core/watchUtils","dojo/dom-style","esri/views/MapView"],function(e,t,n,r,o,i,s,a,c,u,l,p,f,d,m,v,y,h,g,w,x,b,k,T,E,S,j,L,P,A,C,H,M,I,N,O,V){return function(e){function t(t){for(var n,o,i=t[0],s=t[1],a=0,u=[];a<i.length;a++)o=i[a],r[o]&&u.push(r[o][0]),r[o]=0;for(n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n]);for(c&&c(t);u.length;)u.shift()()}var n={},r={3:0};function o(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.e=function(e){var t=[],n=r[e];if(0!==n)if(n)t.push(n[2]);else{var i=new Promise(function(t,o){n=r[e]=[t,o]});t.push(n[2]=i);var s=document.getElementsByTagName("head")[0],a=document.createElement("script");a.charset="utf-8",a.timeout=120,o.nc&&a.setAttribute("nonce",o.nc),a.src=function(e){return o.p+""+({}[e]||e)+".bundle.js"}(e);var c=setTimeout(function(){u({type:"timeout",target:a})},12e4);function u(t){a.onerror=a.onload=null,clearTimeout(c);var n=r[e];if(0!==n){if(n){var o=t&&("load"===t.type?"missing":t.type),i=t&&t.target&&t.target.src,s=new Error("Loading chunk "+e+" failed.\n("+o+": "+i+")");s.type=o,s.request=i,n[1](s)}r[e]=void 0}}a.onerror=a.onload=u,s.appendChild(a)}return Promise.all(t)},o.m=e,o.c=n,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},o.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/",o.oe=function(e){throw console.error(e),e};var i=window.webpackJsonp=window.webpackJsonp||[],s=i.push.bind(i);i.push=t,i=i.slice();for(var a=0;a<i.length;a++)t(i[a]);var c=s;return o(o.s=47)}([function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t){e.exports=r},function(e,t){e.exports=o},function(e,t){e.exports=i},function(e,t){e.exports=s},function(e,t){e.exports=a},function(e,t){e.exports=c},function(e,t){e.exports=u},function(e,t){e.exports=l},function(e,t){e.exports=p},function(e,t){e.exports=f},function(e,t){e.exports=d},function(e,t){e.exports=m},function(e,t){e.exports=v},function(e,t){e.exports=y},function(e,t){e.exports=h},function(e,t){e.exports=g},function(e,t){e.exports=w},function(e,t){e.exports=x},function(e,t){e.exports=b},function(e,t){e.exports=k},,function(e,t){e.exports=T},function(e,t){e.exports=E},,function(e,t){e.exports=S},function(e,t){e.exports=j},function(e,t){e.exports=L},,function(e,t){e.exports=P},function(e,t){e.exports=A},function(e,t){e.exports=C},function(e,t){e.exports=H},function(e,t){e.exports=M},function(e,t){e.exports=I},function(e,t){e.exports=N},,,function(e,t){e.exports=O},function(e,t){e.exports=V},,,,,,function(e,t,n){n.e(1).then(function(){var e=[n(23),n(26),n(21),n(20),n(42),n(19),n(18),n(17),n(16),n(7),n(15),n(14),n(13),n(12),n(6),n(11),n(4),n(10),n(5),n(30),n(39),n(38),n(2),n(3),n(9),n(0),n(1),n(8)];(function(e,t,n,r,o,i,s,a,c,u,l,p,f,d,m,v,y,h,g,w,x,b,k,T,E,S,j,L){"use strict";var P,A,C,H=new w,M=new n({}),I=new o({container:"map",map:M,center:t.center,zoom:t.zoom});I.session().then(function(n){H.user=n;var r=void 0;7===Math.floor(H.user.role/100)&&(r="MaHuyenTP = '"+H.user.role.trim()+"'"),I.systemVariable=H;!function(){var n=t.basemap;if(r){var o=n.sublayers,i=Array.isArray(o),a=0;for(o=i?o:o[Symbol.iterator]();;){var u;if(i){if(a>=o.length)break;u=o[a++]}else{if((a=o.next()).done)break;u=a.value}u.definitionExpression=r}}function l(e,t,n,r){if(e)switch(r){case C:P.visible=A.visible=!e;break;case P:C.visible=A.visible=!e;break;case A:C.visible=P.visible=!e}}n.visible=!1,(P=new s(n)).watch("visible",function(e){$&&$.notify(e?"Hiển thị dữ liệu nền":"Ẩn dữ liệu nền")}),P.then(function(){if(r){var t=P.findSublayerById(e.INDEX_HANHCHINHHUYEN),n=t.createQuery();n.where=r,n.returnGeometry=!0,n.outSpatialReference=I.spatialReference,t.queryFeatures(n).then(function(e){var t=e.features[0];I.goTo({target:t.geometry})})}}),A=new c({urlTemplate:"//mt1.google.com/vt/lyrs=y&x={col}&y={row}&z={level}",title:"Ảnh vệ tinh",id:"worldimagery",visible:!0}),C=new c({title:"Đường đi",urlTemplate:"//mt1.google.com/vt/lyrs=m&x={col}&y={row}&z={level}",id:"osm",visible:!1}),M.addMany([C,A,P]),C.watch("visible",l),A.watch("visible",l),P.watch("visible",l)}(),(a.prototype.getAttachments=function(e){var t=this;return new Promise(function(n,r){var o=t.url+"/"+t.layerId+"/"+e;y(o+"/attachments?f=json",{responseType:"json",method:"get"}).then(function(e){n(e.data||null)})})},new Promise(function(n,o){y("/map/layerrole",{method:"post"}).then(function(o){if(!o.data)throw"cannot request permission";var i=function(){if(c){if(u>=s.length)return"break";l=s[u++]}else{if((u=s.next()).done)return"break";l=u.value}var e=l;t.layers.find(function(t){return t.id===e.layer}).permission={create:e.isCreate,view:e.isView,delete:e.false,edit:e.false}},s=o.data,c=Array.isArray(s),u=0;for(s=c?s:s[Symbol.iterator]();;){var l;if("break"===i())break}for(var p in t.layers){var f=t.layers[p];if(f.permission.view){if(f.id===e.SAUBENH||f.id===e.DOANHNGHIEP)continue;r&&(f.definitionExpression?f.definitionExpression+=" and "+r:f.definitionExpression=r,f.definitionExpression=r),f.id===e.TRONGTROT&&(f.opacity=.7);var d=new a(f);M.add(d)}}var m=new a({id:"danhdauvitri",url:"https://ditagis.com:6443/arcgis/rest/services/BinhDuong/BaoVeThucVat_DanhDauViTri/FeatureServer/0",permission:{create:!1,view:!0,delete:!0,edit:!1}});M.add(m),n()})})).then(function(){(function(){var e,t,n,r,o;e=$("<div/>",{class:"google-geocoding-widget input-group add-on"}),t=$("<input/>",{class:"form-control",type:"text",name:"srch-term",id:"srch-term",placeholder:"Nhập đơn vị hành chính, tên đường "}).appendTo(e),n=$("<div/>",{class:"input-group-btn"}).appendTo(e),r=$("<button/>",{class:"btn btn-default",type:"submit"}).appendTo(n),$("<i/>",{class:"glyphicon glyphicon-search"}).appendTo(r),o=$("<div/>",{class:"output-group add-on",id:"ketqua"}),I.ui.add(e[0],"top-left"),I.ui.add(o[0],"top-left"),r.on("click",function(e){function n(){var e=document.getElementById("ketqua");if(e)for(;e.firstChild;)e.removeChild(e.firstChild)}var r=t.val().toString().replace(/[ ]/g,"+");$.get("https://maps.googleapis.com/maps/api/geocode/json?address="+r+"&key=AIzaSyC9VTEqoczK2j7lDRacfQ3aRTE3f4vuHek").done(function(e){var t=e.results;n();var r=function(){if(s){if(a>=i.length)return"break";c=i[a++]}else{if((a=i.next()).done)return"break";c=a.value}var e=c,t=$("<div />",{class:"address list-group-item"}).appendTo(o);$("<div />",{class:"address-detail",text:e.formatted_address}).appendTo(t).click(function(){return t=e.geometry.viewport,r=new E({ymin:t.southwest.lat,ymax:t.northeast.lat,xmin:t.southwest.lng,xmax:t.northeast.lng}),I.goTo(r),void n();var t,r})},i=t,s=Array.isArray(i),a=0;for(i=s?i:i[Symbol.iterator]();;){var c;if("break"===r())break}})}),new x(I).startup(),I.ui.move(["zoom"],"top-left"),I.ui.add(new u({expandIconClass:"esri-icon-layer-list",view:I,content:new p({container:document.createElement("div"),view:I})}),"top-left"),I.ui.add(new l({view:I}),"top-left"),I.ui.add(new u({expandIconClass:"esri-icon-collection",content:new f({view:I})}),"top-left"),new b(I).startup()})(),M.reorder(P,5)}),Loader.hide()})}).apply(null,e)}).catch(n.oe)}])});