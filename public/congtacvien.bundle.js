define(["dojo/on","dojo/dom-construct","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleFillSymbol","esri/request","esri/symbols/SimpleMarkerSymbol","esri/widgets/Expand","esri/Graphic","esri/tasks/QueryTask","esri/Color","esri/geometry/geometryEngine","esri/renderers/UniqueValueRenderer","esri/geometry/Extent","esri/Map","esri/tasks/support/Query","esri/widgets/Search","esri/widgets/Legend","esri/widgets/LayerList","esri/widgets/Locate","esri/layers/WebTileLayer","esri/layers/FeatureLayer","esri/layers/MapImageLayer","esri/layers/OpenStreetMapLayer","esri/tasks/Locator","esri/layers/GraphicsLayer","dojo/window","dojo/dom","dojo/dom-class","esri/core/watchUtils","esri/core/Collection","esri/geometry/Polygon","esri/geometry/Polyline","esri/widgets/Locate/LocateViewModel","dojo/dom-style","esri/views/MapView","dojo/sniff","esri/geometry/Point"],function(e,t,n,r,o,i,a,s,l,u,c,d,p,f,y,h,g,m,v,w,b,x,T,E,N,S,L,M,k,F,D,I,O,j,R,P,C){return function(e){function t(t){for(var n,o,i=t[0],a=t[1],s=0,u=[];s<i.length;s++)o=i[s],r[o]&&u.push(r[o][0]),r[o]=0;for(n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n]);for(l&&l(t);u.length;)u.shift()()}var n={},r={2:0};function o(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.e=function(e){var t=[],n=r[e];if(0!==n)if(n)t.push(n[2]);else{var i=new Promise(function(t,o){n=r[e]=[t,o]});t.push(n[2]=i);var a=document.getElementsByTagName("head")[0],s=document.createElement("script");s.charset="utf-8",s.timeout=120,o.nc&&s.setAttribute("nonce",o.nc),s.src=function(e){return o.p+""+({}[e]||e)+".bundle.js"}(e);var l=setTimeout(function(){u({type:"timeout",target:s})},12e4);function u(t){s.onerror=s.onload=null,clearTimeout(l);var n=r[e];if(0!==n){if(n){var o=t&&("load"===t.type?"missing":t.type),i=t&&t.target&&t.target.src,a=new Error("Loading chunk "+e+" failed.\n("+o+": "+i+")");a.type=o,a.request=i,n[1](a)}r[e]=void 0}}s.onerror=s.onload=u,a.appendChild(s)}return Promise.all(t)},o.m=e,o.c=n,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},o.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/",o.oe=function(e){throw console.error(e),e};var i=window.webpackJsonp=window.webpackJsonp||[],a=i.push.bind(i);i.push=t,i=i.slice();for(var s=0;s<i.length;s++)t(i[s]);var l=a;return o(o.s=61)}([function(t,n){t.exports=e},function(e,n){e.exports=t},,function(e,t){e.exports=n},function(e,t){e.exports=r},function(e,t){e.exports=o},function(e,t){e.exports=i},function(e,t){e.exports=a},function(e,t){e.exports=s},function(e,t){e.exports=l},function(e,t){e.exports=u},,function(e,t){e.exports=c},function(e,t){e.exports=d},function(e,t){e.exports=p},function(e,t){e.exports=f},function(e,t){e.exports=y},function(e,t){e.exports=h},function(e,t){e.exports=g},function(e,t){e.exports=m},function(e,t){e.exports=v},function(e,t){e.exports=w},function(e,t){e.exports=b},function(e,t){e.exports=x},function(e,t){e.exports=T},function(e,t){e.exports=E},,,function(e,t){e.exports=N},function(e,t){e.exports=S},,function(e,t){e.exports=L},function(e,t){e.exports=M},,,function(e,t){e.exports=k},function(e,t){e.exports=F},function(e,t){e.exports=D},function(e,t){e.exports=I},function(e,t){e.exports=O},,,function(e,t){e.exports=j},function(e,t){e.exports=R},,function(e,t){e.exports=P},,,,,,,,,,,,,,,function(e,t){e.exports=C},function(e,t,n){"use strict";n.e(1).then(function(){var e=[n(2),n(11),n(15),n(25),n(44),n(24),n(23),n(22),n(21),n(7),n(20),n(19),n(18),n(17),n(9),n(16),n(5),n(13),n(6),n(30),n(49),n(48),n(41),n(40),n(27),n(4),n(3),n(14),n(60),n(0),n(1),n(45)];(function(e,t,n,r,o,i,a,s,l,u,c,d,p,f,y,h,g,m,v,w,b,x,T,E,N,S,L,M,k,F,D,I){var O,j,R,P=new w,C=new n({}),H=new o({container:"map",map:C,center:t.center,zoom:t.zoom});H.session().then(function(n){P.user=n;var r=void 0;7===Math.floor(P.user.role/100)&&(r="MaHuyenTP = '"+P.user.role.trim()+"'"),H.systemVariable=P;var o=function(){function t(){var e=$("<div/>",{class:"google-geocoding-widget input-group add-on"}),t=$("<input/>",{class:"form-control",type:"text",name:"srch-term",id:"srch-term",placeholder:"Nhập đơn vị hành chính, tên đường "}).appendTo(e),n=$("<div/>",{class:"input-group-btn"}).appendTo(e),r=$("<button/>",{class:"btn btn-default",type:"submit"}).appendTo(n),o=($("<i/>",{class:"glyphicon glyphicon-search"}).appendTo(r),$("<div/>",{class:"output-group add-on",id:"ketqua"}));H.ui.add(e[0],"top-right"),H.ui.add(o[0],"top-right"),r.on("click",function(e){function n(){var e=document.getElementById("ketqua");if(e)for(;e.firstChild;)e.removeChild(e.firstChild)}var r=t.val().toString().replace(/[ ]/g,"+");$.get("https://maps.googleapis.com/maps/api/geocode/json?address="+r+"&key=AIzaSyC9VTEqoczK2j7lDRacfQ3aRTE3f4vuHek").done(function(e){var t=e.results;n();var r=function(e){var t=$("<div />",{class:"address list-group-item"}).appendTo(o);$("<div />",{class:"address-detail",text:e.formatted_address}).appendTo(t).click(function(){return t=e.geometry.viewport,r=new M({ymin:t.southwest.lat,ymax:t.northeast.lat,xmin:t.southwest.lng,xmax:t.northeast.lng}),H.goTo(r),void n();var t,r})},i=!0,a=!1,s=void 0;try{for(var l,u=t[Symbol.iterator]();!(i=(l=u.next()).done);i=!0){r(l.value)}}catch(e){a=!0,s=e}finally{try{!i&&u.return&&u.return()}finally{if(a)throw s}}})})}t(),new T(H).startup(),H.ui.move(["zoom"],"top-left"),H.ui.add(new u({expandIconClass:"esri-icon-layer-list",view:H,content:new d({container:document.createElement("div"),view:H})}),"top-left");var n,o=new c({view:H});if((n=document.createElement("div")).id="dtg-wget-split-polygon",n.classList.add("esri-widget","esri-widget-button","esri-icon-applications"),n.title="Đánh dấu vị trí",H.ui.add(n,"bottom-right"),n.addEventListener("click",function(){var e=C.findLayerById("danhdauvitri");o.locate().then(function(t){var n=new k({latitude:t.coords.latitude,longitude:t.coords.longitude,spatialReference:H.spatialReference});e.applyEdits({addFeatures:[{attributes:{NgayCapNhat:(new Date).getTime(),NguoiCapNhat:P.user.userName},geometry:n}]}).then(function(t){t.addFeatureResults[0].objectId&&e.queryFeatures({where:"OBJECTID = "+t.addFeatureResults[0].objectId,returnGeometry:!0,outFields:["*"],outSpatialReference:H.spatialReference}).then(function(e){H.popup.open({updateLocationEnabled:!0,features:e.features,featureMenuOpen:!0})})})})}),H.ui.add(o,"top-left"),!I("android")&&!I("ios")&&!I("bb")){var i=D.create("img",{src:"images/logo-ditagis.png",id:"dtg-widget-logo"});H.ui.add(i,"bottom-right")}H.ui.add(new u({expandIconClass:"esri-icon-collection",content:new p({view:H})}),"top-left");var a=new N(H,{symbolPlg:new S({style:"none",outline:new L({color:"black",width:3})})}),t=new f({searchAllEnabled:!1,view:H,allPlaceholder:"Nhập nội dung tìm kiếm",sources:[{featureLayer:C.findLayerById(e.SAUBENH),searchFields:["OBJECTID","MaSauBenh","MaHuyenTP"],displayField:"MaSauBenh",exactMatch:!1,outFields:["*"],name:"Sâu hại",placeholder:"Tìm kiếm theo tên, loại cây trồng, huyện/tp"},{featureLayer:C.findLayerById(e.TRONGTROT),searchFields:["MaDoiTuong"],displayField:"MaDoiTuong",exactMatch:!1,outFields:["*"],name:"Trồng Trọt",placeholder:"Nhập mã đối tượng Trồng trọt"},{featureLayer:new s({url:"https://ditagis.com:6443/arcgis/rest/services/BinhDuong/DuLieuNen/MapServer/4"}),searchFields:["MaPhuongXa","TenXa"],displayField:"TenXa",outFields:["*"],filter:{where:""+(r||"1=1")},name:"Hành chính xã",placeholder:"Nhập tên xã/ phường",popupOpenOnSelect:!1,resultGraphicEnabled:!1}]});H.ui.add(t,{position:"top-right"}),t.on("search-complete",function(e){a.clear();var t=e.results.find(function(e){return 4===e.sourceIndex});if(t&&t.results.length>0){var n=t.results[0].feature;a.add(n)}});var l=new x(H);l.startup(),new E(H).startup();var y=new b({view:H});l.on("draw-finish",function(e){y.add({layerName:e.graphic.layer.title,geometry:e.graphic.geometry})})};!function(){var n=t.basemap;if(r){var o=!0,i=!1,s=void 0;try{for(var u,c=n.sublayers[Symbol.iterator]();!(o=(u=c.next()).done);o=!0)u.value.definitionExpression=r}catch(e){i=!0,s=e}finally{try{!o&&c.return&&c.return()}finally{if(i)throw s}}}function d(e,t,n,r){if(e)switch(r){case R:O.visible=j.visible=!e;break;case O:R.visible=j.visible=!e;break;case j:R.visible=O.visible=!e}}n.visible=!1,(O=new a(n)).watch("visible",function(e){$&&$.notify(e?"Hiển thị dữ liệu nền":"Ẩn dữ liệu nền")}),O.then(function(){if(r){var t=O.findSublayerById(e.INDEX_HANHCHINHHUYEN),n=t.createQuery();n.where=r,n.returnGeometry=!0,n.outSpatialReference=H.spatialReference,t.queryFeatures(n).then(function(e){var t=e.features[0];H.goTo({target:t.geometry})})}}),j=new l({urlTemplate:"//mt1.google.com/vt/lyrs=y&x={col}&y={row}&z={level}",title:"Ảnh vệ tinh",id:"worldimagery",visible:!0}),R=new l({title:"Đường đi",urlTemplate:"//mt1.google.com/vt/lyrs=m&x={col}&y={row}&z={level}",id:"osm",visible:!1}),C.addMany([R,j,O]),R.watch("visible",d),j.watch("visible",d),O.watch("visible",d)}(),(s.prototype.getAttachments=function(e){var t=this;return new Promise(function(n,r){var o=t.url+"/"+t.layerId+"/"+e;g(o+"/attachments?f=json",{responseType:"json",method:"get"}).then(function(e){n(e.data||null)})})},new Promise(function(n,o){g("/map/layerrole",{method:"post"}).then(function(o){if(!o.data)throw"cannot request permission";var i=function(e){t.layers.find(function(t){return t.id===e.layer}).permission={create:e.isCreate,view:e.isView,delete:e.isDelete,edit:e.isEdit}},a=!0,l=!1,u=void 0;try{for(var c,d=o.data[Symbol.iterator]();!(a=(c=d.next()).done);a=!0)i(c.value)}catch(e){l=!0,u=e}finally{try{!a&&d.return&&d.return()}finally{if(l)throw u}}for(var p in t.layers){var f=t.layers[p];if(f.id!==e.DOANHNGHIEP&&f.permission.view){if(f.id===e.SAUBENH){var y=new Date;y.setDate(y.getDate()-365),f.definitionExpression="NgayXayRa >= date '"+y.getFullYear()+"-"+(y.getMonth()+1)+"-"+y.getDate()+" "+y.getHours()+":"+y.getMinutes()+":"+y.getSeconds()+"'",f.renderer=new m({field:"CapDoGayHai",uniqueValueInfos:[{value:"1",symbol:new v({color:"#0f0",style:"circle",outline:{color:"white"}}),label:"Nhẹ"},{value:"2",symbol:new v({color:"#00a9e6",style:"circle",outline:{color:"white"}}),label:"Nặng"},{value:"3",symbol:new v({color:"#ff0000",style:"circle",outline:{color:"white"}}),label:"Mất trắng"},{value:"4",symbol:new v({color:"#ffff6d",style:"circle",outline:{color:"white"}}),label:"Trung bình"}]})}r&&(f.definitionExpression?f.definitionExpression+=" and "+r:f.definitionExpression=r,f.definitionExpression=r),f.id===e.TRONGTROT&&(f.opacity=.7);var h=new s(f);C.add(h),f.id===e.TRONGTROT&&h.on("layerview-create",function(e){e.layerView&&e.layerView.watch("updating",function(e,t){e&&e!=t?$(".loading").css("display","block"):$(".loading").css("display","none")})})}}var g=new s({id:"danhdauvitri",outFields:["*"],title:"Đánh dấu vị trí",url:"https://ditagis.com:6443/arcgis/rest/services/BinhDuong/BaoVeThucVat_DanhDauViTri/FeatureServer/0",permission:{create:!1,view:!0,delete:!0,edit:!0}});C.add(g),n()})})).then(function(){o(),C.reorder(O,5)})})}).apply(null,e)}).catch(n.oe)}])});