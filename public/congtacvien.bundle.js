define(["dojo/on","dojo/dom-construct","esri/symbols/SimpleFillSymbol","esri/symbols/SimpleLineSymbol","esri/request","esri/symbols/SimpleMarkerSymbol","esri/tasks/QueryTask","esri/widgets/Expand","dojo/sniff","esri/geometry/Extent","esri/renderers/UniqueValueRenderer","esri/tasks/support/Query","esri/widgets/Search","esri/widgets/Legend","esri/widgets/LayerList","esri/widgets/Locate","esri/layers/WebTileLayer","esri/layers/FeatureLayer","esri/layers/MapImageLayer","esri/layers/OpenStreetMapLayer","esri/tasks/Locator","esri/Map","esri/geometry/Point","esri/Graphic","esri/Color","esri/geometry/geometryEngine","esri/layers/GraphicsLayer","dojo/window","dojo/dom","dojo/dom-class","esri/core/Collection","esri/geometry/Polygon","esri/geometry/Polyline","esri/widgets/Locate/LocateViewModel","esri/core/watchUtils","dojo/dom-style","esri/views/MapView"],function(e,t,n,r,i,o,a,s,l,c,u,d,p,f,y,h,g,m,v,w,b,x,T,k,E,L,N,S,M,D,O,P,j,H,I,C,F){return function(e){function t(t){for(var n,i,o=t[0],a=t[1],s=0,c=[];s<o.length;s++)i=o[s],r[i]&&c.push(r[i][0]),r[i]=0;for(n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n]);for(l&&l(t);c.length;)c.shift()()}var n={},r={2:0};function i(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.e=function(e){var t=[],n=r[e];if(0!==n)if(n)t.push(n[2]);else{var o=new Promise(function(t,i){n=r[e]=[t,i]});t.push(n[2]=o);var a=document.getElementsByTagName("head")[0],s=document.createElement("script");s.charset="utf-8",s.timeout=120,i.nc&&s.setAttribute("nonce",i.nc),s.src=function(e){return i.p+""+({}[e]||e)+".bundle.js"}(e);var l=setTimeout(function(){c({type:"timeout",target:s})},12e4);function c(t){s.onerror=s.onload=null,clearTimeout(l);var n=r[e];if(0!==n){if(n){var i=t&&("load"===t.type?"missing":t.type),o=t&&t.target&&t.target.src,a=new Error("Loading chunk "+e+" failed.\n("+i+": "+o+")");a.type=i,a.request=o,n[1](a)}r[e]=void 0}}s.onerror=s.onload=c,a.appendChild(s)}return Promise.all(t)},i.m=e,i.c=n,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},i.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/",i.oe=function(e){throw console.error(e),e};var o=window.webpackJsonp=window.webpackJsonp||[],a=o.push.bind(o);o.push=t,o=o.slice();for(var s=0;s<o.length;s++)t(o[s]);var l=a;return i(i.s=46)}([function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t){e.exports=r},function(e,t){e.exports=i},function(e,t){e.exports=o},function(e,t){e.exports=a},function(e,t){e.exports=s},function(e,t){e.exports=l},function(e,t){e.exports=c},function(e,t){e.exports=u},function(e,t){e.exports=d},function(e,t){e.exports=p},function(e,t){e.exports=f},function(e,t){e.exports=y},function(e,t){e.exports=h},function(e,t){e.exports=g},function(e,t){e.exports=m},function(e,t){e.exports=v},function(e,t){e.exports=w},function(e,t){e.exports=b},function(e,t){e.exports=x},function(e,t){e.exports=T},,function(e,t){e.exports=k},function(e,t){e.exports=E},,function(e,t){e.exports=L},function(e,t){e.exports=N},function(e,t){e.exports=S},,function(e,t){e.exports=M},function(e,t){e.exports=D},function(e,t){e.exports=O},function(e,t){e.exports=P},function(e,t){e.exports=j},function(e,t){e.exports=H},function(e,t){e.exports=I},,,function(e,t){e.exports=C},function(e,t){e.exports=F},,,,,function(e,t,n){n.e(0).then(function(){var e=[n(23),n(26),n(21),n(20),n(42),n(19),n(18),n(17),n(16),n(7),n(15),n(14),n(13),n(12),n(6),n(11),n(4),n(10),n(5),n(30),n(45),n(44),n(39),n(38),n(43),n(2),n(3),n(9),n(22),n(0),n(1),n(8)];(function(e,t,n,r,i,o,a,s,l,c,u,d,p,f,y,h,g,m,v,w,b,x,T,k,E,L,N,S,M,D,O,P){"use strict";var j,H,I,C=new w,F=new n({}),A=new i({container:"map",map:F,center:t.center,zoom:t.zoom});A.session().then(function(n){C.user=n;var r=void 0;7===Math.floor(C.user.role/100)&&(r="MaHuyenTP = '"+C.user.role.trim()+"'"),A.systemVariable=C;!function(){var n=t.basemap;if(r){var i=n.sublayers,o=Array.isArray(i),s=0;for(i=o?i:i[Symbol.iterator]();;){var c;if(o){if(s>=i.length)break;c=i[s++]}else{if((s=i.next()).done)break;c=s.value}c.definitionExpression=r}}function u(e,t,n,r){if(e)switch(r){case I:j.visible=H.visible=!e;break;case j:I.visible=H.visible=!e;break;case H:I.visible=j.visible=!e}}n.visible=!1,(j=new a(n)).watch("visible",function(e){$&&$.notify(e?"Hiển thị dữ liệu nền":"Ẩn dữ liệu nền")}),j.then(function(){if(r){var t=j.findSublayerById(e.INDEX_HANHCHINHHUYEN),n=t.createQuery();n.where=r,n.returnGeometry=!0,n.outSpatialReference=A.spatialReference,t.queryFeatures(n).then(function(e){var t=e.features[0];A.goTo({target:t.geometry})})}}),H=new l({urlTemplate:"//mt1.google.com/vt/lyrs=y&x={col}&y={row}&z={level}",title:"Ảnh vệ tinh",id:"worldimagery",visible:!0}),I=new l({title:"Đường đi",urlTemplate:"//mt1.google.com/vt/lyrs=m&x={col}&y={row}&z={level}",id:"osm",visible:!1}),F.addMany([I,H,j]),I.watch("visible",u),H.watch("visible",u),j.watch("visible",u)}(),(s.prototype.getAttachments=function(e){var t=this;return new Promise(function(n,r){var i=t.url+"/"+t.layerId+"/"+e;g(i+"/attachments?f=json",{responseType:"json",method:"get"}).then(function(e){n(e.data||null)})})},new Promise(function(n,i){g("/map/layerrole",{method:"post"}).then(function(i){if(!i.data)throw"cannot request permission";var o=function(){if(l){if(c>=a.length)return"break";u=a[c++]}else{if((c=a.next()).done)return"break";u=c.value}var e=u;t.layers.find(function(t){return t.id===e.layer}).permission={create:e.isCreate,view:e.isView,delete:e.isDelete,edit:e.isEdit}},a=i.data,l=Array.isArray(a),c=0;for(a=l?a:a[Symbol.iterator]();;){var u;if("break"===o())break}for(var d in t.layers){var p=t.layers[d];if(p.id!==e.DOANHNGHIEP&&p.permission.view){if(p.id===e.SAUBENH){var f=new Date;f.setDate(f.getDate()-365),p.definitionExpression="NgayXayRa >= date '"+f.getFullYear()+"-"+(f.getMonth()+1)+"-"+f.getDate()+" "+f.getHours()+":"+f.getMinutes()+":"+f.getSeconds()+"'",p.renderer=new m({field:"CapDoGayHai",uniqueValueInfos:[{value:"1",symbol:new v({color:"#0f0",style:"circle",outline:{color:"white"}}),label:"Nhẹ"},{value:"2",symbol:new v({color:"#00a9e6",style:"circle",outline:{color:"white"}}),label:"Nặng"},{value:"3",symbol:new v({color:"#ff0000",style:"circle",outline:{color:"white"}}),label:"Mất trắng"},{value:"4",symbol:new v({color:"#ffff6d",style:"circle",outline:{color:"white"}}),label:"Trung bình"}]})}r&&(p.definitionExpression?p.definitionExpression+=" and "+r:p.definitionExpression=r,p.definitionExpression=r),p.id===e.TRONGTROT&&(p.opacity=.7);var y=new s(p);F.add(y),p.id===e.TRONGTROT&&y.on("layerview-create",function(e){e.layerView&&e.layerView.watch("updating",function(e,t){e&&e!=t?$(".loading").css("display","block"):$(".loading").css("display","none")})})}}var h=new s({id:"danhdauvitri",url:"https://ditagis.com:6443/arcgis/rest/services/BinhDuong/BaoVeThucVat_DanhDauViTri/FeatureServer/0",permission:{create:!1,view:!0,delete:!0,edit:!1}});F.add(h),n()})})).then(function(){(function(){function t(){var e=$("<div/>",{class:"google-geocoding-widget input-group add-on"}),t=$("<input/>",{class:"form-control",type:"text",name:"srch-term",id:"srch-term",placeholder:"Nhập đơn vị hành chính, tên đường "}).appendTo(e),n=$("<div/>",{class:"input-group-btn"}).appendTo(e),r=$("<button/>",{class:"btn btn-default",type:"submit"}).appendTo(n),i=($("<i/>",{class:"glyphicon glyphicon-search"}).appendTo(r),$("<div/>",{class:"output-group add-on",id:"ketqua"}));A.ui.add(e[0],"top-right"),A.ui.add(i[0],"top-right"),r.on("click",function(e){function n(){var e=document.getElementById("ketqua");if(e)for(;e.firstChild;)e.removeChild(e.firstChild)}var r=t.val().toString().replace(/[ ]/g,"+");$.get("https://maps.googleapis.com/maps/api/geocode/json?address="+r+"&key=AIzaSyC9VTEqoczK2j7lDRacfQ3aRTE3f4vuHek").done(function(e){var t=e.results;n();var r=function(){if(a){if(s>=o.length)return"break";l=o[s++]}else{if((s=o.next()).done)return"break";l=s.value}var e=l,t=$("<div />",{class:"address list-group-item"}).appendTo(i);$("<div />",{class:"address-detail",text:e.formatted_address}).appendTo(t).click(function(){return t=e.geometry.viewport,r=new S({ymin:t.southwest.lat,ymax:t.northeast.lat,xmin:t.southwest.lng,xmax:t.northeast.lng}),A.goTo(r),void n();var t,r})},o=t,a=Array.isArray(o),s=0;for(o=a?o:o[Symbol.iterator]();;){var l;if("break"===r())break}})})}t(),new T(A).startup(),A.ui.move(["zoom"],"top-left"),A.ui.add(new c({expandIconClass:"esri-icon-layer-list",view:A,content:new d({container:document.createElement("div"),view:A})}),"top-left");var n,i=new u({view:A});if((n=document.createElement("div")).id="dtg-wget-split-polygon",n.classList.add("esri-widget","esri-widget-button","esri-icon-applications"),n.title="Đánh dấu vị trí",A.ui.add(n,"bottom-right"),n.addEventListener("click",function(){var e=F.findLayerById("danhdauvitri");Loader.show(!1),i.locate().then(function(t){var n=new M({latitude:t.coords.latitude,longitude:t.coords.longitude,spatialReference:A.spatialReference});e.applyEdits({addFeatures:[{attributes:{NgayCapNhat:(new Date).getTime(),NguoiCapNhat:C.user.userName},geometry:n}]}).then(function(e){return console.log(e)}).always(function(e){return Loader.hide()})})}),A.ui.add(i,"top-left"),!P("android")&&!P("ios")&&!P("bb")){var o=O.create("img",{src:"images/logo-ditagis.png",id:"dtg-widget-logo"});A.ui.add(o,"bottom-right")}A.ui.add(new c({expandIconClass:"esri-icon-collection",content:new p({view:A})}),"top-left");var a=new E(A,{symbolPlg:new L({style:"none",outline:new N({color:"black",width:3})})}),t=new f({searchAllEnabled:!1,view:A,allPlaceholder:"Nhập nội dung tìm kiếm",sources:[{featureLayer:F.findLayerById(e.SAUBENH),searchFields:["OBJECTID","MaSauBenh","MaHuyenTP"],displayField:"MaSauBenh",exactMatch:!1,outFields:["*"],name:"Sâu hại",placeholder:"Tìm kiếm theo tên, loại cây trồng, huyện/tp"},{featureLayer:F.findLayerById(e.TRONGTROT),searchFields:["MaDoiTuong"],displayField:"MaDoiTuong",exactMatch:!1,outFields:["*"],name:"Trồng Trọt",placeholder:"Nhập mã đối tượng Trồng trọt"},{featureLayer:new s({url:"https://ditagis.com:6443/arcgis/rest/services/BinhDuong/DuLieuNen/MapServer/4"}),searchFields:["MaPhuongXa","TenXa"],displayField:"TenXa",outFields:["*"],filter:{where:""+(r||"1=1")},name:"Hành chính xã",placeholder:"Nhập tên xã/ phường",popupOpenOnSelect:!1,resultGraphicEnabled:!1}]});A.ui.add(t,{position:"top-right"}),t.on("search-complete",function(e){a.clear();var t=e.results.find(function(e){return 4===e.sourceIndex});if(t&&t.results.length>0){var n=t.results[0].feature;a.add(n)}});var l=new x(A);l.startup(),new k(A).startup();var y=new b({view:A});l.on("draw-finish",function(e){y.add({layerName:e.graphic.layer.title,geometry:e.graphic.geometry})})})(),F.reorder(j,5)}),Loader.hide()})}).apply(null,e)}).catch(n.oe)}])});